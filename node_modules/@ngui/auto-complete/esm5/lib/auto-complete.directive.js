import { __decorate, __param } from "tslib";
import { AfterViewInit, ComponentFactoryResolver, ComponentRef, Directive, EventEmitter, Host, Input, OnChanges, OnDestroy, OnInit, Optional, Output, SimpleChanges, SkipSelf, ViewContainerRef } from '@angular/core';
import { AbstractControl, ControlContainer, FormControl, FormGroup, FormGroupName } from '@angular/forms';
import { NguiAutoCompleteComponent } from './auto-complete.component';
var NguiAutoCompleteDirective = /** @class */ (function () {
    function NguiAutoCompleteDirective(resolver, viewContainerRef, parentForm) {
        var _this = this;
        this.resolver = resolver;
        this.viewContainerRef = viewContainerRef;
        this.parentForm = parentForm;
        this.autocomplete = false;
        this.acceptUserInput = true;
        this.loadingTemplate = null;
        this.loadingText = 'Loading';
        this.tabToSelect = true;
        this.selectOnBlur = false;
        this.matchFormatted = false;
        this.autoSelectFirstItem = false;
        this.openOnFocus = true;
        this.closeOnFocusOut = true;
        this.reFocusAfterSelect = true;
        this.headerItemTemplate = null;
        this.ignoreAccents = true;
        this.zIndex = '1';
        this.isRtl = false;
        this.ngModelChange = new EventEmitter();
        this.valueChanged = new EventEmitter();
        this.customSelected = new EventEmitter();
        // show auto-complete list below the current element
        this.showAutoCompleteDropdown = function (event) {
            if (_this.dropdownJustHidden) {
                return;
            }
            _this.hideAutoCompleteDropdown();
            _this.scheduledBlurHandler = null;
            var factory = _this.resolver.resolveComponentFactory(NguiAutoCompleteComponent);
            _this.componentRef = _this.viewContainerRef.createComponent(factory);
            var component = _this.componentRef.instance;
            component.keyword = _this.inputEl.value;
            component.showInputTag = false; // Do NOT display autocomplete input tag separately
            component.pathToData = _this.pathToData;
            component.minChars = _this.minChars;
            component.source = _this.source;
            component.placeholder = _this.autoCompletePlaceholder;
            component.acceptUserInput = _this.acceptUserInput;
            component.maxNumList = parseInt(_this.maxNumList, 10);
            component.loadingText = _this.loadingText;
            component.loadingTemplate = _this.loadingTemplate;
            component.listFormatter = _this.listFormatter;
            component.blankOptionText = _this.blankOptionText;
            component.noMatchFoundText = _this.noMatchFoundText;
            component.tabToSelect = _this.tabToSelect;
            component.selectOnBlur = _this.selectOnBlur;
            component.matchFormatted = _this.matchFormatted;
            component.autoSelectFirstItem = _this.autoSelectFirstItem;
            component.headerItemTemplate = _this.headerItemTemplate;
            component.ignoreAccents = _this.ignoreAccents;
            component.valueSelected.subscribe(_this.selectNewValue);
            component.textEntered.subscribe(_this.enterNewText);
            component.customSelected.subscribe(_this.selectCustomValue);
            _this.acDropdownEl = _this.componentRef.location.nativeElement;
            _this.acDropdownEl.style.display = 'none';
            // if this element is not an input tag, move dropdown after input tag
            // so that it displays correctly
            // TODO: confirm with owners
            // with some reason, viewContainerRef.createComponent is creating element
            // to parent div which is created by us on ngOnInit, please try this with demo
            // if (this.el.tagName !== 'INPUT' && this.acDropdownEl) {
            _this.inputEl.parentElement.insertBefore(_this.acDropdownEl, _this.inputEl.nextSibling);
            // }
            _this.revertValue = typeof _this.ngModel !== 'undefined' ? _this.ngModel : _this.inputEl.value;
            setTimeout(function () {
                component.reloadList(_this.inputEl.value);
                _this.styleAutoCompleteDropdown();
                component.dropdownVisible = true;
            });
        };
        this.hideAutoCompleteDropdown = function (event) {
            if (_this.componentRef) {
                var currentItem = void 0;
                var hasRevertValue = (typeof _this.revertValue !== 'undefined');
                if (_this.inputEl && hasRevertValue && _this.acceptUserInput === false) {
                    currentItem = _this.componentRef.instance.findItemFromSelectValue(_this.inputEl.value);
                }
                _this.componentRef.destroy();
                _this.componentRef = undefined;
                if (_this.inputEl && hasRevertValue && _this.acceptUserInput === false && currentItem === null) {
                    _this.selectNewValue(_this.revertValue);
                }
                else if (_this.inputEl && _this.acceptUserInput === true && typeof currentItem === 'undefined' && event && event.target.value) {
                    _this.enterNewText(event.target.value);
                }
            }
            _this.dropdownJustHidden = true;
            setTimeout(function () { return _this.dropdownJustHidden = false; }, 100);
        };
        this.styleAutoCompleteDropdown = function () {
            if (_this.componentRef) {
                var component = _this.componentRef.instance;
                /* setting width/height auto complete */
                var thisElBCR = _this.el.getBoundingClientRect();
                var thisInputElBCR = _this.inputEl.getBoundingClientRect();
                var closeToBottom = thisInputElBCR.bottom + 100 > window.innerHeight;
                var directionOfStyle = _this.isRtl ? 'right' : 'left';
                _this.acDropdownEl.style.width = thisInputElBCR.width + 'px';
                _this.acDropdownEl.style.position = 'absolute';
                _this.acDropdownEl.style.zIndex = _this.zIndex;
                _this.acDropdownEl.style[directionOfStyle] = '0';
                _this.acDropdownEl.style.display = 'inline-block';
                if (closeToBottom) {
                    _this.acDropdownEl.style.bottom = thisInputElBCR.height + "px";
                }
                else {
                    _this.acDropdownEl.style.top = thisInputElBCR.height + "px";
                }
            }
        };
        this.selectNewValue = function (item) {
            // make displayable value
            if (item && typeof item === 'object') {
                item = _this.setToStringFunction(item);
            }
            _this.renderValue(item);
            // make return value
            var val = item;
            if (_this.selectValueOf && item[_this.selectValueOf]) {
                val = item[_this.selectValueOf];
            }
            if ((_this.parentForm && _this.formControlName) || _this.extFormControl) {
                if (!!val) {
                    _this.formControl.patchValue(val);
                }
            }
            if (val !== _this.ngModel) {
                _this.ngModelChange.emit(val);
            }
            _this.valueChanged.emit(val);
            _this.hideAutoCompleteDropdown();
            setTimeout(function () {
                if (_this.reFocusAfterSelect) {
                    _this.inputEl.focus();
                }
                return _this.inputEl;
            });
        };
        this.selectCustomValue = function (text) {
            _this.customSelected.emit(text);
            _this.hideAutoCompleteDropdown();
            setTimeout(function () {
                if (_this.reFocusAfterSelect) {
                    _this.inputEl.focus();
                }
                return _this.inputEl;
            });
        };
        this.enterNewText = function (value) {
            _this.renderValue(value);
            _this.ngModelChange.emit(value);
            _this.valueChanged.emit(value);
            _this.hideAutoCompleteDropdown();
        };
        this.keydownEventHandler = function (evt) {
            if (_this.componentRef) {
                var component = _this.componentRef.instance;
                component.inputElKeyHandler(evt);
            }
        };
        this.inputEventHandler = function (evt) {
            if (_this.componentRef) {
                var component = _this.componentRef.instance;
                component.dropdownVisible = true;
                component.keyword = evt.target.value;
                component.reloadListInDelay(evt);
            }
            else {
                _this.showAutoCompleteDropdown();
            }
        };
        this.el = this.viewContainerRef.element.nativeElement;
    }
    NguiAutoCompleteDirective.prototype.ngOnInit = function () {
        var _this = this;
        // Blur event is handled only after a click event.
        // This is to prevent handling of blur events resulting from interacting with a scrollbar
        // introduced by content overflow (Internet explorer issue).
        // See issue description here: http://stackoverflow.com/questions/2023779/clicking-on-a-divs-scroll-bar-fires-the-blur-event-in-ie
        this.documentClickListener = function (e) {
            if (_this.scheduledBlurHandler) {
                _this.scheduledBlurHandler();
                _this.scheduledBlurHandler = null;
            }
        };
        document.addEventListener('click', this.documentClickListener);
        // wrap this element with <div class="ngui-auto-complete">
        this.wrapperEl = document.createElement('div');
        this.wrapperEl.className = 'ngui-auto-complete-wrapper';
        this.wrapperEl.style.position = 'relative';
        this.el.parentElement.insertBefore(this.wrapperEl, this.el.nextSibling);
        this.wrapperEl.appendChild(this.el);
        // Check if we were supplied with a [formControlName] and it is inside a [form]
        // else check if we are supplied with a [FormControl] regardless if it is inside a [form] tag
        if (this.parentForm && this.formControlName) {
            if (this.parentForm['form']) {
                this.formControl = this.parentForm['form'].get(this.formControlName);
            }
            else if (this.parentForm instanceof FormGroupName) {
                this.formControl = this.parentForm.control.controls[this.formControlName];
            }
        }
        else if (this.extFormControl) {
            this.formControl = this.extFormControl;
        }
        // apply toString() method for the object
        if (!!this.ngModel) {
            this.selectNewValue(this.ngModel);
        }
        else if (!!this.formControl && this.formControl.value) {
            this.selectNewValue(this.formControl.value);
        }
    };
    NguiAutoCompleteDirective.prototype.ngAfterViewInit = function () {
        var _this = this;
        // if this element is not an input tag, move dropdown after input tag
        // so that it displays correctly
        this.inputEl = this.el.tagName === 'INPUT' ? this.el : this.el.querySelector('input');
        if (this.openOnFocus) {
            this.inputEl.addEventListener('focus', function (e) { return _this.showAutoCompleteDropdown(e); });
        }
        if (this.closeOnFocusOut) {
            this.inputEl.addEventListener('focusout', function (e) { return _this.hideAutoCompleteDropdown(e); });
        }
        if (!this.autocomplete) {
            this.inputEl.setAttribute('autocomplete', 'off');
        }
        this.inputEl.addEventListener('blur', function (e) {
            _this.scheduledBlurHandler = function () {
                return _this.blurHandler(e);
            };
        });
        this.inputEl.addEventListener('keydown', function (e) { return _this.keydownEventHandler(e); });
        this.inputEl.addEventListener('input', function (e) { return _this.inputEventHandler(e); });
    };
    NguiAutoCompleteDirective.prototype.ngOnDestroy = function () {
        if (this.componentRef) {
            this.componentRef.instance.valueSelected.unsubscribe();
            this.componentRef.instance.textEntered.unsubscribe();
        }
        if (this.documentClickListener) {
            document.removeEventListener('click', this.documentClickListener);
        }
    };
    NguiAutoCompleteDirective.prototype.ngOnChanges = function (changes) {
        if (changes['ngModel']) {
            this.ngModel = this.setToStringFunction(changes['ngModel'].currentValue);
            this.renderValue(this.ngModel);
        }
    };
    NguiAutoCompleteDirective.prototype.blurHandler = function (event) {
        if (this.componentRef) {
            var component = this.componentRef.instance;
            if (this.selectOnBlur) {
                component.selectOne(component.filteredList[component.itemIndex]);
            }
            if (this.closeOnFocusOut) {
                this.hideAutoCompleteDropdown(event);
            }
        }
    };
    NguiAutoCompleteDirective.prototype.setToStringFunction = function (item) {
        if (item && typeof item === 'object') {
            var displayVal_1;
            if (typeof this.valueFormatter === 'string') {
                var matches = this.valueFormatter.match(/[a-zA-Z0-9_\$]+/g);
                var formatted_1 = this.valueFormatter;
                if (matches && typeof item !== 'string') {
                    matches.forEach(function (key) {
                        formatted_1 = formatted_1.replace(key, item[key]);
                    });
                }
                displayVal_1 = formatted_1;
            }
            else if (typeof this.valueFormatter === 'function') {
                displayVal_1 = this.valueFormatter(item);
            }
            else if (this.displayPropertyName) {
                displayVal_1 = item[this.displayPropertyName];
            }
            else if (typeof this.listFormatter === 'string' && this.listFormatter.match(/^\w+$/)) {
                displayVal_1 = item[this.listFormatter];
            }
            else {
                displayVal_1 = item.value;
            }
            item.toString = function () { return displayVal_1; };
        }
        return item;
    };
    NguiAutoCompleteDirective.prototype.renderValue = function (item) {
        if (!!this.inputEl) {
            this.inputEl.value = '' + item;
        }
    };
    NguiAutoCompleteDirective.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: ViewContainerRef },
        { type: ControlContainer, decorators: [{ type: Optional }, { type: Host }, { type: SkipSelf }] }
    ]; };
    __decorate([
        Input('autocomplete')
    ], NguiAutoCompleteDirective.prototype, "autocomplete", void 0);
    __decorate([
        Input('auto-complete-placeholder')
    ], NguiAutoCompleteDirective.prototype, "autoCompletePlaceholder", void 0);
    __decorate([
        Input('source')
    ], NguiAutoCompleteDirective.prototype, "source", void 0);
    __decorate([
        Input('path-to-data')
    ], NguiAutoCompleteDirective.prototype, "pathToData", void 0);
    __decorate([
        Input('min-chars')
    ], NguiAutoCompleteDirective.prototype, "minChars", void 0);
    __decorate([
        Input('display-property-name')
    ], NguiAutoCompleteDirective.prototype, "displayPropertyName", void 0);
    __decorate([
        Input('accept-user-input')
    ], NguiAutoCompleteDirective.prototype, "acceptUserInput", void 0);
    __decorate([
        Input('max-num-list')
    ], NguiAutoCompleteDirective.prototype, "maxNumList", void 0);
    __decorate([
        Input('select-value-of')
    ], NguiAutoCompleteDirective.prototype, "selectValueOf", void 0);
    __decorate([
        Input('loading-template')
    ], NguiAutoCompleteDirective.prototype, "loadingTemplate", void 0);
    __decorate([
        Input('list-formatter')
    ], NguiAutoCompleteDirective.prototype, "listFormatter", void 0);
    __decorate([
        Input('loading-text')
    ], NguiAutoCompleteDirective.prototype, "loadingText", void 0);
    __decorate([
        Input('blank-option-text')
    ], NguiAutoCompleteDirective.prototype, "blankOptionText", void 0);
    __decorate([
        Input('no-match-found-text')
    ], NguiAutoCompleteDirective.prototype, "noMatchFoundText", void 0);
    __decorate([
        Input('value-formatter')
    ], NguiAutoCompleteDirective.prototype, "valueFormatter", void 0);
    __decorate([
        Input('tab-to-select')
    ], NguiAutoCompleteDirective.prototype, "tabToSelect", void 0);
    __decorate([
        Input('select-on-blur')
    ], NguiAutoCompleteDirective.prototype, "selectOnBlur", void 0);
    __decorate([
        Input('match-formatted')
    ], NguiAutoCompleteDirective.prototype, "matchFormatted", void 0);
    __decorate([
        Input('auto-select-first-item')
    ], NguiAutoCompleteDirective.prototype, "autoSelectFirstItem", void 0);
    __decorate([
        Input('open-on-focus')
    ], NguiAutoCompleteDirective.prototype, "openOnFocus", void 0);
    __decorate([
        Input('close-on-focusout')
    ], NguiAutoCompleteDirective.prototype, "closeOnFocusOut", void 0);
    __decorate([
        Input('re-focus-after-select')
    ], NguiAutoCompleteDirective.prototype, "reFocusAfterSelect", void 0);
    __decorate([
        Input('header-item-template')
    ], NguiAutoCompleteDirective.prototype, "headerItemTemplate", void 0);
    __decorate([
        Input('ignore-accents')
    ], NguiAutoCompleteDirective.prototype, "ignoreAccents", void 0);
    __decorate([
        Input()
    ], NguiAutoCompleteDirective.prototype, "ngModel", void 0);
    __decorate([
        Input('formControlName')
    ], NguiAutoCompleteDirective.prototype, "formControlName", void 0);
    __decorate([
        Input('formControl')
    ], NguiAutoCompleteDirective.prototype, "extFormControl", void 0);
    __decorate([
        Input('z-index')
    ], NguiAutoCompleteDirective.prototype, "zIndex", void 0);
    __decorate([
        Input('is-rtl')
    ], NguiAutoCompleteDirective.prototype, "isRtl", void 0);
    __decorate([
        Output()
    ], NguiAutoCompleteDirective.prototype, "ngModelChange", void 0);
    __decorate([
        Output()
    ], NguiAutoCompleteDirective.prototype, "valueChanged", void 0);
    __decorate([
        Output()
    ], NguiAutoCompleteDirective.prototype, "customSelected", void 0);
    NguiAutoCompleteDirective = __decorate([
        Directive({
            // tslint:disable-next-line:directive-selector
            selector: '[auto-complete], [ngui-auto-complete]'
        }),
        __param(2, Optional()), __param(2, Host()), __param(2, SkipSelf())
    ], NguiAutoCompleteDirective);
    return NguiAutoCompleteDirective;
}());
export { NguiAutoCompleteDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1jb21wbGV0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd1aS9hdXRvLWNvbXBsZXRlLyIsInNvdXJjZXMiOlsibGliL2F1dG8tY29tcGxldGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsYUFBYSxFQUFFLHdCQUF3QixFQUN2QyxZQUFZLEVBQ1osU0FBUyxFQUNULFlBQVksRUFBRSxJQUFJLEVBQ2xCLEtBQUssRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULE1BQU0sRUFBRSxRQUFRLEVBQ2hCLE1BQU0sRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUNsRCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUcsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFNdEU7SUFrREUsbUNBQW9CLFFBQWtDLEVBQ2xDLGdCQUFrQyxFQUNGLFVBQTRCO1FBRmhGLGlCQUlDO1FBSm1CLGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDRixlQUFVLEdBQVYsVUFBVSxDQUFrQjtRQWxEbEQsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFNaEIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFHeEIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFFM0IsZ0JBQVcsR0FBRyxTQUFTLENBQUM7UUFJdkIsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbEIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFDcEIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDaEIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ3JDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ2Ysb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFDbkIs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LE1BQU0sRUFBRTtxRUFBNEM7SUFyQzFDLHlCQUF5QjtRQUpyQyxTQUFTLENBQUM7WUFDVCw4Q0FBOEM7WUFDOUMsUUFBUSxFQUFFLHVDQUF1QztTQUNsRCxDQUFDO1FBcURhLFdBQUEsUUFBUSxFQUFFLENBQUEsRUFBRSxXQUFBLElBQUksRUFBRSxDQUFBLEVBQUUsV0FBQSxRQUFRLEVBQUUsQ0FBQTtPQXBEaEMseUJBQXlCLENBdVdyQztJQUFELGdDQUFDO0NBQUEsQUF2V0QsSUF1V0M7U0F2V1kseUJBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBBZnRlclZpZXdJbml0LCBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXHJcbiAgQ29tcG9uZW50UmVmLFxyXG4gIERpcmVjdGl2ZSxcclxuICBFdmVudEVtaXR0ZXIsIEhvc3QsXHJcbiAgSW5wdXQsXHJcbiAgT25DaGFuZ2VzLFxyXG4gIE9uRGVzdHJveSxcclxuICBPbkluaXQsIE9wdGlvbmFsLFxyXG4gIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgU2tpcFNlbGYsIFZpZXdDb250YWluZXJSZWZcclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sLCBDb250cm9sQ29udGFpbmVyLCBGb3JtQ29udHJvbCwgRm9ybUdyb3VwLCBGb3JtR3JvdXBOYW1lIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xyXG5pbXBvcnQgeyBOZ3VpQXV0b0NvbXBsZXRlQ29tcG9uZW50IH0gZnJvbSAnLi9hdXRvLWNvbXBsZXRlLmNvbXBvbmVudCc7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXHJcbiAgc2VsZWN0b3I6ICdbYXV0by1jb21wbGV0ZV0sIFtuZ3VpLWF1dG8tY29tcGxldGVdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgTmd1aUF1dG9Db21wbGV0ZURpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25DaGFuZ2VzLCBBZnRlclZpZXdJbml0LCBPbkRlc3Ryb3kge1xyXG5cclxuICBASW5wdXQoJ2F1dG9jb21wbGV0ZScpIHB1YmxpYyBhdXRvY29tcGxldGUgPSBmYWxzZTtcclxuICBASW5wdXQoJ2F1dG8tY29tcGxldGUtcGxhY2Vob2xkZXInKSBwdWJsaWMgYXV0b0NvbXBsZXRlUGxhY2Vob2xkZXI6IHN0cmluZztcclxuICBASW5wdXQoJ3NvdXJjZScpIHB1YmxpYyBzb3VyY2U6IGFueTtcclxuICBASW5wdXQoJ3BhdGgtdG8tZGF0YScpIHB1YmxpYyBwYXRoVG9EYXRhOiBzdHJpbmc7XHJcbiAgQElucHV0KCdtaW4tY2hhcnMnKSBwdWJsaWMgbWluQ2hhcnM6IG51bWJlcjtcclxuICBASW5wdXQoJ2Rpc3BsYXktcHJvcGVydHktbmFtZScpIHB1YmxpYyBkaXNwbGF5UHJvcGVydHlOYW1lOiBzdHJpbmc7XHJcbiAgQElucHV0KCdhY2NlcHQtdXNlci1pbnB1dCcpIHB1YmxpYyBhY2NlcHRVc2VySW5wdXQgPSB0cnVlO1xyXG4gIEBJbnB1dCgnbWF4LW51bS1saXN0JykgcHVibGljIG1heE51bUxpc3Q6IHN0cmluZztcclxuICBASW5wdXQoJ3NlbGVjdC12YWx1ZS1vZicpIHB1YmxpYyBzZWxlY3RWYWx1ZU9mOiBzdHJpbmc7XHJcbiAgQElucHV0KCdsb2FkaW5nLXRlbXBsYXRlJykgcHVibGljIGxvYWRpbmdUZW1wbGF0ZSA9IG51bGw7XHJcbiAgQElucHV0KCdsaXN0LWZvcm1hdHRlcicpIHB1YmxpYyBsaXN0Rm9ybWF0dGVyO1xyXG4gIEBJbnB1dCgnbG9hZGluZy10ZXh0JykgcHVibGljIGxvYWRpbmdUZXh0ID0gJ0xvYWRpbmcnO1xyXG4gIEBJbnB1dCgnYmxhbmstb3B0aW9uLXRleHQnKSBwdWJsaWMgYmxhbmtPcHRpb25UZXh0OiBzdHJpbmc7XHJcbiAgQElucHV0KCduby1tYXRjaC1mb3VuZC10ZXh0JykgcHVibGljIG5vTWF0Y2hGb3VuZFRleHQ6IHN0cmluZztcclxuICBASW5wdXQoJ3ZhbHVlLWZvcm1hdHRlcicpIHB1YmxpYyB2YWx1ZUZvcm1hdHRlcjogYW55O1xyXG4gIEBJbnB1dCgndGFiLXRvLXNlbGVjdCcpIHB1YmxpYyB0YWJUb1NlbGVjdCA9IHRydWU7XHJcbiAgQElucHV0KCdzZWxlY3Qtb24tYmx1cicpIHB1YmxpYyBzZWxlY3RPbkJsdXIgPSBmYWxzZTtcclxuICBASW5wdXQoJ21hdGNoLWZvcm1hdHRlZCcpIHB1YmxpYyBtYXRjaEZvcm1hdHRlZCA9IGZhbHNlO1xyXG4gIEBJbnB1dCgnYXV0by1zZWxlY3QtZmlyc3QtaXRlbScpIHB1YmxpYyBhdXRvU2VsZWN0Rmlyc3RJdGVtID0gZmFsc2U7XHJcbiAgQElucHV0KCdvcGVuLW9uLWZvY3VzJykgcHVibGljIG9wZW5PbkZvY3VzID0gdHJ1ZTtcclxuICBASW5wdXQoJ2Nsb3NlLW9uLWZvY3Vzb3V0JykgcHVibGljIGNsb3NlT25Gb2N1c091dCA9IHRydWU7XHJcbiAgQElucHV0KCdyZS1mb2N1cy1hZnRlci1zZWxlY3QnKSBwdWJsaWMgcmVGb2N1c0FmdGVyU2VsZWN0ID0gdHJ1ZTtcclxuICBASW5wdXQoJ2hlYWRlci1pdGVtLXRlbXBsYXRlJykgcHVibGljIGhlYWRlckl0ZW1UZW1wbGF0ZSA9IG51bGw7XHJcbiAgQElucHV0KCdpZ25vcmUtYWNjZW50cycpIHB1YmxpYyBpZ25vcmVBY2NlbnRzID0gdHJ1ZTtcclxuXHJcbiAgQElucHV0KCkgcHVibGljIG5nTW9kZWw6IHN0cmluZztcclxuICBASW5wdXQoJ2Zvcm1Db250cm9sTmFtZScpIHB1YmxpYyBmb3JtQ29udHJvbE5hbWU6IHN0cmluZztcclxuICAvLyBpZiBbZm9ybUNvbnRyb2xdIGlzIHVzZWQgb24gdGhlIGFuY2hvciB3aGVyZSBvdXIgZGlyZWN0aXZlIGlzIHNpdHRpbmdcclxuICAvLyBhIGZvcm0gaXMgbm90IG5lY2Vzc2FyeSB0byB1c2UgYSBmb3JtQ29udHJvbCB3ZSBzaG91bGQgYWxzbyBzdXBwb3J0IHRoaXNcclxuICBASW5wdXQoJ2Zvcm1Db250cm9sJykgcHVibGljIGV4dEZvcm1Db250cm9sOiBGb3JtQ29udHJvbDtcclxuICBASW5wdXQoJ3otaW5kZXgnKSBwdWJsaWMgekluZGV4ID0gJzEnO1xyXG4gIEBJbnB1dCgnaXMtcnRsJykgcHVibGljIGlzUnRsID0gZmFsc2U7XHJcblxyXG4gIEBPdXRwdXQoKSBwdWJsaWMgbmdNb2RlbENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgcHVibGljIHZhbHVlQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuICBAT3V0cHV0KCkgcHVibGljIGN1c3RvbVNlbGVjdGVkID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICBwcml2YXRlIGNvbXBvbmVudFJlZjogQ29tcG9uZW50UmVmPE5ndWlBdXRvQ29tcGxldGVDb21wb25lbnQ+O1xyXG4gIHByaXZhdGUgd3JhcHBlckVsOiBIVE1MRWxlbWVudDtcclxuICBwcml2YXRlIGVsOiBIVE1MRWxlbWVudDsgICAvLyB0aGlzIGVsZW1lbnQgZWxlbWVudCwgY2FuIGJlIGFueVxyXG4gIHByaXZhdGUgYWNEcm9wZG93bkVsOiBIVE1MRWxlbWVudDsgLy8gYXV0byBjb21wbGV0ZSBlbGVtZW50XHJcbiAgcHJpdmF0ZSBpbnB1dEVsOiBIVE1MSW5wdXRFbGVtZW50OyAgLy8gaW5wdXQgZWxlbWVudCBvZiB0aGlzIGVsZW1lbnRcclxuICBwcml2YXRlIGZvcm1Db250cm9sOiBBYnN0cmFjdENvbnRyb2w7XHJcbiAgcHJpdmF0ZSByZXZlcnRWYWx1ZTogYW55O1xyXG4gIHByaXZhdGUgZHJvcGRvd25KdXN0SGlkZGVuOiBib29sZWFuO1xyXG4gIHByaXZhdGUgc2NoZWR1bGVkQmx1ckhhbmRsZXI6IGFueTtcclxuICBwcml2YXRlIGRvY3VtZW50Q2xpY2tMaXN0ZW5lcjogKGU6IE1vdXNlRXZlbnQpID0+IGFueTtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gICAgICAgICAgICAgIHB1YmxpYyAgdmlld0NvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZixcclxuICAgICAgICAgICAgICBAT3B0aW9uYWwoKSBASG9zdCgpIEBTa2lwU2VsZigpIHByaXZhdGUgcGFyZW50Rm9ybTogQ29udHJvbENvbnRhaW5lcikge1xyXG4gICAgdGhpcy5lbCA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgfVxyXG5cclxuICBuZ09uSW5pdCgpOiB2b2lkIHtcclxuICAgIC8vIEJsdXIgZXZlbnQgaXMgaGFuZGxlZCBvbmx5IGFmdGVyIGEgY2xpY2sgZXZlbnQuXHJcbiAgICAvLyBUaGlzIGlzIHRvIHByZXZlbnQgaGFuZGxpbmcgb2YgYmx1ciBldmVudHMgcmVzdWx0aW5nIGZyb20gaW50ZXJhY3Rpbmcgd2l0aCBhIHNjcm9sbGJhclxyXG4gICAgLy8gaW50cm9kdWNlZCBieSBjb250ZW50IG92ZXJmbG93IChJbnRlcm5ldCBleHBsb3JlciBpc3N1ZSkuXHJcbiAgICAvLyBTZWUgaXNzdWUgZGVzY3JpcHRpb24gaGVyZTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMDIzNzc5L2NsaWNraW5nLW9uLWEtZGl2cy1zY3JvbGwtYmFyLWZpcmVzLXRoZS1ibHVyLWV2ZW50LWluLWllXHJcbiAgICB0aGlzLmRvY3VtZW50Q2xpY2tMaXN0ZW5lciA9IChlKSA9PiB7XHJcbiAgICAgIGlmICh0aGlzLnNjaGVkdWxlZEJsdXJIYW5kbGVyKSB7XHJcbiAgICAgICAgdGhpcy5zY2hlZHVsZWRCbHVySGFuZGxlcigpO1xyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVkQmx1ckhhbmRsZXIgPSBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb2N1bWVudENsaWNrTGlzdGVuZXIpO1xyXG4gICAgLy8gd3JhcCB0aGlzIGVsZW1lbnQgd2l0aCA8ZGl2IGNsYXNzPVwibmd1aS1hdXRvLWNvbXBsZXRlXCI+XHJcbiAgICB0aGlzLndyYXBwZXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgdGhpcy53cmFwcGVyRWwuY2xhc3NOYW1lID0gJ25ndWktYXV0by1jb21wbGV0ZS13cmFwcGVyJztcclxuICAgIHRoaXMud3JhcHBlckVsLnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcclxuICAgIHRoaXMuZWwucGFyZW50RWxlbWVudC5pbnNlcnRCZWZvcmUodGhpcy53cmFwcGVyRWwsIHRoaXMuZWwubmV4dFNpYmxpbmcpO1xyXG4gICAgdGhpcy53cmFwcGVyRWwuYXBwZW5kQ2hpbGQodGhpcy5lbCk7XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgd2Ugd2VyZSBzdXBwbGllZCB3aXRoIGEgW2Zvcm1Db250cm9sTmFtZV0gYW5kIGl0IGlzIGluc2lkZSBhIFtmb3JtXVxyXG4gICAgLy8gZWxzZSBjaGVjayBpZiB3ZSBhcmUgc3VwcGxpZWQgd2l0aCBhIFtGb3JtQ29udHJvbF0gcmVnYXJkbGVzcyBpZiBpdCBpcyBpbnNpZGUgYSBbZm9ybV0gdGFnXHJcbiAgICBpZiAodGhpcy5wYXJlbnRGb3JtICYmIHRoaXMuZm9ybUNvbnRyb2xOYW1lKSB7XHJcbiAgICAgIGlmICh0aGlzLnBhcmVudEZvcm1bJ2Zvcm0nXSkge1xyXG4gICAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSAodGhpcy5wYXJlbnRGb3JtWydmb3JtJ10gYXMgRm9ybUdyb3VwKS5nZXQodGhpcy5mb3JtQ29udHJvbE5hbWUpO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMucGFyZW50Rm9ybSBpbnN0YW5jZW9mIEZvcm1Hcm91cE5hbWUpIHtcclxuICAgICAgICB0aGlzLmZvcm1Db250cm9sID0gKHRoaXMucGFyZW50Rm9ybSBhcyBGb3JtR3JvdXBOYW1lKS5jb250cm9sLmNvbnRyb2xzW3RoaXMuZm9ybUNvbnRyb2xOYW1lXTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmICh0aGlzLmV4dEZvcm1Db250cm9sKSB7XHJcbiAgICAgIHRoaXMuZm9ybUNvbnRyb2wgPSB0aGlzLmV4dEZvcm1Db250cm9sO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFwcGx5IHRvU3RyaW5nKCkgbWV0aG9kIGZvciB0aGUgb2JqZWN0XHJcbiAgICBpZiAoISF0aGlzLm5nTW9kZWwpIHtcclxuICAgICAgdGhpcy5zZWxlY3ROZXdWYWx1ZSh0aGlzLm5nTW9kZWwpO1xyXG4gICAgfSBlbHNlIGlmICghIXRoaXMuZm9ybUNvbnRyb2wgJiYgdGhpcy5mb3JtQ29udHJvbC52YWx1ZSkge1xyXG4gICAgICB0aGlzLnNlbGVjdE5ld1ZhbHVlKHRoaXMuZm9ybUNvbnRyb2wudmFsdWUpO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIC8vIGlmIHRoaXMgZWxlbWVudCBpcyBub3QgYW4gaW5wdXQgdGFnLCBtb3ZlIGRyb3Bkb3duIGFmdGVyIGlucHV0IHRhZ1xyXG4gICAgLy8gc28gdGhhdCBpdCBkaXNwbGF5cyBjb3JyZWN0bHlcclxuICAgIHRoaXMuaW5wdXRFbCA9IHRoaXMuZWwudGFnTmFtZSA9PT0gJ0lOUFVUJyA/IHRoaXMuZWwgYXMgSFRNTElucHV0RWxlbWVudCA6IHRoaXMuZWwucXVlcnlTZWxlY3RvcignaW5wdXQnKTtcclxuXHJcbiAgICBpZiAodGhpcy5vcGVuT25Gb2N1cykge1xyXG4gICAgICB0aGlzLmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoZSkgPT4gdGhpcy5zaG93QXV0b0NvbXBsZXRlRHJvcGRvd24oZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLmNsb3NlT25Gb2N1c091dCkge1xyXG4gICAgICB0aGlzLmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXNvdXQnLCAoZSkgPT4gdGhpcy5oaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24oZSkpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghdGhpcy5hdXRvY29tcGxldGUpIHtcclxuICAgICAgdGhpcy5pbnB1dEVsLnNldEF0dHJpYnV0ZSgnYXV0b2NvbXBsZXRlJywgJ29mZicpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoZSkgPT4ge1xyXG4gICAgICB0aGlzLnNjaGVkdWxlZEJsdXJIYW5kbGVyID0gKCkgPT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJsdXJIYW5kbGVyKGUpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgICB0aGlzLmlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB0aGlzLmtleWRvd25FdmVudEhhbmRsZXIoZSkpO1xyXG4gICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGUpID0+IHRoaXMuaW5wdXRFdmVudEhhbmRsZXIoZSkpO1xyXG4gIH1cclxuXHJcbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UudmFsdWVTZWxlY3RlZC51bnN1YnNjcmliZSgpO1xyXG4gICAgICB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS50ZXh0RW50ZXJlZC51bnN1YnNjcmliZSgpO1xyXG4gICAgfVxyXG4gICAgaWYgKHRoaXMuZG9jdW1lbnRDbGlja0xpc3RlbmVyKSB7XHJcbiAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5kb2N1bWVudENsaWNrTGlzdGVuZXIpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogU2ltcGxlQ2hhbmdlcyk6IHZvaWQge1xyXG4gICAgaWYgKGNoYW5nZXNbJ25nTW9kZWwnXSkge1xyXG4gICAgICB0aGlzLm5nTW9kZWwgPSB0aGlzLnNldFRvU3RyaW5nRnVuY3Rpb24oY2hhbmdlc1snbmdNb2RlbCddLmN1cnJlbnRWYWx1ZSk7XHJcbiAgICAgIHRoaXMucmVuZGVyVmFsdWUodGhpcy5uZ01vZGVsKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8vIHNob3cgYXV0by1jb21wbGV0ZSBsaXN0IGJlbG93IHRoZSBjdXJyZW50IGVsZW1lbnRcclxuICBwdWJsaWMgc2hvd0F1dG9Db21wbGV0ZURyb3Bkb3duID0gKGV2ZW50PzogYW55KTogdm9pZCA9PiB7XHJcbiAgICBpZiAodGhpcy5kcm9wZG93bkp1c3RIaWRkZW4pIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdGhpcy5oaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24oKTtcclxuICAgIHRoaXMuc2NoZWR1bGVkQmx1ckhhbmRsZXIgPSBudWxsO1xyXG5cclxuICAgIGNvbnN0IGZhY3RvcnkgPSB0aGlzLnJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KE5ndWlBdXRvQ29tcGxldGVDb21wb25lbnQpO1xyXG5cclxuICAgIHRoaXMuY29tcG9uZW50UmVmID0gdGhpcy52aWV3Q29udGFpbmVyUmVmLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcclxuXHJcbiAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgIGNvbXBvbmVudC5rZXl3b3JkID0gdGhpcy5pbnB1dEVsLnZhbHVlO1xyXG4gICAgY29tcG9uZW50LnNob3dJbnB1dFRhZyA9IGZhbHNlOyAvLyBEbyBOT1QgZGlzcGxheSBhdXRvY29tcGxldGUgaW5wdXQgdGFnIHNlcGFyYXRlbHlcclxuXHJcbiAgICBjb21wb25lbnQucGF0aFRvRGF0YSA9IHRoaXMucGF0aFRvRGF0YTtcclxuICAgIGNvbXBvbmVudC5taW5DaGFycyA9IHRoaXMubWluQ2hhcnM7XHJcbiAgICBjb21wb25lbnQuc291cmNlID0gdGhpcy5zb3VyY2U7XHJcbiAgICBjb21wb25lbnQucGxhY2Vob2xkZXIgPSB0aGlzLmF1dG9Db21wbGV0ZVBsYWNlaG9sZGVyO1xyXG4gICAgY29tcG9uZW50LmFjY2VwdFVzZXJJbnB1dCA9IHRoaXMuYWNjZXB0VXNlcklucHV0O1xyXG4gICAgY29tcG9uZW50Lm1heE51bUxpc3QgPSBwYXJzZUludCh0aGlzLm1heE51bUxpc3QsIDEwKTtcclxuXHJcbiAgICBjb21wb25lbnQubG9hZGluZ1RleHQgPSB0aGlzLmxvYWRpbmdUZXh0O1xyXG4gICAgY29tcG9uZW50LmxvYWRpbmdUZW1wbGF0ZSA9IHRoaXMubG9hZGluZ1RlbXBsYXRlO1xyXG4gICAgY29tcG9uZW50Lmxpc3RGb3JtYXR0ZXIgPSB0aGlzLmxpc3RGb3JtYXR0ZXI7XHJcbiAgICBjb21wb25lbnQuYmxhbmtPcHRpb25UZXh0ID0gdGhpcy5ibGFua09wdGlvblRleHQ7XHJcbiAgICBjb21wb25lbnQubm9NYXRjaEZvdW5kVGV4dCA9IHRoaXMubm9NYXRjaEZvdW5kVGV4dDtcclxuICAgIGNvbXBvbmVudC50YWJUb1NlbGVjdCA9IHRoaXMudGFiVG9TZWxlY3Q7XHJcbiAgICBjb21wb25lbnQuc2VsZWN0T25CbHVyID0gdGhpcy5zZWxlY3RPbkJsdXI7XHJcbiAgICBjb21wb25lbnQubWF0Y2hGb3JtYXR0ZWQgPSB0aGlzLm1hdGNoRm9ybWF0dGVkO1xyXG4gICAgY29tcG9uZW50LmF1dG9TZWxlY3RGaXJzdEl0ZW0gPSB0aGlzLmF1dG9TZWxlY3RGaXJzdEl0ZW07XHJcbiAgICBjb21wb25lbnQuaGVhZGVySXRlbVRlbXBsYXRlID0gdGhpcy5oZWFkZXJJdGVtVGVtcGxhdGU7XHJcbiAgICBjb21wb25lbnQuaWdub3JlQWNjZW50cyA9IHRoaXMuaWdub3JlQWNjZW50cztcclxuXHJcbiAgICBjb21wb25lbnQudmFsdWVTZWxlY3RlZC5zdWJzY3JpYmUodGhpcy5zZWxlY3ROZXdWYWx1ZSk7XHJcbiAgICBjb21wb25lbnQudGV4dEVudGVyZWQuc3Vic2NyaWJlKHRoaXMuZW50ZXJOZXdUZXh0KTtcclxuICAgIGNvbXBvbmVudC5jdXN0b21TZWxlY3RlZC5zdWJzY3JpYmUodGhpcy5zZWxlY3RDdXN0b21WYWx1ZSk7XHJcblxyXG4gICAgdGhpcy5hY0Ryb3Bkb3duRWwgPSB0aGlzLmNvbXBvbmVudFJlZi5sb2NhdGlvbi5uYXRpdmVFbGVtZW50O1xyXG4gICAgdGhpcy5hY0Ryb3Bkb3duRWwuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuXHJcbiAgICAvLyBpZiB0aGlzIGVsZW1lbnQgaXMgbm90IGFuIGlucHV0IHRhZywgbW92ZSBkcm9wZG93biBhZnRlciBpbnB1dCB0YWdcclxuICAgIC8vIHNvIHRoYXQgaXQgZGlzcGxheXMgY29ycmVjdGx5XHJcblxyXG4gICAgLy8gVE9ETzogY29uZmlybSB3aXRoIG93bmVyc1xyXG4gICAgLy8gd2l0aCBzb21lIHJlYXNvbiwgdmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQgaXMgY3JlYXRpbmcgZWxlbWVudFxyXG4gICAgLy8gdG8gcGFyZW50IGRpdiB3aGljaCBpcyBjcmVhdGVkIGJ5IHVzIG9uIG5nT25Jbml0LCBwbGVhc2UgdHJ5IHRoaXMgd2l0aCBkZW1vXHJcblxyXG4gICAgLy8gaWYgKHRoaXMuZWwudGFnTmFtZSAhPT0gJ0lOUFVUJyAmJiB0aGlzLmFjRHJvcGRvd25FbCkge1xyXG4gICAgdGhpcy5pbnB1dEVsLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKHRoaXMuYWNEcm9wZG93bkVsLCB0aGlzLmlucHV0RWwubmV4dFNpYmxpbmcpO1xyXG4gICAgLy8gfVxyXG4gICAgdGhpcy5yZXZlcnRWYWx1ZSA9IHR5cGVvZiB0aGlzLm5nTW9kZWwgIT09ICd1bmRlZmluZWQnID8gdGhpcy5uZ01vZGVsIDogdGhpcy5pbnB1dEVsLnZhbHVlO1xyXG5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBjb21wb25lbnQucmVsb2FkTGlzdCh0aGlzLmlucHV0RWwudmFsdWUpO1xyXG4gICAgICB0aGlzLnN0eWxlQXV0b0NvbXBsZXRlRHJvcGRvd24oKTtcclxuICAgICAgY29tcG9uZW50LmRyb3Bkb3duVmlzaWJsZSA9IHRydWU7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBibHVySGFuZGxlcihldmVudDogYW55KSB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcblxyXG4gICAgICBpZiAodGhpcy5zZWxlY3RPbkJsdXIpIHtcclxuICAgICAgICBjb21wb25lbnQuc2VsZWN0T25lKGNvbXBvbmVudC5maWx0ZXJlZExpc3RbY29tcG9uZW50Lml0ZW1JbmRleF0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5jbG9zZU9uRm9jdXNPdXQpIHtcclxuICAgICAgICB0aGlzLmhpZGVBdXRvQ29tcGxldGVEcm9wZG93bihldmVudCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBoaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24gPSAoZXZlbnQ/OiBhbnkpOiB2b2lkID0+IHtcclxuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xyXG4gICAgICBsZXQgY3VycmVudEl0ZW06IGFueTtcclxuICAgICAgY29uc3QgaGFzUmV2ZXJ0VmFsdWUgPSAodHlwZW9mIHRoaXMucmV2ZXJ0VmFsdWUgIT09ICd1bmRlZmluZWQnKTtcclxuICAgICAgaWYgKHRoaXMuaW5wdXRFbCAmJiBoYXNSZXZlcnRWYWx1ZSAmJiB0aGlzLmFjY2VwdFVzZXJJbnB1dCA9PT0gZmFsc2UpIHtcclxuICAgICAgICBjdXJyZW50SXRlbSA9IHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLmZpbmRJdGVtRnJvbVNlbGVjdFZhbHVlKHRoaXMuaW5wdXRFbC52YWx1ZSk7XHJcbiAgICAgIH1cclxuICAgICAgdGhpcy5jb21wb25lbnRSZWYuZGVzdHJveSgpO1xyXG4gICAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHVuZGVmaW5lZDtcclxuXHJcbiAgICAgIGlmICh0aGlzLmlucHV0RWwgJiYgaGFzUmV2ZXJ0VmFsdWUgJiYgdGhpcy5hY2NlcHRVc2VySW5wdXQgPT09IGZhbHNlICYmIGN1cnJlbnRJdGVtID09PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3ROZXdWYWx1ZSh0aGlzLnJldmVydFZhbHVlKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmlucHV0RWwgJiYgdGhpcy5hY2NlcHRVc2VySW5wdXQgPT09IHRydWUgJiYgdHlwZW9mIGN1cnJlbnRJdGVtID09PSAndW5kZWZpbmVkJyAmJiBldmVudCAmJiBldmVudC50YXJnZXQudmFsdWUpIHtcclxuICAgICAgICB0aGlzLmVudGVyTmV3VGV4dChldmVudC50YXJnZXQudmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICB0aGlzLmRyb3Bkb3duSnVzdEhpZGRlbiA9IHRydWU7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuZHJvcGRvd25KdXN0SGlkZGVuID0gZmFsc2UsIDEwMCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3R5bGVBdXRvQ29tcGxldGVEcm9wZG93biA9ICgpID0+IHtcclxuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xyXG4gICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuXHJcbiAgICAgIC8qIHNldHRpbmcgd2lkdGgvaGVpZ2h0IGF1dG8gY29tcGxldGUgKi9cclxuICAgICAgY29uc3QgdGhpc0VsQkNSID0gdGhpcy5lbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcclxuICAgICAgY29uc3QgdGhpc0lucHV0RWxCQ1IgPSB0aGlzLmlucHV0RWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgIGNvbnN0IGNsb3NlVG9Cb3R0b20gPSB0aGlzSW5wdXRFbEJDUi5ib3R0b20gKyAxMDAgPiB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgIGNvbnN0IGRpcmVjdGlvbk9mU3R5bGUgPSB0aGlzLmlzUnRsID8gJ3JpZ2h0JyA6ICdsZWZ0JztcclxuXHJcbiAgICAgIHRoaXMuYWNEcm9wZG93bkVsLnN0eWxlLndpZHRoID0gdGhpc0lucHV0RWxCQ1Iud2lkdGggKyAncHgnO1xyXG4gICAgICB0aGlzLmFjRHJvcGRvd25FbC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XHJcbiAgICAgIHRoaXMuYWNEcm9wZG93bkVsLnN0eWxlLnpJbmRleCA9IHRoaXMuekluZGV4O1xyXG4gICAgICB0aGlzLmFjRHJvcGRvd25FbC5zdHlsZVtkaXJlY3Rpb25PZlN0eWxlXSA9ICcwJztcclxuICAgICAgdGhpcy5hY0Ryb3Bkb3duRWwuc3R5bGUuZGlzcGxheSA9ICdpbmxpbmUtYmxvY2snO1xyXG5cclxuICAgICAgaWYgKGNsb3NlVG9Cb3R0b20pIHtcclxuICAgICAgICB0aGlzLmFjRHJvcGRvd25FbC5zdHlsZS5ib3R0b20gPSBgJHt0aGlzSW5wdXRFbEJDUi5oZWlnaHR9cHhgO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYWNEcm9wZG93bkVsLnN0eWxlLnRvcCA9IGAke3RoaXNJbnB1dEVsQkNSLmhlaWdodH1weGA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRUb1N0cmluZ0Z1bmN0aW9uKGl0ZW06IGFueSk6IGFueSB7XHJcbiAgICBpZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgbGV0IGRpc3BsYXlWYWw7XHJcblxyXG4gICAgICBpZiAodHlwZW9mIHRoaXMudmFsdWVGb3JtYXR0ZXIgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IHRoaXMudmFsdWVGb3JtYXR0ZXIubWF0Y2goL1thLXpBLVowLTlfXFwkXSsvZyk7XHJcbiAgICAgICAgbGV0IGZvcm1hdHRlZCA9IHRoaXMudmFsdWVGb3JtYXR0ZXI7XHJcbiAgICAgICAgaWYgKG1hdGNoZXMgJiYgdHlwZW9mIGl0ZW0gIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICBtYXRjaGVzLmZvckVhY2goKGtleSkgPT4ge1xyXG4gICAgICAgICAgICBmb3JtYXR0ZWQgPSBmb3JtYXR0ZWQucmVwbGFjZShrZXksIGl0ZW1ba2V5XSk7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZGlzcGxheVZhbCA9IGZvcm1hdHRlZDtcclxuICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdGhpcy52YWx1ZUZvcm1hdHRlciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIGRpc3BsYXlWYWwgPSB0aGlzLnZhbHVlRm9ybWF0dGVyKGl0ZW0pO1xyXG4gICAgICB9IGVsc2UgaWYgKHRoaXMuZGlzcGxheVByb3BlcnR5TmFtZSkge1xyXG4gICAgICAgIGRpc3BsYXlWYWwgPSBpdGVtW3RoaXMuZGlzcGxheVByb3BlcnR5TmFtZV07XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMubGlzdEZvcm1hdHRlciA9PT0gJ3N0cmluZycgJiYgdGhpcy5saXN0Rm9ybWF0dGVyLm1hdGNoKC9eXFx3KyQvKSkge1xyXG4gICAgICAgIGRpc3BsYXlWYWwgPSBpdGVtW3RoaXMubGlzdEZvcm1hdHRlcl07XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZGlzcGxheVZhbCA9IGl0ZW0udmFsdWU7XHJcbiAgICAgIH1cclxuICAgICAgaXRlbS50b1N0cmluZyA9ICgpID0+IGRpc3BsYXlWYWw7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlbTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZWxlY3ROZXdWYWx1ZSA9IChpdGVtOiBhbnkpID0+IHtcclxuICAgIC8vIG1ha2UgZGlzcGxheWFibGUgdmFsdWVcclxuICAgIGlmIChpdGVtICYmIHR5cGVvZiBpdGVtID09PSAnb2JqZWN0Jykge1xyXG4gICAgICBpdGVtID0gdGhpcy5zZXRUb1N0cmluZ0Z1bmN0aW9uKGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMucmVuZGVyVmFsdWUoaXRlbSk7XHJcblxyXG4gICAgLy8gbWFrZSByZXR1cm4gdmFsdWVcclxuICAgIGxldCB2YWwgPSBpdGVtO1xyXG4gICAgaWYgKHRoaXMuc2VsZWN0VmFsdWVPZiAmJiBpdGVtW3RoaXMuc2VsZWN0VmFsdWVPZl0pIHtcclxuICAgICAgdmFsID0gaXRlbVt0aGlzLnNlbGVjdFZhbHVlT2ZdO1xyXG4gICAgfVxyXG4gICAgaWYgKCh0aGlzLnBhcmVudEZvcm0gJiYgdGhpcy5mb3JtQ29udHJvbE5hbWUpIHx8IHRoaXMuZXh0Rm9ybUNvbnRyb2wpIHtcclxuICAgICAgaWYgKCEhdmFsKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtQ29udHJvbC5wYXRjaFZhbHVlKHZhbCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIGlmICh2YWwgIT09IHRoaXMubmdNb2RlbCkge1xyXG4gICAgICB0aGlzLm5nTW9kZWxDaGFuZ2UuZW1pdCh2YWwpO1xyXG4gICAgfVxyXG4gICAgdGhpcy52YWx1ZUNoYW5nZWQuZW1pdCh2YWwpO1xyXG4gICAgdGhpcy5oaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24oKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5yZUZvY3VzQWZ0ZXJTZWxlY3QpIHtcclxuICAgICAgICB0aGlzLmlucHV0RWwuZm9jdXMoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuaW5wdXRFbDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNlbGVjdEN1c3RvbVZhbHVlID0gKHRleHQ6IHN0cmluZykgPT4ge1xyXG4gICAgdGhpcy5jdXN0b21TZWxlY3RlZC5lbWl0KHRleHQpO1xyXG4gICAgdGhpcy5oaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24oKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5yZUZvY3VzQWZ0ZXJTZWxlY3QpIHtcclxuICAgICAgICB0aGlzLmlucHV0RWwuZm9jdXMoKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgcmV0dXJuIHRoaXMuaW5wdXRFbDtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGVudGVyTmV3VGV4dCA9ICh2YWx1ZTogYW55KSA9PiB7XHJcbiAgICB0aGlzLnJlbmRlclZhbHVlKHZhbHVlKTtcclxuICAgIHRoaXMubmdNb2RlbENoYW5nZS5lbWl0KHZhbHVlKTtcclxuICAgIHRoaXMudmFsdWVDaGFuZ2VkLmVtaXQodmFsdWUpO1xyXG4gICAgdGhpcy5oaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24oKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUga2V5ZG93bkV2ZW50SGFuZGxlciA9IChldnQ6IGFueSkgPT4ge1xyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG4gICAgICBjb21wb25lbnQuaW5wdXRFbEtleUhhbmRsZXIoZXZ0KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgaW5wdXRFdmVudEhhbmRsZXIgPSAoZXZ0OiBhbnkpID0+IHtcclxuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xyXG4gICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgY29tcG9uZW50LmRyb3Bkb3duVmlzaWJsZSA9IHRydWU7XHJcbiAgICAgIGNvbXBvbmVudC5rZXl3b3JkID0gZXZ0LnRhcmdldC52YWx1ZTtcclxuICAgICAgY29tcG9uZW50LnJlbG9hZExpc3RJbkRlbGF5KGV2dCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnNob3dBdXRvQ29tcGxldGVEcm9wZG93bigpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW5kZXJWYWx1ZShpdGVtOiBhbnkpIHtcclxuICAgIGlmICghIXRoaXMuaW5wdXRFbCkge1xyXG4gICAgICB0aGlzLmlucHV0RWwudmFsdWUgPSAnJyArIGl0ZW07XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==