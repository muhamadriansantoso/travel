import { __decorate, __param } from "tslib";
import { AfterViewInit, ComponentFactoryResolver, ComponentRef, Directive, EventEmitter, Host, Input, OnChanges, OnDestroy, OnInit, Optional, Output, SimpleChanges, SkipSelf, ViewContainerRef } from '@angular/core';
import { AbstractControl, ControlContainer, FormControl, FormGroup, FormGroupName } from '@angular/forms';
import { NguiAutoCompleteComponent } from './auto-complete.component';
let NguiAutoCompleteDirective = class NguiAutoCompleteDirective {
    constructor(resolver, viewContainerRef, parentForm) {
        this.resolver = resolver;
        this.viewContainerRef = viewContainerRef;
        this.parentForm = parentForm;
        this.autocomplete = false;
        this.acceptUserInput = true;
        this.loadingTemplate = null;
        this.loadingText = 'Loading';
        this.tabToSelect = true;
        this.selectOnBlur = false;
        this.matchFormatted = false;
        this.autoSelectFirstItem = false;
        this.openOnFocus = true;
        this.closeOnFocusOut = true;
        this.reFocusAfterSelect = true;
        this.headerItemTemplate = null;
        this.ignoreAccents = true;
        this.zIndex = '1';
        this.isRtl = false;
        this.ngModelChange = new EventEmitter();
        this.valueChanged = new EventEmitter();
        this.customSelected = new EventEmitter();
        // show auto-complete list below the current element
        this.showAutoCompleteDropdown = (event) => {
            if (this.dropdownJustHidden) {
                return;
            }
            this.hideAutoCompleteDropdown();
            this.scheduledBlurHandler = null;
            const factory = this.resolver.resolveComponentFactory(NguiAutoCompleteComponent);
            this.componentRef = this.viewContainerRef.createComponent(factory);
            const component = this.componentRef.instance;
            component.keyword = this.inputEl.value;
            component.showInputTag = false; // Do NOT display autocomplete input tag separately
            component.pathToData = this.pathToData;
            component.minChars = this.minChars;
            component.source = this.source;
            component.placeholder = this.autoCompletePlaceholder;
            component.acceptUserInput = this.acceptUserInput;
            component.maxNumList = parseInt(this.maxNumList, 10);
            component.loadingText = this.loadingText;
            component.loadingTemplate = this.loadingTemplate;
            component.listFormatter = this.listFormatter;
            component.blankOptionText = this.blankOptionText;
            component.noMatchFoundText = this.noMatchFoundText;
            component.tabToSelect = this.tabToSelect;
            component.selectOnBlur = this.selectOnBlur;
            component.matchFormatted = this.matchFormatted;
            component.autoSelectFirstItem = this.autoSelectFirstItem;
            component.headerItemTemplate = this.headerItemTemplate;
            component.ignoreAccents = this.ignoreAccents;
            component.valueSelected.subscribe(this.selectNewValue);
            component.textEntered.subscribe(this.enterNewText);
            component.customSelected.subscribe(this.selectCustomValue);
            this.acDropdownEl = this.componentRef.location.nativeElement;
            this.acDropdownEl.style.display = 'none';
            // if this element is not an input tag, move dropdown after input tag
            // so that it displays correctly
            // TODO: confirm with owners
            // with some reason, viewContainerRef.createComponent is creating element
            // to parent div which is created by us on ngOnInit, please try this with demo
            // if (this.el.tagName !== 'INPUT' && this.acDropdownEl) {
            this.inputEl.parentElement.insertBefore(this.acDropdownEl, this.inputEl.nextSibling);
            // }
            this.revertValue = typeof this.ngModel !== 'undefined' ? this.ngModel : this.inputEl.value;
            setTimeout(() => {
                component.reloadList(this.inputEl.value);
                this.styleAutoCompleteDropdown();
                component.dropdownVisible = true;
            });
        };
        this.hideAutoCompleteDropdown = (event) => {
            if (this.componentRef) {
                let currentItem;
                const hasRevertValue = (typeof this.revertValue !== 'undefined');
                if (this.inputEl && hasRevertValue && this.acceptUserInput === false) {
                    currentItem = this.componentRef.instance.findItemFromSelectValue(this.inputEl.value);
                }
                this.componentRef.destroy();
                this.componentRef = undefined;
                if (this.inputEl && hasRevertValue && this.acceptUserInput === false && currentItem === null) {
                    this.selectNewValue(this.revertValue);
                }
                else if (this.inputEl && this.acceptUserInput === true && typeof currentItem === 'undefined' && event && event.target.value) {
                    this.enterNewText(event.target.value);
                }
            }
            this.dropdownJustHidden = true;
            setTimeout(() => this.dropdownJustHidden = false, 100);
        };
        this.styleAutoCompleteDropdown = () => {
            if (this.componentRef) {
                const component = this.componentRef.instance;
                /* setting width/height auto complete */
                const thisElBCR = this.el.getBoundingClientRect();
                const thisInputElBCR = this.inputEl.getBoundingClientRect();
                const closeToBottom = thisInputElBCR.bottom + 100 > window.innerHeight;
                const directionOfStyle = this.isRtl ? 'right' : 'left';
                this.acDropdownEl.style.width = thisInputElBCR.width + 'px';
                this.acDropdownEl.style.position = 'absolute';
                this.acDropdownEl.style.zIndex = this.zIndex;
                this.acDropdownEl.style[directionOfStyle] = '0';
                this.acDropdownEl.style.display = 'inline-block';
                if (closeToBottom) {
                    this.acDropdownEl.style.bottom = `${thisInputElBCR.height}px`;
                }
                else {
                    this.acDropdownEl.style.top = `${thisInputElBCR.height}px`;
                }
            }
        };
        this.selectNewValue = (item) => {
            // make displayable value
            if (item && typeof item === 'object') {
                item = this.setToStringFunction(item);
            }
            this.renderValue(item);
            // make return value
            let val = item;
            if (this.selectValueOf && item[this.selectValueOf]) {
                val = item[this.selectValueOf];
            }
            if ((this.parentForm && this.formControlName) || this.extFormControl) {
                if (!!val) {
                    this.formControl.patchValue(val);
                }
            }
            if (val !== this.ngModel) {
                this.ngModelChange.emit(val);
            }
            this.valueChanged.emit(val);
            this.hideAutoCompleteDropdown();
            setTimeout(() => {
                if (this.reFocusAfterSelect) {
                    this.inputEl.focus();
                }
                return this.inputEl;
            });
        };
        this.selectCustomValue = (text) => {
            this.customSelected.emit(text);
            this.hideAutoCompleteDropdown();
            setTimeout(() => {
                if (this.reFocusAfterSelect) {
                    this.inputEl.focus();
                }
                return this.inputEl;
            });
        };
        this.enterNewText = (value) => {
            this.renderValue(value);
            this.ngModelChange.emit(value);
            this.valueChanged.emit(value);
            this.hideAutoCompleteDropdown();
        };
        this.keydownEventHandler = (evt) => {
            if (this.componentRef) {
                const component = this.componentRef.instance;
                component.inputElKeyHandler(evt);
            }
        };
        this.inputEventHandler = (evt) => {
            if (this.componentRef) {
                const component = this.componentRef.instance;
                component.dropdownVisible = true;
                component.keyword = evt.target.value;
                component.reloadListInDelay(evt);
            }
            else {
                this.showAutoCompleteDropdown();
            }
        };
        this.el = this.viewContainerRef.element.nativeElement;
    }
    ngOnInit() {
        // Blur event is handled only after a click event.
        // This is to prevent handling of blur events resulting from interacting with a scrollbar
        // introduced by content overflow (Internet explorer issue).
        // See issue description here: http://stackoverflow.com/questions/2023779/clicking-on-a-divs-scroll-bar-fires-the-blur-event-in-ie
        this.documentClickListener = (e) => {
            if (this.scheduledBlurHandler) {
                this.scheduledBlurHandler();
                this.scheduledBlurHandler = null;
            }
        };
        document.addEventListener('click', this.documentClickListener);
        // wrap this element with <div class="ngui-auto-complete">
        this.wrapperEl = document.createElement('div');
        this.wrapperEl.className = 'ngui-auto-complete-wrapper';
        this.wrapperEl.style.position = 'relative';
        this.el.parentElement.insertBefore(this.wrapperEl, this.el.nextSibling);
        this.wrapperEl.appendChild(this.el);
        // Check if we were supplied with a [formControlName] and it is inside a [form]
        // else check if we are supplied with a [FormControl] regardless if it is inside a [form] tag
        if (this.parentForm && this.formControlName) {
            if (this.parentForm['form']) {
                this.formControl = this.parentForm['form'].get(this.formControlName);
            }
            else if (this.parentForm instanceof FormGroupName) {
                this.formControl = this.parentForm.control.controls[this.formControlName];
            }
        }
        else if (this.extFormControl) {
            this.formControl = this.extFormControl;
        }
        // apply toString() method for the object
        if (!!this.ngModel) {
            this.selectNewValue(this.ngModel);
        }
        else if (!!this.formControl && this.formControl.value) {
            this.selectNewValue(this.formControl.value);
        }
    }
    ngAfterViewInit() {
        // if this element is not an input tag, move dropdown after input tag
        // so that it displays correctly
        this.inputEl = this.el.tagName === 'INPUT' ? this.el : this.el.querySelector('input');
        if (this.openOnFocus) {
            this.inputEl.addEventListener('focus', (e) => this.showAutoCompleteDropdown(e));
        }
        if (this.closeOnFocusOut) {
            this.inputEl.addEventListener('focusout', (e) => this.hideAutoCompleteDropdown(e));
        }
        if (!this.autocomplete) {
            this.inputEl.setAttribute('autocomplete', 'off');
        }
        this.inputEl.addEventListener('blur', (e) => {
            this.scheduledBlurHandler = () => {
                return this.blurHandler(e);
            };
        });
        this.inputEl.addEventListener('keydown', (e) => this.keydownEventHandler(e));
        this.inputEl.addEventListener('input', (e) => this.inputEventHandler(e));
    }
    ngOnDestroy() {
        if (this.componentRef) {
            this.componentRef.instance.valueSelected.unsubscribe();
            this.componentRef.instance.textEntered.unsubscribe();
        }
        if (this.documentClickListener) {
            document.removeEventListener('click', this.documentClickListener);
        }
    }
    ngOnChanges(changes) {
        if (changes['ngModel']) {
            this.ngModel = this.setToStringFunction(changes['ngModel'].currentValue);
            this.renderValue(this.ngModel);
        }
    }
    blurHandler(event) {
        if (this.componentRef) {
            const component = this.componentRef.instance;
            if (this.selectOnBlur) {
                component.selectOne(component.filteredList[component.itemIndex]);
            }
            if (this.closeOnFocusOut) {
                this.hideAutoCompleteDropdown(event);
            }
        }
    }
    setToStringFunction(item) {
        if (item && typeof item === 'object') {
            let displayVal;
            if (typeof this.valueFormatter === 'string') {
                const matches = this.valueFormatter.match(/[a-zA-Z0-9_\$]+/g);
                let formatted = this.valueFormatter;
                if (matches && typeof item !== 'string') {
                    matches.forEach((key) => {
                        formatted = formatted.replace(key, item[key]);
                    });
                }
                displayVal = formatted;
            }
            else if (typeof this.valueFormatter === 'function') {
                displayVal = this.valueFormatter(item);
            }
            else if (this.displayPropertyName) {
                displayVal = item[this.displayPropertyName];
            }
            else if (typeof this.listFormatter === 'string' && this.listFormatter.match(/^\w+$/)) {
                displayVal = item[this.listFormatter];
            }
            else {
                displayVal = item.value;
            }
            item.toString = () => displayVal;
        }
        return item;
    }
    renderValue(item) {
        if (!!this.inputEl) {
            this.inputEl.value = '' + item;
        }
    }
};
NguiAutoCompleteDirective.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: ViewContainerRef },
    { type: ControlContainer, decorators: [{ type: Optional }, { type: Host }, { type: SkipSelf }] }
];
__decorate([
    Input('autocomplete')
], NguiAutoCompleteDirective.prototype, "autocomplete", void 0);
__decorate([
    Input('auto-complete-placeholder')
], NguiAutoCompleteDirective.prototype, "autoCompletePlaceholder", void 0);
__decorate([
    Input('source')
], NguiAutoCompleteDirective.prototype, "source", void 0);
__decorate([
    Input('path-to-data')
], NguiAutoCompleteDirective.prototype, "pathToData", void 0);
__decorate([
    Input('min-chars')
], NguiAutoCompleteDirective.prototype, "minChars", void 0);
__decorate([
    Input('display-property-name')
], NguiAutoCompleteDirective.prototype, "displayPropertyName", void 0);
__decorate([
    Input('accept-user-input')
], NguiAutoCompleteDirective.prototype, "acceptUserInput", void 0);
__decorate([
    Input('max-num-list')
], NguiAutoCompleteDirective.prototype, "maxNumList", void 0);
__decorate([
    Input('select-value-of')
], NguiAutoCompleteDirective.prototype, "selectValueOf", void 0);
__decorate([
    Input('loading-template')
], NguiAutoCompleteDirective.prototype, "loadingTemplate", void 0);
__decorate([
    Input('list-formatter')
], NguiAutoCompleteDirective.prototype, "listFormatter", void 0);
__decorate([
    Input('loading-text')
], NguiAutoCompleteDirective.prototype, "loadingText", void 0);
__decorate([
    Input('blank-option-text')
], NguiAutoCompleteDirective.prototype, "blankOptionText", void 0);
__decorate([
    Input('no-match-found-text')
], NguiAutoCompleteDirective.prototype, "noMatchFoundText", void 0);
__decorate([
    Input('value-formatter')
], NguiAutoCompleteDirective.prototype, "valueFormatter", void 0);
__decorate([
    Input('tab-to-select')
], NguiAutoCompleteDirective.prototype, "tabToSelect", void 0);
__decorate([
    Input('select-on-blur')
], NguiAutoCompleteDirective.prototype, "selectOnBlur", void 0);
__decorate([
    Input('match-formatted')
], NguiAutoCompleteDirective.prototype, "matchFormatted", void 0);
__decorate([
    Input('auto-select-first-item')
], NguiAutoCompleteDirective.prototype, "autoSelectFirstItem", void 0);
__decorate([
    Input('open-on-focus')
], NguiAutoCompleteDirective.prototype, "openOnFocus", void 0);
__decorate([
    Input('close-on-focusout')
], NguiAutoCompleteDirective.prototype, "closeOnFocusOut", void 0);
__decorate([
    Input('re-focus-after-select')
], NguiAutoCompleteDirective.prototype, "reFocusAfterSelect", void 0);
__decorate([
    Input('header-item-template')
], NguiAutoCompleteDirective.prototype, "headerItemTemplate", void 0);
__decorate([
    Input('ignore-accents')
], NguiAutoCompleteDirective.prototype, "ignoreAccents", void 0);
__decorate([
    Input()
], NguiAutoCompleteDirective.prototype, "ngModel", void 0);
__decorate([
    Input('formControlName')
], NguiAutoCompleteDirective.prototype, "formControlName", void 0);
__decorate([
    Input('formControl')
], NguiAutoCompleteDirective.prototype, "extFormControl", void 0);
__decorate([
    Input('z-index')
], NguiAutoCompleteDirective.prototype, "zIndex", void 0);
__decorate([
    Input('is-rtl')
], NguiAutoCompleteDirective.prototype, "isRtl", void 0);
__decorate([
    Output()
], NguiAutoCompleteDirective.prototype, "ngModelChange", void 0);
__decorate([
    Output()
], NguiAutoCompleteDirective.prototype, "valueChanged", void 0);
__decorate([
    Output()
], NguiAutoCompleteDirective.prototype, "customSelected", void 0);
NguiAutoCompleteDirective = __decorate([
    Directive({
        // tslint:disable-next-line:directive-selector
        selector: '[auto-complete], [ngui-auto-complete]'
    }),
    __param(2, Optional()), __param(2, Host()), __param(2, SkipSelf())
], NguiAutoCompleteDirective);
export { NguiAutoCompleteDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0by1jb21wbGV0ZS5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd1aS9hdXRvLWNvbXBsZXRlLyIsInNvdXJjZXMiOlsibGliL2F1dG8tY29tcGxldGUuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQ0wsYUFBYSxFQUFFLHdCQUF3QixFQUN2QyxZQUFZLEVBQ1osU0FBUyxFQUNULFlBQVksRUFBRSxJQUFJLEVBQ2xCLEtBQUssRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULE1BQU0sRUFBRSxRQUFRLEVBQ2hCLE1BQU0sRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLGdCQUFnQixFQUNsRCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDMUcsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFNdEUsSUFBYSx5QkFBeUIsR0FBdEMsTUFBYSx5QkFBeUI7SUFrRHBDLFlBQW9CLFFBQWtDLEVBQ2xDLGdCQUFrQyxFQUNGLFVBQTRCO1FBRjVELGFBQVEsR0FBUixRQUFRLENBQTBCO1FBQ2xDLHFCQUFnQixHQUFoQixnQkFBZ0IsQ0FBa0I7UUFDRixlQUFVLEdBQVYsVUFBVSxDQUFrQjtRQWxEbEQsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFNaEIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFHeEIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFFM0IsZ0JBQVcsR0FBRyxTQUFTLENBQUM7UUFJdkIsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDbEIsaUJBQVksR0FBRyxLQUFLLENBQUM7UUFDcEIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDaEIsd0JBQW1CLEdBQUcsS0FBSyxDQUFDO1FBQ3JDLGdCQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ2Ysb0JBQWUsR0FB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QjtBQUU1QjtJQUFULE1BQU0sRUFBRTtnRUFBMkM7QUFDMUM7SUFBVCxNQUFNLEVBQUU7K0RBQTBDO0FBQ3pDO0lBQVQsTUFBTSxFQUFFO2lFQUE0QztBQXJDMUMseUJBQXlCO0lBSnJDLFNBQVMsQ0FBQztRQUNULDhDQUE4QztRQUM5QyxRQUFRLEVBQUUsdUNBQXVDO0tBQ2xELENBQUM7SUFxRGEsV0FBQSxRQUFRLEVBQUUsQ0FBQSxFQUFFLFdBQUEsSUFBSSxFQUFFLENBQUEsRUFBRSxXQUFBLFFBQVEsRUFBRSxDQUFBO0dBcERoQyx5QkFBeUIsQ0F1V3JDO1NBdldZLHlCQUF5QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XHJcbiAgQWZ0ZXJWaWV3SW5pdCwgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxyXG4gIENvbXBvbmVudFJlZixcclxuICBEaXJlY3RpdmUsXHJcbiAgRXZlbnRFbWl0dGVyLCBIb3N0LFxyXG4gIElucHV0LFxyXG4gIE9uQ2hhbmdlcyxcclxuICBPbkRlc3Ryb3ksXHJcbiAgT25Jbml0LCBPcHRpb25hbCxcclxuICBPdXRwdXQsIFNpbXBsZUNoYW5nZXMsIFNraXBTZWxmLCBWaWV3Q29udGFpbmVyUmVmXHJcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgQ29udHJvbENvbnRhaW5lciwgRm9ybUNvbnRyb2wsIEZvcm1Hcm91cCwgRm9ybUdyb3VwTmFtZSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcclxuaW1wb3J0IHsgTmd1aUF1dG9Db21wbGV0ZUNvbXBvbmVudCB9IGZyb20gJy4vYXV0by1jb21wbGV0ZS5jb21wb25lbnQnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOmRpcmVjdGl2ZS1zZWxlY3RvclxyXG4gIHNlbGVjdG9yOiAnW2F1dG8tY29tcGxldGVdLCBbbmd1aS1hdXRvLWNvbXBsZXRlXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIE5ndWlBdXRvQ29tcGxldGVEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQWZ0ZXJWaWV3SW5pdCwgT25EZXN0cm95IHtcclxuXHJcbiAgQElucHV0KCdhdXRvY29tcGxldGUnKSBwdWJsaWMgYXV0b2NvbXBsZXRlID0gZmFsc2U7XHJcbiAgQElucHV0KCdhdXRvLWNvbXBsZXRlLXBsYWNlaG9sZGVyJykgcHVibGljIGF1dG9Db21wbGV0ZVBsYWNlaG9sZGVyOiBzdHJpbmc7XHJcbiAgQElucHV0KCdzb3VyY2UnKSBwdWJsaWMgc291cmNlOiBhbnk7XHJcbiAgQElucHV0KCdwYXRoLXRvLWRhdGEnKSBwdWJsaWMgcGF0aFRvRGF0YTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnbWluLWNoYXJzJykgcHVibGljIG1pbkNoYXJzOiBudW1iZXI7XHJcbiAgQElucHV0KCdkaXNwbGF5LXByb3BlcnR5LW5hbWUnKSBwdWJsaWMgZGlzcGxheVByb3BlcnR5TmFtZTogc3RyaW5nO1xyXG4gIEBJbnB1dCgnYWNjZXB0LXVzZXItaW5wdXQnKSBwdWJsaWMgYWNjZXB0VXNlcklucHV0ID0gdHJ1ZTtcclxuICBASW5wdXQoJ21heC1udW0tbGlzdCcpIHB1YmxpYyBtYXhOdW1MaXN0OiBzdHJpbmc7XHJcbiAgQElucHV0KCdzZWxlY3QtdmFsdWUtb2YnKSBwdWJsaWMgc2VsZWN0VmFsdWVPZjogc3RyaW5nO1xyXG4gIEBJbnB1dCgnbG9hZGluZy10ZW1wbGF0ZScpIHB1YmxpYyBsb2FkaW5nVGVtcGxhdGUgPSBudWxsO1xyXG4gIEBJbnB1dCgnbGlzdC1mb3JtYXR0ZXInKSBwdWJsaWMgbGlzdEZvcm1hdHRlcjtcclxuICBASW5wdXQoJ2xvYWRpbmctdGV4dCcpIHB1YmxpYyBsb2FkaW5nVGV4dCA9ICdMb2FkaW5nJztcclxuICBASW5wdXQoJ2JsYW5rLW9wdGlvbi10ZXh0JykgcHVibGljIGJsYW5rT3B0aW9uVGV4dDogc3RyaW5nO1xyXG4gIEBJbnB1dCgnbm8tbWF0Y2gtZm91bmQtdGV4dCcpIHB1YmxpYyBub01hdGNoRm91bmRUZXh0OiBzdHJpbmc7XHJcbiAgQElucHV0KCd2YWx1ZS1mb3JtYXR0ZXInKSBwdWJsaWMgdmFsdWVGb3JtYXR0ZXI6IGFueTtcclxuICBASW5wdXQoJ3RhYi10by1zZWxlY3QnKSBwdWJsaWMgdGFiVG9TZWxlY3QgPSB0cnVlO1xyXG4gIEBJbnB1dCgnc2VsZWN0LW9uLWJsdXInKSBwdWJsaWMgc2VsZWN0T25CbHVyID0gZmFsc2U7XHJcbiAgQElucHV0KCdtYXRjaC1mb3JtYXR0ZWQnKSBwdWJsaWMgbWF0Y2hGb3JtYXR0ZWQgPSBmYWxzZTtcclxuICBASW5wdXQoJ2F1dG8tc2VsZWN0LWZpcnN0LWl0ZW0nKSBwdWJsaWMgYXV0b1NlbGVjdEZpcnN0SXRlbSA9IGZhbHNlO1xyXG4gIEBJbnB1dCgnb3Blbi1vbi1mb2N1cycpIHB1YmxpYyBvcGVuT25Gb2N1cyA9IHRydWU7XHJcbiAgQElucHV0KCdjbG9zZS1vbi1mb2N1c291dCcpIHB1YmxpYyBjbG9zZU9uRm9jdXNPdXQgPSB0cnVlO1xyXG4gIEBJbnB1dCgncmUtZm9jdXMtYWZ0ZXItc2VsZWN0JykgcHVibGljIHJlRm9jdXNBZnRlclNlbGVjdCA9IHRydWU7XHJcbiAgQElucHV0KCdoZWFkZXItaXRlbS10ZW1wbGF0ZScpIHB1YmxpYyBoZWFkZXJJdGVtVGVtcGxhdGUgPSBudWxsO1xyXG4gIEBJbnB1dCgnaWdub3JlLWFjY2VudHMnKSBwdWJsaWMgaWdub3JlQWNjZW50cyA9IHRydWU7XHJcblxyXG4gIEBJbnB1dCgpIHB1YmxpYyBuZ01vZGVsOiBzdHJpbmc7XHJcbiAgQElucHV0KCdmb3JtQ29udHJvbE5hbWUnKSBwdWJsaWMgZm9ybUNvbnRyb2xOYW1lOiBzdHJpbmc7XHJcbiAgLy8gaWYgW2Zvcm1Db250cm9sXSBpcyB1c2VkIG9uIHRoZSBhbmNob3Igd2hlcmUgb3VyIGRpcmVjdGl2ZSBpcyBzaXR0aW5nXHJcbiAgLy8gYSBmb3JtIGlzIG5vdCBuZWNlc3NhcnkgdG8gdXNlIGEgZm9ybUNvbnRyb2wgd2Ugc2hvdWxkIGFsc28gc3VwcG9ydCB0aGlzXHJcbiAgQElucHV0KCdmb3JtQ29udHJvbCcpIHB1YmxpYyBleHRGb3JtQ29udHJvbDogRm9ybUNvbnRyb2w7XHJcbiAgQElucHV0KCd6LWluZGV4JykgcHVibGljIHpJbmRleCA9ICcxJztcclxuICBASW5wdXQoJ2lzLXJ0bCcpIHB1YmxpYyBpc1J0bCA9IGZhbHNlO1xyXG5cclxuICBAT3V0cHV0KCkgcHVibGljIG5nTW9kZWxDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHB1YmxpYyB2YWx1ZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XHJcbiAgQE91dHB1dCgpIHB1YmxpYyBjdXN0b21TZWxlY3RlZCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcclxuXHJcbiAgcHJpdmF0ZSBjb21wb25lbnRSZWY6IENvbXBvbmVudFJlZjxOZ3VpQXV0b0NvbXBsZXRlQ29tcG9uZW50PjtcclxuICBwcml2YXRlIHdyYXBwZXJFbDogSFRNTEVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSBlbDogSFRNTEVsZW1lbnQ7ICAgLy8gdGhpcyBlbGVtZW50IGVsZW1lbnQsIGNhbiBiZSBhbnlcclxuICBwcml2YXRlIGFjRHJvcGRvd25FbDogSFRNTEVsZW1lbnQ7IC8vIGF1dG8gY29tcGxldGUgZWxlbWVudFxyXG4gIHByaXZhdGUgaW5wdXRFbDogSFRNTElucHV0RWxlbWVudDsgIC8vIGlucHV0IGVsZW1lbnQgb2YgdGhpcyBlbGVtZW50XHJcbiAgcHJpdmF0ZSBmb3JtQ29udHJvbDogQWJzdHJhY3RDb250cm9sO1xyXG4gIHByaXZhdGUgcmV2ZXJ0VmFsdWU6IGFueTtcclxuICBwcml2YXRlIGRyb3Bkb3duSnVzdEhpZGRlbjogYm9vbGVhbjtcclxuICBwcml2YXRlIHNjaGVkdWxlZEJsdXJIYW5kbGVyOiBhbnk7XHJcbiAgcHJpdmF0ZSBkb2N1bWVudENsaWNrTGlzdGVuZXI6IChlOiBNb3VzZUV2ZW50KSA9PiBhbnk7XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcclxuICAgICAgICAgICAgICBwdWJsaWMgIHZpZXdDb250YWluZXJSZWY6IFZpZXdDb250YWluZXJSZWYsXHJcbiAgICAgICAgICAgICAgQE9wdGlvbmFsKCkgQEhvc3QoKSBAU2tpcFNlbGYoKSBwcml2YXRlIHBhcmVudEZvcm06IENvbnRyb2xDb250YWluZXIpIHtcclxuICAgIHRoaXMuZWwgPSB0aGlzLnZpZXdDb250YWluZXJSZWYuZWxlbWVudC5uYXRpdmVFbGVtZW50O1xyXG4gIH1cclxuXHJcbiAgbmdPbkluaXQoKTogdm9pZCB7XHJcbiAgICAvLyBCbHVyIGV2ZW50IGlzIGhhbmRsZWQgb25seSBhZnRlciBhIGNsaWNrIGV2ZW50LlxyXG4gICAgLy8gVGhpcyBpcyB0byBwcmV2ZW50IGhhbmRsaW5nIG9mIGJsdXIgZXZlbnRzIHJlc3VsdGluZyBmcm9tIGludGVyYWN0aW5nIHdpdGggYSBzY3JvbGxiYXJcclxuICAgIC8vIGludHJvZHVjZWQgYnkgY29udGVudCBvdmVyZmxvdyAoSW50ZXJuZXQgZXhwbG9yZXIgaXNzdWUpLlxyXG4gICAgLy8gU2VlIGlzc3VlIGRlc2NyaXB0aW9uIGhlcmU6IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjAyMzc3OS9jbGlja2luZy1vbi1hLWRpdnMtc2Nyb2xsLWJhci1maXJlcy10aGUtYmx1ci1ldmVudC1pbi1pZVxyXG4gICAgdGhpcy5kb2N1bWVudENsaWNrTGlzdGVuZXIgPSAoZSkgPT4ge1xyXG4gICAgICBpZiAodGhpcy5zY2hlZHVsZWRCbHVySGFuZGxlcikge1xyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVkQmx1ckhhbmRsZXIoKTtcclxuICAgICAgICB0aGlzLnNjaGVkdWxlZEJsdXJIYW5kbGVyID0gbnVsbDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuZG9jdW1lbnRDbGlja0xpc3RlbmVyKTtcclxuICAgIC8vIHdyYXAgdGhpcyBlbGVtZW50IHdpdGggPGRpdiBjbGFzcz1cIm5ndWktYXV0by1jb21wbGV0ZVwiPlxyXG4gICAgdGhpcy53cmFwcGVyRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIHRoaXMud3JhcHBlckVsLmNsYXNzTmFtZSA9ICduZ3VpLWF1dG8tY29tcGxldGUtd3JhcHBlcic7XHJcbiAgICB0aGlzLndyYXBwZXJFbC5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XHJcbiAgICB0aGlzLmVsLnBhcmVudEVsZW1lbnQuaW5zZXJ0QmVmb3JlKHRoaXMud3JhcHBlckVsLCB0aGlzLmVsLm5leHRTaWJsaW5nKTtcclxuICAgIHRoaXMud3JhcHBlckVsLmFwcGVuZENoaWxkKHRoaXMuZWwpO1xyXG5cclxuICAgIC8vIENoZWNrIGlmIHdlIHdlcmUgc3VwcGxpZWQgd2l0aCBhIFtmb3JtQ29udHJvbE5hbWVdIGFuZCBpdCBpcyBpbnNpZGUgYSBbZm9ybV1cclxuICAgIC8vIGVsc2UgY2hlY2sgaWYgd2UgYXJlIHN1cHBsaWVkIHdpdGggYSBbRm9ybUNvbnRyb2xdIHJlZ2FyZGxlc3MgaWYgaXQgaXMgaW5zaWRlIGEgW2Zvcm1dIHRhZ1xyXG4gICAgaWYgKHRoaXMucGFyZW50Rm9ybSAmJiB0aGlzLmZvcm1Db250cm9sTmFtZSkge1xyXG4gICAgICBpZiAodGhpcy5wYXJlbnRGb3JtWydmb3JtJ10pIHtcclxuICAgICAgICB0aGlzLmZvcm1Db250cm9sID0gKHRoaXMucGFyZW50Rm9ybVsnZm9ybSddIGFzIEZvcm1Hcm91cCkuZ2V0KHRoaXMuZm9ybUNvbnRyb2xOYW1lKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLnBhcmVudEZvcm0gaW5zdGFuY2VvZiBGb3JtR3JvdXBOYW1lKSB7XHJcbiAgICAgICAgdGhpcy5mb3JtQ29udHJvbCA9ICh0aGlzLnBhcmVudEZvcm0gYXMgRm9ybUdyb3VwTmFtZSkuY29udHJvbC5jb250cm9sc1t0aGlzLmZvcm1Db250cm9sTmFtZV07XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAodGhpcy5leHRGb3JtQ29udHJvbCkge1xyXG4gICAgICB0aGlzLmZvcm1Db250cm9sID0gdGhpcy5leHRGb3JtQ29udHJvbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBhcHBseSB0b1N0cmluZygpIG1ldGhvZCBmb3IgdGhlIG9iamVjdFxyXG4gICAgaWYgKCEhdGhpcy5uZ01vZGVsKSB7XHJcbiAgICAgIHRoaXMuc2VsZWN0TmV3VmFsdWUodGhpcy5uZ01vZGVsKTtcclxuICAgIH0gZWxzZSBpZiAoISF0aGlzLmZvcm1Db250cm9sICYmIHRoaXMuZm9ybUNvbnRyb2wudmFsdWUpIHtcclxuICAgICAgdGhpcy5zZWxlY3ROZXdWYWx1ZSh0aGlzLmZvcm1Db250cm9sLnZhbHVlKTtcclxuICAgIH1cclxuXHJcbiAgfVxyXG5cclxuICBuZ0FmdGVyVmlld0luaXQoKSB7XHJcbiAgICAvLyBpZiB0aGlzIGVsZW1lbnQgaXMgbm90IGFuIGlucHV0IHRhZywgbW92ZSBkcm9wZG93biBhZnRlciBpbnB1dCB0YWdcclxuICAgIC8vIHNvIHRoYXQgaXQgZGlzcGxheXMgY29ycmVjdGx5XHJcbiAgICB0aGlzLmlucHV0RWwgPSB0aGlzLmVsLnRhZ05hbWUgPT09ICdJTlBVVCcgPyB0aGlzLmVsIGFzIEhUTUxJbnB1dEVsZW1lbnQgOiB0aGlzLmVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0Jyk7XHJcblxyXG4gICAgaWYgKHRoaXMub3Blbk9uRm9jdXMpIHtcclxuICAgICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgKGUpID0+IHRoaXMuc2hvd0F1dG9Db21wbGV0ZURyb3Bkb3duKGUpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5jbG9zZU9uRm9jdXNPdXQpIHtcclxuICAgICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3Vzb3V0JywgKGUpID0+IHRoaXMuaGlkZUF1dG9Db21wbGV0ZURyb3Bkb3duKGUpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRoaXMuYXV0b2NvbXBsZXRlKSB7XHJcbiAgICAgIHRoaXMuaW5wdXRFbC5zZXRBdHRyaWJ1dGUoJ2F1dG9jb21wbGV0ZScsICdvZmYnKTtcclxuICAgIH1cclxuICAgIHRoaXMuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKGUpID0+IHtcclxuICAgICAgdGhpcy5zY2hlZHVsZWRCbHVySGFuZGxlciA9ICgpID0+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5ibHVySGFuZGxlcihlKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gICAgdGhpcy5pbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4gdGhpcy5rZXlkb3duRXZlbnRIYW5kbGVyKGUpKTtcclxuICAgIHRoaXMuaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChlKSA9PiB0aGlzLmlucHV0RXZlbnRIYW5kbGVyKGUpKTtcclxuICB9XHJcblxyXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlLnZhbHVlU2VsZWN0ZWQudW5zdWJzY3JpYmUoKTtcclxuICAgICAgdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2UudGV4dEVudGVyZWQudW5zdWJzY3JpYmUoKTtcclxuICAgIH1cclxuICAgIGlmICh0aGlzLmRvY3VtZW50Q2xpY2tMaXN0ZW5lcikge1xyXG4gICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuZG9jdW1lbnRDbGlja0xpc3RlbmVyKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzWyduZ01vZGVsJ10pIHtcclxuICAgICAgdGhpcy5uZ01vZGVsID0gdGhpcy5zZXRUb1N0cmluZ0Z1bmN0aW9uKGNoYW5nZXNbJ25nTW9kZWwnXS5jdXJyZW50VmFsdWUpO1xyXG4gICAgICB0aGlzLnJlbmRlclZhbHVlKHRoaXMubmdNb2RlbCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyBzaG93IGF1dG8tY29tcGxldGUgbGlzdCBiZWxvdyB0aGUgY3VycmVudCBlbGVtZW50XHJcbiAgcHVibGljIHNob3dBdXRvQ29tcGxldGVEcm9wZG93biA9IChldmVudD86IGFueSk6IHZvaWQgPT4ge1xyXG4gICAgaWYgKHRoaXMuZHJvcGRvd25KdXN0SGlkZGVuKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHRoaXMuaGlkZUF1dG9Db21wbGV0ZURyb3Bkb3duKCk7XHJcbiAgICB0aGlzLnNjaGVkdWxlZEJsdXJIYW5kbGVyID0gbnVsbDtcclxuXHJcbiAgICBjb25zdCBmYWN0b3J5ID0gdGhpcy5yZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeShOZ3VpQXV0b0NvbXBsZXRlQ29tcG9uZW50KTtcclxuXHJcbiAgICB0aGlzLmNvbXBvbmVudFJlZiA9IHRoaXMudmlld0NvbnRhaW5lclJlZi5jcmVhdGVDb21wb25lbnQoZmFjdG9yeSk7XHJcblxyXG4gICAgY29uc3QgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICBjb21wb25lbnQua2V5d29yZCA9IHRoaXMuaW5wdXRFbC52YWx1ZTtcclxuICAgIGNvbXBvbmVudC5zaG93SW5wdXRUYWcgPSBmYWxzZTsgLy8gRG8gTk9UIGRpc3BsYXkgYXV0b2NvbXBsZXRlIGlucHV0IHRhZyBzZXBhcmF0ZWx5XHJcblxyXG4gICAgY29tcG9uZW50LnBhdGhUb0RhdGEgPSB0aGlzLnBhdGhUb0RhdGE7XHJcbiAgICBjb21wb25lbnQubWluQ2hhcnMgPSB0aGlzLm1pbkNoYXJzO1xyXG4gICAgY29tcG9uZW50LnNvdXJjZSA9IHRoaXMuc291cmNlO1xyXG4gICAgY29tcG9uZW50LnBsYWNlaG9sZGVyID0gdGhpcy5hdXRvQ29tcGxldGVQbGFjZWhvbGRlcjtcclxuICAgIGNvbXBvbmVudC5hY2NlcHRVc2VySW5wdXQgPSB0aGlzLmFjY2VwdFVzZXJJbnB1dDtcclxuICAgIGNvbXBvbmVudC5tYXhOdW1MaXN0ID0gcGFyc2VJbnQodGhpcy5tYXhOdW1MaXN0LCAxMCk7XHJcblxyXG4gICAgY29tcG9uZW50LmxvYWRpbmdUZXh0ID0gdGhpcy5sb2FkaW5nVGV4dDtcclxuICAgIGNvbXBvbmVudC5sb2FkaW5nVGVtcGxhdGUgPSB0aGlzLmxvYWRpbmdUZW1wbGF0ZTtcclxuICAgIGNvbXBvbmVudC5saXN0Rm9ybWF0dGVyID0gdGhpcy5saXN0Rm9ybWF0dGVyO1xyXG4gICAgY29tcG9uZW50LmJsYW5rT3B0aW9uVGV4dCA9IHRoaXMuYmxhbmtPcHRpb25UZXh0O1xyXG4gICAgY29tcG9uZW50Lm5vTWF0Y2hGb3VuZFRleHQgPSB0aGlzLm5vTWF0Y2hGb3VuZFRleHQ7XHJcbiAgICBjb21wb25lbnQudGFiVG9TZWxlY3QgPSB0aGlzLnRhYlRvU2VsZWN0O1xyXG4gICAgY29tcG9uZW50LnNlbGVjdE9uQmx1ciA9IHRoaXMuc2VsZWN0T25CbHVyO1xyXG4gICAgY29tcG9uZW50Lm1hdGNoRm9ybWF0dGVkID0gdGhpcy5tYXRjaEZvcm1hdHRlZDtcclxuICAgIGNvbXBvbmVudC5hdXRvU2VsZWN0Rmlyc3RJdGVtID0gdGhpcy5hdXRvU2VsZWN0Rmlyc3RJdGVtO1xyXG4gICAgY29tcG9uZW50LmhlYWRlckl0ZW1UZW1wbGF0ZSA9IHRoaXMuaGVhZGVySXRlbVRlbXBsYXRlO1xyXG4gICAgY29tcG9uZW50Lmlnbm9yZUFjY2VudHMgPSB0aGlzLmlnbm9yZUFjY2VudHM7XHJcblxyXG4gICAgY29tcG9uZW50LnZhbHVlU2VsZWN0ZWQuc3Vic2NyaWJlKHRoaXMuc2VsZWN0TmV3VmFsdWUpO1xyXG4gICAgY29tcG9uZW50LnRleHRFbnRlcmVkLnN1YnNjcmliZSh0aGlzLmVudGVyTmV3VGV4dCk7XHJcbiAgICBjb21wb25lbnQuY3VzdG9tU2VsZWN0ZWQuc3Vic2NyaWJlKHRoaXMuc2VsZWN0Q3VzdG9tVmFsdWUpO1xyXG5cclxuICAgIHRoaXMuYWNEcm9wZG93bkVsID0gdGhpcy5jb21wb25lbnRSZWYubG9jYXRpb24ubmF0aXZlRWxlbWVudDtcclxuICAgIHRoaXMuYWNEcm9wZG93bkVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcblxyXG4gICAgLy8gaWYgdGhpcyBlbGVtZW50IGlzIG5vdCBhbiBpbnB1dCB0YWcsIG1vdmUgZHJvcGRvd24gYWZ0ZXIgaW5wdXQgdGFnXHJcbiAgICAvLyBzbyB0aGF0IGl0IGRpc3BsYXlzIGNvcnJlY3RseVxyXG5cclxuICAgIC8vIFRPRE86IGNvbmZpcm0gd2l0aCBvd25lcnNcclxuICAgIC8vIHdpdGggc29tZSByZWFzb24sIHZpZXdDb250YWluZXJSZWYuY3JlYXRlQ29tcG9uZW50IGlzIGNyZWF0aW5nIGVsZW1lbnRcclxuICAgIC8vIHRvIHBhcmVudCBkaXYgd2hpY2ggaXMgY3JlYXRlZCBieSB1cyBvbiBuZ09uSW5pdCwgcGxlYXNlIHRyeSB0aGlzIHdpdGggZGVtb1xyXG5cclxuICAgIC8vIGlmICh0aGlzLmVsLnRhZ05hbWUgIT09ICdJTlBVVCcgJiYgdGhpcy5hY0Ryb3Bkb3duRWwpIHtcclxuICAgIHRoaXMuaW5wdXRFbC5wYXJlbnRFbGVtZW50Lmluc2VydEJlZm9yZSh0aGlzLmFjRHJvcGRvd25FbCwgdGhpcy5pbnB1dEVsLm5leHRTaWJsaW5nKTtcclxuICAgIC8vIH1cclxuICAgIHRoaXMucmV2ZXJ0VmFsdWUgPSB0eXBlb2YgdGhpcy5uZ01vZGVsICE9PSAndW5kZWZpbmVkJyA/IHRoaXMubmdNb2RlbCA6IHRoaXMuaW5wdXRFbC52YWx1ZTtcclxuXHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgY29tcG9uZW50LnJlbG9hZExpc3QodGhpcy5pbnB1dEVsLnZhbHVlKTtcclxuICAgICAgdGhpcy5zdHlsZUF1dG9Db21wbGV0ZURyb3Bkb3duKCk7XHJcbiAgICAgIGNvbXBvbmVudC5kcm9wZG93blZpc2libGUgPSB0cnVlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYmx1ckhhbmRsZXIoZXZlbnQ6IGFueSkge1xyXG4gICAgaWYgKHRoaXMuY29tcG9uZW50UmVmKSB7XHJcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRoaXMuY29tcG9uZW50UmVmLmluc3RhbmNlO1xyXG5cclxuICAgICAgaWYgKHRoaXMuc2VsZWN0T25CbHVyKSB7XHJcbiAgICAgICAgY29tcG9uZW50LnNlbGVjdE9uZShjb21wb25lbnQuZmlsdGVyZWRMaXN0W2NvbXBvbmVudC5pdGVtSW5kZXhdKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuY2xvc2VPbkZvY3VzT3V0KSB7XHJcbiAgICAgICAgdGhpcy5oaWRlQXV0b0NvbXBsZXRlRHJvcGRvd24oZXZlbnQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaGlkZUF1dG9Db21wbGV0ZURyb3Bkb3duID0gKGV2ZW50PzogYW55KTogdm9pZCA9PiB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgbGV0IGN1cnJlbnRJdGVtOiBhbnk7XHJcbiAgICAgIGNvbnN0IGhhc1JldmVydFZhbHVlID0gKHR5cGVvZiB0aGlzLnJldmVydFZhbHVlICE9PSAndW5kZWZpbmVkJyk7XHJcbiAgICAgIGlmICh0aGlzLmlucHV0RWwgJiYgaGFzUmV2ZXJ0VmFsdWUgJiYgdGhpcy5hY2NlcHRVc2VySW5wdXQgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgY3VycmVudEl0ZW0gPSB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZS5maW5kSXRlbUZyb21TZWxlY3RWYWx1ZSh0aGlzLmlucHV0RWwudmFsdWUpO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuY29tcG9uZW50UmVmLmRlc3Ryb3koKTtcclxuICAgICAgdGhpcy5jb21wb25lbnRSZWYgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICBpZiAodGhpcy5pbnB1dEVsICYmIGhhc1JldmVydFZhbHVlICYmIHRoaXMuYWNjZXB0VXNlcklucHV0ID09PSBmYWxzZSAmJiBjdXJyZW50SXRlbSA9PT0gbnVsbCkge1xyXG4gICAgICAgIHRoaXMuc2VsZWN0TmV3VmFsdWUodGhpcy5yZXZlcnRWYWx1ZSk7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5pbnB1dEVsICYmIHRoaXMuYWNjZXB0VXNlcklucHV0ID09PSB0cnVlICYmIHR5cGVvZiBjdXJyZW50SXRlbSA9PT0gJ3VuZGVmaW5lZCcgJiYgZXZlbnQgJiYgZXZlbnQudGFyZ2V0LnZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5lbnRlck5ld1RleHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgdGhpcy5kcm9wZG93bkp1c3RIaWRkZW4gPSB0cnVlO1xyXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmRyb3Bkb3duSnVzdEhpZGRlbiA9IGZhbHNlLCAxMDApO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHN0eWxlQXV0b0NvbXBsZXRlRHJvcGRvd24gPSAoKSA9PiB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcblxyXG4gICAgICAvKiBzZXR0aW5nIHdpZHRoL2hlaWdodCBhdXRvIGNvbXBsZXRlICovXHJcbiAgICAgIGNvbnN0IHRoaXNFbEJDUiA9IHRoaXMuZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XHJcbiAgICAgIGNvbnN0IHRoaXNJbnB1dEVsQkNSID0gdGhpcy5pbnB1dEVsLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xyXG4gICAgICBjb25zdCBjbG9zZVRvQm90dG9tID0gdGhpc0lucHV0RWxCQ1IuYm90dG9tICsgMTAwID4gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgICBjb25zdCBkaXJlY3Rpb25PZlN0eWxlID0gdGhpcy5pc1J0bCA/ICdyaWdodCcgOiAnbGVmdCc7XHJcblxyXG4gICAgICB0aGlzLmFjRHJvcGRvd25FbC5zdHlsZS53aWR0aCA9IHRoaXNJbnB1dEVsQkNSLndpZHRoICsgJ3B4JztcclxuICAgICAgdGhpcy5hY0Ryb3Bkb3duRWwuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xyXG4gICAgICB0aGlzLmFjRHJvcGRvd25FbC5zdHlsZS56SW5kZXggPSB0aGlzLnpJbmRleDtcclxuICAgICAgdGhpcy5hY0Ryb3Bkb3duRWwuc3R5bGVbZGlyZWN0aW9uT2ZTdHlsZV0gPSAnMCc7XHJcbiAgICAgIHRoaXMuYWNEcm9wZG93bkVsLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJztcclxuXHJcbiAgICAgIGlmIChjbG9zZVRvQm90dG9tKSB7XHJcbiAgICAgICAgdGhpcy5hY0Ryb3Bkb3duRWwuc3R5bGUuYm90dG9tID0gYCR7dGhpc0lucHV0RWxCQ1IuaGVpZ2h0fXB4YDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLmFjRHJvcGRvd25FbC5zdHlsZS50b3AgPSBgJHt0aGlzSW5wdXRFbEJDUi5oZWlnaHR9cHhgO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2V0VG9TdHJpbmdGdW5jdGlvbihpdGVtOiBhbnkpOiBhbnkge1xyXG4gICAgaWYgKGl0ZW0gJiYgdHlwZW9mIGl0ZW0gPT09ICdvYmplY3QnKSB7XHJcbiAgICAgIGxldCBkaXNwbGF5VmFsO1xyXG5cclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLnZhbHVlRm9ybWF0dGVyID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSB0aGlzLnZhbHVlRm9ybWF0dGVyLm1hdGNoKC9bYS16QS1aMC05X1xcJF0rL2cpO1xyXG4gICAgICAgIGxldCBmb3JtYXR0ZWQgPSB0aGlzLnZhbHVlRm9ybWF0dGVyO1xyXG4gICAgICAgIGlmIChtYXRjaGVzICYmIHR5cGVvZiBpdGVtICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKChrZXkpID0+IHtcclxuICAgICAgICAgICAgZm9ybWF0dGVkID0gZm9ybWF0dGVkLnJlcGxhY2Uoa2V5LCBpdGVtW2tleV0pO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRpc3BsYXlWYWwgPSBmb3JtYXR0ZWQ7XHJcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHRoaXMudmFsdWVGb3JtYXR0ZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBkaXNwbGF5VmFsID0gdGhpcy52YWx1ZUZvcm1hdHRlcihpdGVtKTtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLmRpc3BsYXlQcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICBkaXNwbGF5VmFsID0gaXRlbVt0aGlzLmRpc3BsYXlQcm9wZXJ0eU5hbWVdO1xyXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0aGlzLmxpc3RGb3JtYXR0ZXIgPT09ICdzdHJpbmcnICYmIHRoaXMubGlzdEZvcm1hdHRlci5tYXRjaCgvXlxcdyskLykpIHtcclxuICAgICAgICBkaXNwbGF5VmFsID0gaXRlbVt0aGlzLmxpc3RGb3JtYXR0ZXJdO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGRpc3BsYXlWYWwgPSBpdGVtLnZhbHVlO1xyXG4gICAgICB9XHJcbiAgICAgIGl0ZW0udG9TdHJpbmcgPSAoKSA9PiBkaXNwbGF5VmFsO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGl0ZW07XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc2VsZWN0TmV3VmFsdWUgPSAoaXRlbTogYW55KSA9PiB7XHJcbiAgICAvLyBtYWtlIGRpc3BsYXlhYmxlIHZhbHVlXHJcbiAgICBpZiAoaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgaXRlbSA9IHRoaXMuc2V0VG9TdHJpbmdGdW5jdGlvbihpdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLnJlbmRlclZhbHVlKGl0ZW0pO1xyXG5cclxuICAgIC8vIG1ha2UgcmV0dXJuIHZhbHVlXHJcbiAgICBsZXQgdmFsID0gaXRlbTtcclxuICAgIGlmICh0aGlzLnNlbGVjdFZhbHVlT2YgJiYgaXRlbVt0aGlzLnNlbGVjdFZhbHVlT2ZdKSB7XHJcbiAgICAgIHZhbCA9IGl0ZW1bdGhpcy5zZWxlY3RWYWx1ZU9mXTtcclxuICAgIH1cclxuICAgIGlmICgodGhpcy5wYXJlbnRGb3JtICYmIHRoaXMuZm9ybUNvbnRyb2xOYW1lKSB8fCB0aGlzLmV4dEZvcm1Db250cm9sKSB7XHJcbiAgICAgIGlmICghIXZhbCkge1xyXG4gICAgICAgIHRoaXMuZm9ybUNvbnRyb2wucGF0Y2hWYWx1ZSh2YWwpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAodmFsICE9PSB0aGlzLm5nTW9kZWwpIHtcclxuICAgICAgdGhpcy5uZ01vZGVsQ2hhbmdlLmVtaXQodmFsKTtcclxuICAgIH1cclxuICAgIHRoaXMudmFsdWVDaGFuZ2VkLmVtaXQodmFsKTtcclxuICAgIHRoaXMuaGlkZUF1dG9Db21wbGV0ZURyb3Bkb3duKCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMucmVGb2N1c0FmdGVyU2VsZWN0KSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dEVsLmZvY3VzKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0aGlzLmlucHV0RWw7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZWxlY3RDdXN0b21WYWx1ZSA9ICh0ZXh0OiBzdHJpbmcpID0+IHtcclxuICAgIHRoaXMuY3VzdG9tU2VsZWN0ZWQuZW1pdCh0ZXh0KTtcclxuICAgIHRoaXMuaGlkZUF1dG9Db21wbGV0ZURyb3Bkb3duKCk7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgaWYgKHRoaXMucmVGb2N1c0FmdGVyU2VsZWN0KSB7XHJcbiAgICAgICAgdGhpcy5pbnB1dEVsLmZvY3VzKCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0aGlzLmlucHV0RWw7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBlbnRlck5ld1RleHQgPSAodmFsdWU6IGFueSkgPT4ge1xyXG4gICAgdGhpcy5yZW5kZXJWYWx1ZSh2YWx1ZSk7XHJcbiAgICB0aGlzLm5nTW9kZWxDaGFuZ2UuZW1pdCh2YWx1ZSk7XHJcbiAgICB0aGlzLnZhbHVlQ2hhbmdlZC5lbWl0KHZhbHVlKTtcclxuICAgIHRoaXMuaGlkZUF1dG9Db21wbGV0ZURyb3Bkb3duKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGtleWRvd25FdmVudEhhbmRsZXIgPSAoZXZ0OiBhbnkpID0+IHtcclxuICAgIGlmICh0aGlzLmNvbXBvbmVudFJlZikge1xyXG4gICAgICBjb25zdCBjb21wb25lbnQgPSB0aGlzLmNvbXBvbmVudFJlZi5pbnN0YW5jZTtcclxuICAgICAgY29tcG9uZW50LmlucHV0RWxLZXlIYW5kbGVyKGV2dCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGlucHV0RXZlbnRIYW5kbGVyID0gKGV2dDogYW55KSA9PiB7XHJcbiAgICBpZiAodGhpcy5jb21wb25lbnRSZWYpIHtcclxuICAgICAgY29uc3QgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRSZWYuaW5zdGFuY2U7XHJcbiAgICAgIGNvbXBvbmVudC5kcm9wZG93blZpc2libGUgPSB0cnVlO1xyXG4gICAgICBjb21wb25lbnQua2V5d29yZCA9IGV2dC50YXJnZXQudmFsdWU7XHJcbiAgICAgIGNvbXBvbmVudC5yZWxvYWRMaXN0SW5EZWxheShldnQpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zaG93QXV0b0NvbXBsZXRlRHJvcGRvd24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVuZGVyVmFsdWUoaXRlbTogYW55KSB7XHJcbiAgICBpZiAoISF0aGlzLmlucHV0RWwpIHtcclxuICAgICAgdGhpcy5pbnB1dEVsLnZhbHVlID0gJycgKyBpdGVtO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG4iXX0=