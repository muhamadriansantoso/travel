/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ContentChildren, QueryList } from '@angular/core';
import { NgWizardService } from '../ng-wizard.service';
import { NgWizardStep } from '../../utils/interfaces';
import { TOOLBAR_POSITION, STEP_STATE, STEP_STATUS } from '../../utils/enums';
import { merge } from '../../utils/functions';
export class NgWizardComponent {
    /**
     * @param {?} ngService
     */
    constructor(ngService) {
        this.ngService = ngService;
        this.stepChanged = new EventEmitter();
        this.themeChanged = new EventEmitter();
        this.reseted = new EventEmitter();
        this.styles = {};
        this.showToolbarTop = false;
        this.showPreviousButton = false;
        this.showNextButton = false;
        this.showToolbarBottom = false;
        this.showExtraButtons = false;
        this.current_index = null; // Active step index
    }
    /**
     * @return {?}
     */
    get pConfig() {
        return this._pConfig || {};
    }
    /**
     * @param {?} config
     * @return {?}
     */
    set pConfig(config) {
        this._pConfig = config;
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this._backupStepStates();
        this._init();
        // Set toolbar
        this._setToolbar();
        // Assign plugin events
        this._setEvents();
        this.resetWizardWatcher = this.ngService.resetWizard$
            .subscribe((/**
         * @return {?}
         */
        () => {
            this._reset();
        }));
        this.showNextStepWatcher = this.ngService.showNextStep$
            .subscribe((/**
         * @return {?}
         */
        () => {
            this._showNextStep();
        }));
        this.showPreviousStepWatcher = this.ngService.showPreviousStep$
            .subscribe((/**
         * @return {?}
         */
        () => {
            this._showPreviousStep();
        }));
        this.setThemeWatcher = this.ngService.setTheme$
            .subscribe((/**
         * @param {?} theme
         * @return {?}
         */
        theme => {
            this._setTheme(theme);
        }));
    }
    /**
     * @return {?}
     */
    _init() {
        // set config
        /** @type {?} */
        var defaultConfig = this.ngService.getDefaultConfig();
        this.config = merge(defaultConfig, this.pConfig);
        // set step states
        this._initSteps();
        // Set the elements
        this._initStyles();
        // Show the initial step
        this._showStep(this.config.selected);
    }
    /**
     * @return {?}
     */
    _initSteps() {
        this.steps.forEach((/**
         * @param {?} step
         * @param {?} index
         * @return {?}
         */
        (step, index) => {
            step.index = index;
            step.status = step.status || STEP_STATUS.untouched;
            step.state = step.state || STEP_STATE.normal;
        }));
        // Mark previous steps of the active step as done
        if (this.config.selected > 0
            && this.config.anchorSettings.markDoneStep
            && this.config.anchorSettings.markAllPreviousStepsAsDone) {
            this.steps.forEach((/**
             * @param {?} step
             * @return {?}
             */
            step => {
                if (step.state != STEP_STATE.disabled && step.state != STEP_STATE.hidden) {
                    step.status = step.index < this.config.selected ? STEP_STATUS.done : step.status;
                }
            }));
        }
    }
    /**
     * @return {?}
     */
    _backupStepStates() {
        this.steps.forEach((/**
         * @param {?} step
         * @return {?}
         */
        step => {
            step.initialStatus = step.status;
            step.initialState = step.state;
        }));
    }
    /**
     * @return {?}
     */
    _restoreStepStates() {
        this.steps.forEach((/**
         * @param {?} step
         * @return {?}
         */
        step => {
            step.status = step.initialStatus;
            step.state = step.initialState;
        }));
    }
    // PRIVATE FUNCTIONS
    /**
     * @return {?}
     */
    _initStyles() {
        // Set the main element
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
        // Set anchor elements
        this.styles.step = 'nav-item'; // li
        // Make the anchor clickable
        if (this.config.anchorSettings.enableAllAnchors && this.config.anchorSettings.anchorClickable) {
            this.styles.step += ' clickable';
        }
        // Set the toolbar styles
        this.styles.toolbarTop = 'btn-toolbar ng-wizard-toolbar ng-wizard-toolbar-top justify-content-' + this.config.toolbarSettings.toolbarButtonPosition;
        this.styles.toolbarBottom = 'btn-toolbar ng-wizard-toolbar ng-wizard-toolbar-bottom justify-content-' + this.config.toolbarSettings.toolbarButtonPosition;
        // Set previous&next buttons 
        this.styles.previousButton = 'btn btn-secondary ng-wizard-btn-prev';
        this.styles.nextButton = 'btn btn-secondary ng-wizard-btn-next';
    }
    /**
     * @return {?}
     */
    _setToolbar() {
        this.showToolbarTop = this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.top ||
            this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.both;
        this.showToolbarBottom = this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.bottom ||
            this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.both;
        this.showPreviousButton = this.config.toolbarSettings.showPreviousButton;
        this.showNextButton = this.config.toolbarSettings.showNextButton;
        this.showExtraButtons = this.config.toolbarSettings.toolbarExtraButtons && this.config.toolbarSettings.toolbarExtraButtons.length > 0;
    }
    /**
     * @return {?}
     */
    _setEvents() {
        //TODO: keyNavigation
        // Keyboard navigation event
        if (this.config.keyNavigation) {
            // $(document).keyup(function (e) {
            //   mi._keyNav(e);
            // });
        }
    }
    /**
     * @param {?} selectedStep
     * @return {?}
     */
    _getStepCssClass(selectedStep) {
        /** @type {?} */
        var stepClass = this.styles.step;
        switch (selectedStep.state) {
            case STEP_STATE.disabled:
                stepClass += ' disabled';
                break;
            case STEP_STATE.error:
                stepClass += ' danger';
                break;
            case STEP_STATE.hidden:
                stepClass += ' hidden';
                break;
        }
        switch (selectedStep.status) {
            case STEP_STATUS.done:
                stepClass += ' done';
                break;
            case STEP_STATUS.active:
                stepClass += ' active';
                break;
        }
        return stepClass;
    }
    /**
     * @param {?} event
     * @param {?} selectedStep
     * @return {?}
     */
    _showSelectedStep(event, selectedStep) {
        event.preventDefault();
        if (!this.config.anchorSettings.anchorClickable) {
            return;
        }
        if (!this.config.anchorSettings.enableAnchorOnDoneStep && selectedStep.status == STEP_STATUS.done) {
            return true;
        }
        if (selectedStep.index != this.current_index) {
            if (this.config.anchorSettings.enableAllAnchors && this.config.anchorSettings.anchorClickable) {
                this._showStep(selectedStep.index);
            }
            else {
                if (selectedStep.status == STEP_STATUS.done) {
                    this._showStep(selectedStep.index);
                }
            }
        }
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    _showNextStep(event) {
        if (event) {
            event.preventDefault();
        }
        // Find the next not disabled & hidden step
        /** @type {?} */
        var filteredSteps = this.steps.filter((/**
         * @param {?} step
         * @return {?}
         */
        step => {
            return step.index > (this.current_index == null ? -1 : this.current_index)
                && step.state != STEP_STATE.disabled
                && step.state != STEP_STATE.hidden;
        }));
        if (filteredSteps.length == 0) {
            if (!this.config.cycleSteps) {
                return;
            }
            this._showStep(0);
        }
        else {
            this._showStep(filteredSteps.shift().index);
        }
    }
    /**
     * @param {?=} event
     * @return {?}
     */
    _showPreviousStep(event) {
        if (event) {
            event.preventDefault();
        }
        // Find the previous not disabled & hidden step
        /** @type {?} */
        var filteredSteps = this.steps.filter((/**
         * @param {?} step
         * @return {?}
         */
        step => {
            return step.index < (this.current_index == null && this.config.cycleSteps ? this.steps.length : this.current_index)
                && step.state != STEP_STATE.disabled
                && step.state != STEP_STATE.hidden;
        }));
        if (filteredSteps.length == 0) {
            if (!this.config.cycleSteps) {
                return;
            }
            this._showStep(this.steps.length - 1);
        }
        else {
            this._showStep(filteredSteps.pop().index);
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    _showStep(index) {
        // If step not found, skip
        if (index >= this.steps.length || index < 0) {
            return;
        }
        // If current step is requested again, skip
        if (index == this.current_index) {
            return;
        }
        /** @type {?} */
        var selectedStep = this.steps.toArray()[index];
        // If it is a disabled or hidden step, skip
        if (selectedStep.state == STEP_STATE.disabled || selectedStep.state == STEP_STATE.hidden) {
            return;
        }
        // Load step content
        this._loadStepContent(selectedStep);
    }
    /**
     * @param {?} selectedStep
     * @return {?}
     */
    _loadStepContent(selectedStep) {
        // Get the direction of step navigation
        /** @type {?} */
        var stepDirection = (this.current_index != null && this.current_index != selectedStep.index) ? (this.current_index < selectedStep.index ? "forward" : "backward") : '';
        /** @type {?} */
        var stepPosition = (selectedStep.index == 0) ? 'first' : (selectedStep.index == this.steps.length - 1 ? 'final' : 'middle');
        // Update controls
        this._setAnchor(selectedStep);
        // Set the buttons based on the step
        this._setButtons(selectedStep.index);
        // Trigger "stepChanged" event
        this.stepChanged.emit({
            step: selectedStep,
            previousStep: this.currentStep,
            direction: stepDirection,
            position: stepPosition
        });
        // Update the current index
        this.current_index = selectedStep.index;
        this.currentStep = selectedStep;
    }
    /**
     * @param {?} selectedStep
     * @return {?}
     */
    _setAnchor(selectedStep) {
        // Current step anchor > Remove other classes and add done class
        if (this.currentStep) {
            this.currentStep.status = STEP_STATUS.untouched;
            if (this.config.anchorSettings.markDoneStep) {
                this.currentStep.status = STEP_STATUS.done;
                if (this.config.anchorSettings.removeDoneStepOnNavigateBack) {
                    this.steps.forEach((/**
                     * @param {?} step
                     * @return {?}
                     */
                    step => {
                        if (step.index > selectedStep.index) {
                            step.status = STEP_STATUS.untouched;
                        }
                    }));
                }
            }
        }
        // Next step anchor > Remove other classes and add active class
        selectedStep.status = STEP_STATUS.active;
    }
    /**
     * @param {?} index
     * @return {?}
     */
    _setButtons(index) {
        // Previous/Next Button enable/disable based on step
        if (!this.config.cycleSteps) {
            if (0 >= index) {
                this.styles.previousButton = 'btn btn-secondary ng-wizard-btn-prev disabled';
            }
            else {
                this.styles.previousButton = 'btn btn-secondary ng-wizard-btn-prev';
            }
            if (this.steps.length - 1 <= index) {
                this.styles.nextButton = 'btn btn-secondary ng-wizard-btn-next disabled';
            }
            else {
                this.styles.nextButton = 'btn btn-secondary ng-wizard-btn-next';
            }
        }
    }
    /**
     * @param {?} button
     * @return {?}
     */
    _extraButtonClicked(button) {
        if (button.event) {
            button.event();
        }
    }
    // HELPER FUNCTIONS
    /**
     * @param {?} event
     * @return {?}
     */
    _keyNav(event) {
        // Keyboard navigation
        switch (event.which) {
            case 37:
                // left
                this._showPreviousStep(event);
                event.preventDefault();
                break;
            case 39:
                // right
                this._showNextStep(event);
                event.preventDefault();
                break;
            default:
                return; // exit this handler for other keys
        }
    }
    /*
      _showLoader() {
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme + ' ng-wizard-loading';
      }
    
      _hideLoader() {
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
      }
      */
    // PUBLIC FUNCTIONS
    /**
     * @param {?} theme
     * @return {?}
     */
    _setTheme(theme) {
        if (this.config.theme == theme) {
            return false;
        }
        this.config.theme = theme;
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
        // Trigger "themeChanged" event
        this.themeChanged.emit(this.config.theme);
    }
    /**
     * @return {?}
     */
    _reset() {
        // Reset all elements and classes
        this.current_index = null;
        this.currentStep = null;
        this._restoreStepStates();
        this._init();
        // Trigger "reseted" event
        this.reseted.emit();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        if (this.resetWizardWatcher) {
            this.resetWizardWatcher.unsubscribe();
        }
        if (this.showNextStepWatcher) {
            this.showNextStepWatcher.unsubscribe();
        }
        if (this.showPreviousStepWatcher) {
            this.showPreviousStepWatcher.unsubscribe();
        }
        if (this.setThemeWatcher) {
            this.setThemeWatcher.unsubscribe();
        }
    }
}
NgWizardComponent.decorators = [
    { type: Component, args: [{
                selector: 'ng-wizard',
                template: "<div id=\"ngwizard\" [ngClass]=\"styles.main\">\n    <ul class=\"nav nav-tabs step-anchor\">\n        <li *ngFor=\"let step of steps; let i = index\" [ngClass]=\"_getStepCssClass(step)\">\n            <a href=\"#step-{{ i }}\" (click)=\"_showSelectedStep($event, step)\"\n                class=\"nav-link\">{{ step.title }}<br /><small>{{ step.description }}</small></a>\n        </li>\n    </ul>\n\n    <div *ngIf=\"showToolbarTop\" [ngClass]=\"styles.toolbarTop\">\n        <div class=\"btn-group mr-2 ng-wizard-btn-group\" role=\"group\">\n            <button *ngIf=\"showPreviousButton\" [ngClass]=\"styles.previousButton\" type=\"button\"\n                (click)=\"_showPreviousStep($event)\">{{ config.lang.previous }}</button>\n            <button *ngIf=\"showNextButton\" [ngClass]=\"styles.nextButton\" type=\"button\"\n                (click)=\"_showNextStep($event)\">{{ config.lang.next }}</button>\n        </div>\n\n        <div *ngIf=\"showExtraButtons\" class=\"btn-group mr-2 ng-wizard-btn-group-extra\" role=\"group\">\n            <button *ngFor=\"let button of config.toolbarSettings.toolbarExtraButtons; let j = index\"\n                [ngClass]=\"button.class\" type=\"button\" (click)=\"_extraButtonClicked(button)\">{{ button.text }}</button>\n        </div>\n    </div>\n\n    <div class=\"ng-wizard-container tab-content\">\n        <ng-content></ng-content>\n    </div>\n\n    <div *ngIf=\"showToolbarBottom\" [ngClass]=\"styles.toolbarBottom\">\n        <div class=\"btn-group mr-2 ng-wizard-btn-group\" role=\"group\">\n            <button *ngIf=\"showPreviousButton\" [ngClass]=\"styles.previousButton\" type=\"button\"\n                (click)=\"_showPreviousStep($event)\">{{ config.lang.previous }}</button>\n            <button *ngIf=\"showNextButton\" [ngClass]=\"styles.nextButton\" type=\"button\"\n                (click)=\"_showNextStep($event)\">{{ config.lang.next }}</button>\n        </div>\n\n        <div *ngIf=\"showExtraButtons\" class=\"btn-group mr-2 ng-wizard-btn-group-extra\" role=\"group\">\n            <button *ngFor=\"let button of config.toolbarSettings.toolbarExtraButtons; let j = index\"\n                [ngClass]=\"button.class\" type=\"button\" (click)=\"_extraButtonClicked(button)\">{{ button.text }}</button>\n        </div>\n    </div>\n</div>",
                styles: [""]
            }] }
];
/** @nocollapse */
NgWizardComponent.ctorParameters = () => [
    { type: NgWizardService }
];
NgWizardComponent.propDecorators = {
    steps: [{ type: ContentChildren, args: [NgWizardStep,] }],
    pConfig: [{ type: Input, args: ['config',] }],
    stepChanged: [{ type: Output }],
    themeChanged: [{ type: Output }],
    reseted: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    NgWizardComponent.prototype.steps;
    /** @type {?} */
    NgWizardComponent.prototype._pConfig;
    /** @type {?} */
    NgWizardComponent.prototype.config;
    /** @type {?} */
    NgWizardComponent.prototype.stepChanged;
    /** @type {?} */
    NgWizardComponent.prototype.themeChanged;
    /** @type {?} */
    NgWizardComponent.prototype.reseted;
    /** @type {?} */
    NgWizardComponent.prototype.styles;
    /** @type {?} */
    NgWizardComponent.prototype.showToolbarTop;
    /** @type {?} */
    NgWizardComponent.prototype.showPreviousButton;
    /** @type {?} */
    NgWizardComponent.prototype.showNextButton;
    /** @type {?} */
    NgWizardComponent.prototype.showToolbarBottom;
    /** @type {?} */
    NgWizardComponent.prototype.showExtraButtons;
    /** @type {?} */
    NgWizardComponent.prototype.current_index;
    /** @type {?} */
    NgWizardComponent.prototype.currentStep;
    /** @type {?} */
    NgWizardComponent.prototype.resetWizardWatcher;
    /** @type {?} */
    NgWizardComponent.prototype.showNextStepWatcher;
    /** @type {?} */
    NgWizardComponent.prototype.showPreviousStepWatcher;
    /** @type {?} */
    NgWizardComponent.prototype.setThemeWatcher;
    /**
     * @type {?}
     * @private
     */
    NgWizardComponent.prototype.ngService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctd2l6YXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXdpemFyZC8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL3dpemFyZC9uZy13aXphcmQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFvQixLQUFLLEVBQWEsWUFBWSxFQUFFLE1BQU0sRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR2hJLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RCxPQUFPLEVBQWtCLFlBQVksRUFBa0MsTUFBTSx3QkFBd0IsQ0FBQztBQUN0RyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBUyxNQUFNLG1CQUFtQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQU85QyxNQUFNLE9BQU8saUJBQWlCOzs7O0lBMkM1QixZQUFvQixTQUEwQjtRQUExQixjQUFTLEdBQVQsU0FBUyxDQUFpQjtRQTFCcEMsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUNsRCxpQkFBWSxHQUFHLElBQUksWUFBWSxFQUFTLENBQUM7UUFDekMsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFFN0MsV0FBTSxHQU9GLEVBQUUsQ0FBQztRQUVQLG1CQUFjLEdBQVksS0FBSyxDQUFDO1FBQ2hDLHVCQUFrQixHQUFZLEtBQUssQ0FBQztRQUNwQyxtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUNoQyxzQkFBaUIsR0FBWSxLQUFLLENBQUM7UUFDbkMscUJBQWdCLEdBQVksS0FBSyxDQUFDO1FBQ2xDLGtCQUFhLEdBQVcsSUFBSSxDQUFDLENBQUMsb0JBQW9CO0lBU2xELENBQUM7Ozs7SUF0Q0QsSUFBSSxPQUFPO1FBQ1QsT0FBTyxJQUFJLENBQUMsUUFBUSxJQUFJLEVBQUUsQ0FBQztJ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LHdDQUEwQjs7SUFFMUIsK0NBQWlDOztJQUNqQyxnREFBa0M7O0lBQ2xDLG9EQUFzQzs7SUFDdEMsNENBQThCOzs7OztJQUVsQixzQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEFmdGVyQ29udGVudEluaXQsIElucHV0LCBPbkRlc3Ryb3ksIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBDb250ZW50Q2hpbGRyZW4sIFF1ZXJ5TGlzdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IE5nV2l6YXJkU2VydmljZSB9IGZyb20gJy4uL25nLXdpemFyZC5zZXJ2aWNlJztcbmltcG9ydCB7IE5nV2l6YXJkQ29uZmlnLCBOZ1dpemFyZFN0ZXAsIFRvb2xiYXJCdXR0b24sIFN0ZXBDaGFuZ2VkQXJncyB9IGZyb20gJy4uLy4uL3V0aWxzL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgVE9PTEJBUl9QT1NJVElPTiwgU1RFUF9TVEFURSwgU1RFUF9TVEFUVVMsIFRIRU1FIH0gZnJvbSAnLi4vLi4vdXRpbHMvZW51bXMnO1xuaW1wb3J0IHsgbWVyZ2UgfSBmcm9tICcuLi8uLi91dGlscy9mdW5jdGlvbnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZy13aXphcmQnLFxuICB0ZW1wbGF0ZVVybDogJy4vbmctd2l6YXJkLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vbmctd2l6YXJkLmNvbXBvbmVudC5jc3MnXSxcbn0pXG5leHBvcnQgY2xhc3MgTmdXaXphcmRDb21wb25lbnQgaW1wbGVtZW50cyBPbkRlc3Ryb3ksIEFmdGVyQ29udGVudEluaXQge1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oTmdXaXphcmRTdGVwKVxuICBwdWJsaWMgc3RlcHM6IFF1ZXJ5TGlzdDxOZ1dpemFyZFN0ZXA+O1xuXG4gIF9wQ29uZmlnOiBOZ1dpemFyZENvbmZpZztcbiAgZ2V0IHBDb25maWcoKTogTmdXaXphcmRDb25maWcge1xuICAgIHJldHVybiB0aGlzLl9wQ29uZmlnIHx8IHt9O1xuICB9XG5cbiAgQElucHV0KCdjb25maWcnKVxuICBzZXQgcENvbmZpZyhjb25maWc6IE5nV2l6YXJkQ29uZmlnKSB7XG4gICAgdGhpcy5fcENvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIGNvbmZpZzogTmdXaXphcmRDb25maWc7XG5cbiAgQE91dHB1dCgpIHN0ZXBDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjxTdGVwQ2hhbmdlZEFyZ3M+KCk7XG4gIEBPdXRwdXQoKSB0aGVtZUNoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFRIRU1FPigpO1xuICBAT3V0cHV0KCkgcmVzZXRlZCA9IG5ldyBFdmVudEVtaXR0ZXI8dm9pZD4oKTtcblxuICBzdHlsZXM6IHtcbiAgICBtYWluPzogc3RyaW5nO1xuICAgIHN0ZXA/OiBzdHJpbmc7XG4gICAgcHJldmlvdXNCdXR0b24/OiBzdHJpbmc7XG4gICAgbmV4dEJ1dHRvbj86IHN0cmluZztcbiAgICB0b29sYmFyVG9wPzogc3RyaW5nO1xuICAgIHRvb2xiYXJCb3R0b20/OiBzdHJpbmc7XG4gIH0gPSB7fTtcblxuICBzaG93VG9vbGJhclRvcDogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93UHJldmlvdXNCdXR0b246IGJvb2xlYW4gPSBmYWxzZTtcbiAgc2hvd05leHRCdXR0b246IGJvb2xlYW4gPSBmYWxzZTtcbiAgc2hvd1Rvb2xiYXJCb3R0b206IGJvb2xlYW4gPSBmYWxzZTtcbiAgc2hvd0V4dHJhQnV0dG9uczogYm9vbGVhbiA9IGZhbHNlO1xuICBjdXJyZW50X2luZGV4OiBudW1iZXIgPSBudWxsOyAvLyBBY3RpdmUgc3RlcCBpbmRleFxuICBjdXJyZW50U3RlcDogTmdXaXphcmRTdGVwOyAvLyBBY3RpdmUgc3RlcFxuXG4gIHJlc2V0V2l6YXJkV2F0Y2hlcjogU3Vic2NyaXB0aW9uO1xuICBzaG93TmV4dFN0ZXBXYXRjaGVyOiBTdWJzY3JpcHRpb247XG4gIHNob3dQcmV2aW91c1N0ZXBXYXRjaGVyOiBTdWJzY3JpcHRpb247XG4gIHNldFRoZW1lV2F0Y2hlcjogU3Vic2NyaXB0aW9uO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdTZXJ2aWNlOiBOZ1dpemFyZFNlcnZpY2UpIHtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICB0aGlzLl9iYWNrdXBTdGVwU3RhdGVzKCk7XG5cbiAgICB0aGlzLl9pbml0KCk7XG5cbiAgICAvLyBTZXQgdG9vbGJhclxuICAgIHRoaXMuX3NldFRvb2xiYXIoKTtcblxuICAgIC8vIEFzc2lnbiBwbHVnaW4gZXZlbnRzXG4gICAgdGhpcy5fc2V0RXZlbnRzKCk7XG5cbiAgICB0aGlzLnJlc2V0V2l6YXJkV2F0Y2hlciA9IHRoaXMubmdTZXJ2aWNlLnJlc2V0V2l6YXJkJFxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuX3Jlc2V0KCk7XG4gICAgICB9KTtcblxuICAgIHRoaXMuc2hvd05leHRTdGVwV2F0Y2hlciA9IHRoaXMubmdTZXJ2aWNlLnNob3dOZXh0U3RlcCRcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLl9zaG93TmV4dFN0ZXAoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy5zaG93UHJldmlvdXNTdGVwV2F0Y2hlciA9IHRoaXMubmdTZXJ2aWNlLnNob3dQcmV2aW91c1N0ZXAkXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5fc2hvd1ByZXZpb3VzU3RlcCgpO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLnNldFRoZW1lV2F0Y2hlciA9IHRoaXMubmdTZXJ2aWNlLnNldFRoZW1lJFxuICAgICAgLnN1YnNjcmliZSh0aGVtZSA9PiB7XG4gICAgICAgIHRoaXMuX3NldFRoZW1lKHRoZW1lKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgX2luaXQoKSB7XG4gICAgLy8gc2V0IGNvbmZpZ1xuICAgIHZhciBkZWZhdWx0Q29uZmlnID0gdGhpcy5uZ1NlcnZpY2UuZ2V0RGVmYXVsdENvbmZpZygpO1xuICAgIHRoaXMuY29uZmlnID0gbWVyZ2UoZGVmYXVsdENvbmZpZywgdGhpcy5wQ29uZmlnKTtcblxuICAgIC8vIHNldCBzdGVwIHN0YXRlc1xuICAgIHRoaXMuX2luaXRTdGVwcygpO1xuXG4gICAgLy8gU2V0IHRoZSBlbGVtZW50c1xuICAgIHRoaXMuX2luaXRTdHlsZXMoKTtcblxuICAgIC8vIFNob3cgdGhlIGluaXRpYWwgc3RlcFxuICAgIHRoaXMuX3Nob3dTdGVwKHRoaXMuY29uZmlnLnNlbGVjdGVkKTtcbiAgfVxuXG4gIF9pbml0U3RlcHMoKSB7XG4gICAgdGhpcy5zdGVwcy5mb3JFYWNoKChzdGVwLCBpbmRleCkgPT4ge1xuICAgICAgc3RlcC5pbmRleCA9IGluZGV4O1xuICAgICAgc3RlcC5zdGF0dXMgPSBzdGVwLnN0YXR1cyB8fCBTVEVQX1NUQVRVUy51bnRvdWNoZWQ7XG4gICAgICBzdGVwLnN0YXRlID0gc3RlcC5zdGF0ZSB8fCBTVEVQX1NUQVRFLm5vcm1hbDtcbiAgICB9KTtcblxuICAgIC8vIE1hcmsgcHJldmlvdXMgc3RlcHMgb2YgdGhlIGFjdGl2ZSBzdGVwIGFzIGRvbmVcbiAgICBpZiAodGhpcy5jb25maWcuc2VsZWN0ZWQgPiAwXG4gICAgICAmJiB0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5tYXJrRG9uZVN0ZXBcbiAgICAgICYmIHRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLm1hcmtBbGxQcmV2aW91c1N0ZXBzQXNEb25lKSB7XG5cbiAgICAgIHRoaXMuc3RlcHMuZm9yRWFjaChzdGVwID0+IHtcbiAgICAgICAgaWYgKHN0ZXAuc3RhdGUgIT0gU1RFUF9TVEFURS5kaXNhYmxlZCAmJiBzdGVwLnN0YXRlICE9IFNURVBfU1RBVEUuaGlkZGVuKSB7XG4gICAgICAgICAgc3RlcC5zdGF0dXMgPSBzdGVwLmluZGV4IDwgdGhpcy5jb25maWcuc2VsZWN0ZWQgPyBTVEVQX1NUQVRVUy5kb25lIDogc3RlcC5zdGF0dXM7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9iYWNrdXBTdGVwU3RhdGVzKCkge1xuICAgIHRoaXMuc3RlcHMuZm9yRWFjaChzdGVwID0+IHtcbiAgICAgIHN0ZXAuaW5pdGlhbFN0YXR1cyA9IHN0ZXAuc3RhdHVzO1xuICAgICAgc3RlcC5pbml0aWFsU3RhdGUgPSBzdGVwLnN0YXRlO1xuICAgIH0pO1xuICB9XG5cbiAgX3Jlc3RvcmVTdGVwU3RhdGVzKCkge1xuICAgIHRoaXMuc3RlcHMuZm9yRWFjaChzdGVwID0+IHtcbiAgICAgIHN0ZXAuc3RhdHVzID0gc3RlcC5pbml0aWFsU3RhdHVzO1xuICAgICAgc3RlcC5zdGF0ZSA9IHN0ZXAuaW5pdGlhbFN0YXRlO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gUFJJVkFURSBGVU5DVElPTlNcbiAgX2luaXRTdHlsZXMoKSB7XG4gICAgLy8gU2V0IHRoZSBtYWluIGVsZW1lbnRcbiAgICB0aGlzLnN0eWxlcy5tYWluID0gJ25nLXdpemFyZC1tYWluIG5nLXdpemFyZC10aGVtZS0nICsgdGhpcy5jb25maWcudGhlbWU7XG5cbiAgICAvLyBTZXQgYW5jaG9yIGVsZW1lbnRzXG4gICAgdGhpcy5zdHlsZXMuc3RlcCA9ICduYXYtaXRlbSc7IC8vIGxpXG5cbiAgICAvLyBNYWtlIHRoZSBhbmNob3IgY2xpY2thYmxlXG4gICAgaWYgKHRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLmVuYWJsZUFsbEFuY2hvcnMgJiYgdGhpcy5jb25maWcuYW5jaG9yU2V0dGluZ3MuYW5jaG9yQ2xpY2thYmxlKSB7XG4gICAgICB0aGlzLnN0eWxlcy5zdGVwICs9ICcgY2xpY2thYmxlJztcbiAgICB9XG5cbiAgICAvLyBTZXQgdGhlIHRvb2xiYXIgc3R5bGVzXG4gICAgdGhpcy5zdHlsZXMudG9vbGJhclRvcCA9ICdidG4tdG9vbGJhciBuZy13aXphcmQtdG9vbGJhciBuZy13aXphcmQtdG9vbGJhci10b3AganVzdGlmeS1jb250ZW50LScgKyB0aGlzLmNvbmZpZy50b29sYmFyU2V0dGluZ3MudG9vbGJhckJ1dHRvblBvc2l0aW9uO1xuICAgIHRoaXMuc3R5bGVzLnRvb2xiYXJCb3R0b20gPSAnYnRuLXRvb2xiYXIgbmctd2l6YXJkLXRvb2xiYXIgbmctd2l6YXJkLXRvb2xiYXItYm90dG9tIGp1c3RpZnktY29udGVudC0nICsgdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJCdXR0b25Qb3NpdGlvbjtcblxuICAgIC8vIFNldCBwcmV2aW91cyZuZXh0IGJ1dHRvbnMgXG4gICAgdGhpcy5zdHlsZXMucHJldmlvdXNCdXR0b24gPSAnYnRuIGJ0bi1zZWNvbmRhcnkgbmctd2l6YXJkLWJ0bi1wcmV2JztcbiAgICB0aGlzLnN0eWxlcy5uZXh0QnV0dG9uID0gJ2J0biBidG4tc2Vjb25kYXJ5IG5nLXdpemFyZC1idG4tbmV4dCc7XG4gIH1cblxuICBfc2V0VG9vbGJhcigpIHtcbiAgICB0aGlzLnNob3dUb29sYmFyVG9wID0gdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJQb3NpdGlvbiA9PSBUT09MQkFSX1BPU0lUSU9OLnRvcCB8fFxuICAgICAgdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJQb3NpdGlvbiA9PSBUT09MQkFSX1BPU0lUSU9OLmJvdGg7XG5cbiAgICB0aGlzLnNob3dUb29sYmFyQm90dG9tID0gdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJQb3NpdGlvbiA9PSBUT09MQkFSX1BPU0lUSU9OLmJvdHRvbSB8fFxuICAgICAgdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJQb3NpdGlvbiA9PSBUT09MQkFSX1BPU0lUSU9OLmJvdGg7XG5cbiAgICB0aGlzLnNob3dQcmV2aW91c0J1dHRvbiA9IHRoaXMuY29uZmlnLnRvb2xiYXJTZXR0aW5ncy5zaG93UHJldmlvdXNCdXR0b247XG4gICAgdGhpcy5zaG93TmV4dEJ1dHRvbiA9IHRoaXMuY29uZmlnLnRvb2xiYXJTZXR0aW5ncy5zaG93TmV4dEJ1dHRvbjtcblxuICAgIHRoaXMuc2hvd0V4dHJhQnV0dG9ucyA9IHRoaXMuY29uZmlnLnRvb2xiYXJTZXR0aW5ncy50b29sYmFyRXh0cmFCdXR0b25zICYmIHRoaXMuY29uZmlnLnRvb2xiYXJTZXR0aW5ncy50b29sYmFyRXh0cmFCdXR0b25zLmxlbmd0aCA+IDA7XG4gIH1cblxuICBfc2V0RXZlbnRzKCkge1xuICAgIC8vVE9ETzoga2V5TmF2aWdhdGlvblxuICAgIC8vIEtleWJvYXJkIG5hdmlnYXRpb24gZXZlbnRcbiAgICBpZiAodGhpcy5jb25maWcua2V5TmF2aWdhdGlvbikge1xuICAgICAgLy8gJChkb2N1bWVudCkua2V5dXAoZnVuY3Rpb24gKGUpIHtcbiAgICAgIC8vICAgbWkuX2tleU5hdihlKTtcbiAgICAgIC8vIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9nZXRTdGVwQ3NzQ2xhc3Moc2VsZWN0ZWRTdGVwOiBOZ1dpemFyZFN0ZXApIHtcbiAgICB2YXIgc3RlcENsYXNzID0gdGhpcy5zdHlsZXMuc3RlcDtcblxuICAgIHN3aXRjaCAoc2VsZWN0ZWRTdGVwLnN0YXRlKSB7XG4gICAgICBjYXNlIFNURVBfU1RBVEUuZGlzYWJsZWQ6XG4gICAgICAgIHN0ZXBDbGFzcyArPSAnIGRpc2FibGVkJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNURVBfU1RBVEUuZXJyb3I6XG4gICAgICAgIHN0ZXBDbGFzcyArPSAnIGRhbmdlcic7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBTVEVQX1NUQVRFLmhpZGRlbjpcbiAgICAgICAgc3RlcENsYXNzICs9ICcgaGlkZGVuJztcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgc3dpdGNoIChzZWxlY3RlZFN0ZXAuc3RhdHVzKSB7XG4gICAgICBjYXNlIFNURVBfU1RBVFVTLmRvbmU6XG4gICAgICAgIHN0ZXBDbGFzcyArPSAnIGRvbmUnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU1RFUF9TVEFUVVMuYWN0aXZlOlxuICAgICAgICBzdGVwQ2xhc3MgKz0gJyBhY3RpdmUnO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICByZXR1cm4gc3RlcENsYXNzO1xuICB9XG5cbiAgX3Nob3dTZWxlY3RlZFN0ZXAoZXZlbnQ6IEV2ZW50LCBzZWxlY3RlZFN0ZXA6IE5nV2l6YXJkU3RlcCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICBpZiAoIXRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLmFuY2hvckNsaWNrYWJsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5jb25maWcuYW5jaG9yU2V0dGluZ3MuZW5hYmxlQW5jaG9yT25Eb25lU3RlcCAmJiBzZWxlY3RlZFN0ZXAuc3RhdHVzID09IFNURVBfU1RBVFVTLmRvbmUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmIChzZWxlY3RlZFN0ZXAuaW5kZXggIT0gdGhpcy5jdXJyZW50X2luZGV4KSB7XG4gICAgICBpZiAodGhpcy5jb25maWcuYW5jaG9yU2V0dGluZ3MuZW5hYmxlQWxsQW5jaG9ycyAmJiB0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5hbmNob3JDbGlja2FibGUpIHtcbiAgICAgICAgdGhpcy5fc2hvd1N0ZXAoc2VsZWN0ZWRTdGVwLmluZGV4KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBpZiAoc2VsZWN0ZWRTdGVwLnN0YXR1cyA9PSBTVEVQX1NUQVRVUy5kb25lKSB7XG4gICAgICAgICAgdGhpcy5fc2hvd1N0ZXAoc2VsZWN0ZWRTdGVwLmluZGV4KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9zaG93TmV4dFN0ZXAoZXZlbnQ/OiBFdmVudCkge1xuICAgIGlmIChldmVudCkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gICAgLy8gRmluZCB0aGUgbmV4dCBub3QgZGlzYWJsZWQgJiBoaWRkZW4gc3RlcFxuICAgIHZhciBmaWx0ZXJlZFN0ZXBzID0gdGhpcy5zdGVwcy5maWx0ZXIoc3RlcCA9PiB7XG4gICAgICByZXR1cm4gc3RlcC5pbmRleCA+ICh0aGlzLmN1cnJlbnRfaW5kZXggPT0gbnVsbCA/IC0xIDogdGhpcy5jdXJyZW50X2luZGV4KVxuICAgICAgICAmJiBzdGVwLnN0YXRlICE9IFNURVBfU1RBVEUuZGlzYWJsZWRcbiAgICAgICAgJiYgc3RlcC5zdGF0ZSAhPSBTVEVQX1NUQVRFLmhpZGRlbjtcbiAgICB9KTtcblxuICAgIGlmIChmaWx0ZXJlZFN0ZXBzLmxlbmd0aCA9PSAwKSB7XG4gICAgICBpZiAoIXRoaXMuY29uZmlnLmN5Y2xlU3RlcHMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9zaG93U3RlcCgwKVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dTdGVwKGZpbHRlcmVkU3RlcHMuc2hpZnQoKS5pbmRleClcbiAgICB9XG4gIH1cblxuICBfc2hvd1ByZXZpb3VzU3RlcChldmVudD86IEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICAvLyBGaW5kIHRoZSBwcmV2aW91cyBub3QgZGlzYWJsZWQgJiBoaWRkZW4gc3RlcFxuICAgIHZhciBmaWx0ZXJlZFN0ZXBzID0gdGhpcy5zdGVwcy5maWx0ZXIoc3RlcCA9PiB7XG4gICAgICByZXR1cm4gc3RlcC5pbmRleCA8ICh0aGlzLmN1cnJlbnRfaW5kZXggPT0gbnVsbCAmJiB0aGlzLmNvbmZpZy5jeWNsZVN0ZXBzID8gdGhpcy5zdGVwcy5sZW5ndGggOiB0aGlzLmN1cnJlbnRfaW5kZXgpXG4gICAgICAgICYmIHN0ZXAuc3RhdGUgIT0gU1RFUF9TVEFURS5kaXNhYmxlZFxuICAgICAgICAmJiBzdGVwLnN0YXRlICE9IFNURVBfU1RBVEUuaGlkZGVuO1xuICAgIH0pO1xuXG4gICAgaWYgKGZpbHRlcmVkU3RlcHMubGVuZ3RoID09IDApIHtcbiAgICAgIGlmICghdGhpcy5jb25maWcuY3ljbGVTdGVwcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3Nob3dTdGVwKHRoaXMuc3RlcHMubGVuZ3RoIC0gMSlcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLl9zaG93U3RlcChmaWx0ZXJlZFN0ZXBzLnBvcCgpLmluZGV4KVxuICAgIH1cbiAgfVxuXG4gIF9zaG93U3RlcChpbmRleDogbnVtYmVyKSB7XG4gICAgLy8gSWYgc3RlcCBub3QgZm91bmQsIHNraXBcbiAgICBpZiAoaW5kZXggPj0gdGhpcy5zdGVwcy5sZW5ndGggfHwgaW5kZXggPCAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIC8vIElmIGN1cnJlbnQgc3RlcCBpcyByZXF1ZXN0ZWQgYWdhaW4sIHNraXBcbiAgICBpZiAoaW5kZXggPT0gdGhpcy5jdXJyZW50X2luZGV4KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBzZWxlY3RlZFN0ZXAgPSB0aGlzLnN0ZXBzLnRvQXJyYXkoKVtpbmRleF07XG4gICAgLy8gSWYgaXQgaXMgYSBkaXNhYmxlZCBvciBoaWRkZW4gc3RlcCwgc2tpcFxuICAgIGlmIChzZWxlY3RlZFN0ZXAuc3RhdGUgPT0gU1RFUF9TVEFURS5kaXNhYmxlZCB8fCBzZWxlY3RlZFN0ZXAuc3RhdGUgPT0gU1RFUF9TVEFURS5oaWRkZW4pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBMb2FkIHN0ZXAgY29udGVudFxuICAgIHRoaXMuX2xvYWRTdGVwQ29udGVudChzZWxlY3RlZFN0ZXApO1xuICB9XG5cbiAgX2xvYWRTdGVwQ29udGVudChzZWxlY3RlZFN0ZXA6IE5nV2l6YXJkU3RlcCkge1xuICAgIC8vIEdldCB0aGUgZGlyZWN0aW9uIG9mIHN0ZXAgbmF2aWdhdGlvblxuICAgIHZhciBzdGVwRGlyZWN0aW9uID0gKHRoaXMuY3VycmVudF9pbmRleCAhPSBudWxsICYmIHRoaXMuY3VycmVudF9pbmRleCAhPSBzZWxlY3RlZFN0ZXAuaW5kZXgpID8gKHRoaXMuY3VycmVudF9pbmRleCA8IHNlbGVjdGVkU3RlcC5pbmRleCA/IFwiZm9yd2FyZFwiIDogXCJiYWNrd2FyZFwiKSA6ICcnO1xuICAgIHZhciBzdGVwUG9zaXRpb24gPSAoc2VsZWN0ZWRTdGVwLmluZGV4ID09IDApID8gJ2ZpcnN0JyA6IChzZWxlY3RlZFN0ZXAuaW5kZXggPT0gdGhpcy5zdGVwcy5sZW5ndGggLSAxID8gJ2ZpbmFsJyA6ICdtaWRkbGUnKTtcblxuICAgIC8vIFVwZGF0ZSBjb250cm9sc1xuICAgIHRoaXMuX3NldEFuY2hvcihzZWxlY3RlZFN0ZXApO1xuICAgIC8vIFNldCB0aGUgYnV0dG9ucyBiYXNlZCBvbiB0aGUgc3RlcFxuICAgIHRoaXMuX3NldEJ1dHRvbnMoc2VsZWN0ZWRTdGVwLmluZGV4KTtcblxuICAgIC8vIFRyaWdnZXIgXCJzdGVwQ2hhbmdlZFwiIGV2ZW50XG4gICAgdGhpcy5zdGVwQ2hhbmdlZC5lbWl0KHtcbiAgICAgIHN0ZXA6IHNlbGVjdGVkU3RlcCxcbiAgICAgIHByZXZpb3VzU3RlcDogdGhpcy5jdXJyZW50U3RlcCxcbiAgICAgIGRpcmVjdGlvbjogc3RlcERpcmVjdGlvbixcbiAgICAgIHBvc2l0aW9uOiBzdGVwUG9zaXRpb25cbiAgICB9KTtcblxuICAgIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBpbmRleFxuICAgIHRoaXMuY3VycmVudF9pbmRleCA9IHNlbGVjdGVkU3RlcC5pbmRleDtcbiAgICB0aGlzLmN1cnJlbnRTdGVwID0gc2VsZWN0ZWRTdGVwO1xuICB9XG5cbiAgX3NldEFuY2hvcihzZWxlY3RlZFN0ZXA6IE5nV2l6YXJkU3RlcCkge1xuICAgIC8vIEN1cnJlbnQgc3RlcCBhbmNob3IgPiBSZW1vdmUgb3RoZXIgY2xhc3NlcyBhbmQgYWRkIGRvbmUgY2xhc3NcbiAgICBpZiAodGhpcy5jdXJyZW50U3RlcCkge1xuICAgICAgdGhpcy5jdXJyZW50U3RlcC5zdGF0dXMgPSBTVEVQX1NUQVRVUy51bnRvdWNoZWQ7XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5tYXJrRG9uZVN0ZXApIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RlcC5zdGF0dXMgPSBTVEVQX1NUQVRVUy5kb25lO1xuXG4gICAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5yZW1vdmVEb25lU3RlcE9uTmF2aWdhdGVCYWNrKSB7XG4gICAgICAgICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgICAgICAgaWYgKHN0ZXAuaW5kZXggPiBzZWxlY3RlZFN0ZXAuaW5kZXgpIHtcbiAgICAgICAgICAgICAgc3RlcC5zdGF0dXMgPSBTVEVQX1NUQVRVUy51bnRvdWNoZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBOZXh0IHN0ZXAgYW5jaG9yID4gUmVtb3ZlIG90aGVyIGNsYXNzZXMgYW5kIGFkZCBhY3RpdmUgY2xhc3NcbiAgICBzZWxlY3RlZFN0ZXAuc3RhdHVzID0gU1RFUF9TVEFUVVMuYWN0aXZlO1xuICB9XG5cbiAgX3NldEJ1dHRvbnMoaW5kZXg6IG51bWJlcikge1xuICAgIC8vIFByZXZpb3VzL05leHQgQnV0dG9uIGVuYWJsZS9kaXNhYmxlIGJhc2VkIG9uIHN0ZXBcbiAgICBpZiAoIXRoaXMuY29uZmlnLmN5Y2xlU3RlcHMpIHtcbiAgICAgIGlmICgwID49IGluZGV4KSB7XG4gICAgICAgIHRoaXMuc3R5bGVzLnByZXZpb3VzQnV0dG9uID0gJ2J0biBidG4tc2Vjb25kYXJ5IG5nLXdpemFyZC1idG4tcHJldiBkaXNhYmxlZCc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5zdHlsZXMucHJldmlvdXNCdXR0b24gPSAnYnRuIGJ0bi1zZWNvbmRhcnkgbmctd2l6YXJkLWJ0bi1wcmV2JztcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuc3RlcHMubGVuZ3RoIC0gMSA8PSBpbmRleCkge1xuICAgICAgICB0aGlzLnN0eWxlcy5uZXh0QnV0dG9uID0gJ2J0biBidG4tc2Vjb25kYXJ5IG5nLXdpemFyZC1idG4tbmV4dCBkaXNhYmxlZCc7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5zdHlsZXMubmV4dEJ1dHRvbiA9ICdidG4gYnRuLXNlY29uZGFyeSBuZy13aXphcmQtYnRuLW5leHQnO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIF9leHRyYUJ1dHRvbkNsaWNrZWQoYnV0dG9uOiBUb29sYmFyQnV0dG9uKSB7XG4gICAgaWYgKGJ1dHRvbi5ldmVudCkge1xuICAgICAgYnV0dG9uLmV2ZW50KCk7XG4gICAgfVxuICB9XG5cbiAgLy8gSEVMUEVSIEZVTkNUSU9OU1xuICBfa2V5TmF2KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgLy8gS2V5Ym9hcmQgbmF2aWdhdGlvblxuICAgIHN3aXRjaCAoZXZlbnQud2hpY2gpIHtcbiAgICAgIGNhc2UgMzc6XG4gICAgICAgIC8vIGxlZnRcbiAgICAgICAgdGhpcy5fc2hvd1ByZXZpb3VzU3RlcChldmVudCk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAzOTpcbiAgICAgICAgLy8gcmlnaHRcbiAgICAgICAgdGhpcy5fc2hvd05leHRTdGVwKGV2ZW50KTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm47IC8vIGV4aXQgdGhpcyBoYW5kbGVyIGZvciBvdGhlciBrZXlzXG4gICAgfVxuICB9XG5cbiAgLypcbiAgX3Nob3dMb2FkZXIoKSB7XG4gICAgdGhpcy5zdHlsZXMubWFpbiA9ICduZy13aXphcmQtbWFpbiBuZy13aXphcmQtdGhlbWUtJyArIHRoaXMuY29uZmlnLnRoZW1lICsgJyBuZy13aXphcmQtbG9hZGluZyc7XG4gIH1cblxuICBfaGlkZUxvYWRlcigpIHtcbiAgICB0aGlzLnN0eWxlcy5tYWluID0gJ25nLXdpemFyZC1tYWluIG5nLXdpemFyZC10aGVtZS0nICsgdGhpcy5jb25maWcudGhlbWU7XG4gIH1cbiAgKi9cblxuICAvLyBQVUJMSUMgRlVOQ1RJT05TXG4gIF9zZXRUaGVtZSh0aGVtZTogVEhFTUUpIHtcbiAgICBpZiAodGhpcy5jb25maWcudGhlbWUgPT0gdGhlbWUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbmZpZy50aGVtZSA9IHRoZW1lO1xuICAgIHRoaXMuc3R5bGVzLm1haW4gPSAnbmctd2l6YXJkLW1haW4gbmctd2l6YXJkLXRoZW1lLScgKyB0aGlzLmNvbmZpZy50aGVtZTtcblxuICAgIC8vIFRyaWdnZXIgXCJ0aGVtZUNoYW5nZWRcIiBldmVudFxuICAgIHRoaXMudGhlbWVDaGFuZ2VkLmVtaXQodGhpcy5jb25maWcudGhlbWUpO1xuICB9XG5cbiAgX3Jlc2V0KCkge1xuICAgIC8vIFJlc2V0IGFsbCBlbGVtZW50cyBhbmQgY2xhc3Nlc1xuICAgIHRoaXMuY3VycmVudF9pbmRleCA9IG51bGw7XG4gICAgdGhpcy5jdXJyZW50U3RlcCA9IG51bGw7XG4gICAgdGhpcy5fcmVzdG9yZVN0ZXBTdGF0ZXMoKTtcbiAgICB0aGlzLl9pbml0KCk7XG5cbiAgICAvLyBUcmlnZ2VyIFwicmVzZXRlZFwiIGV2ZW50XG4gICAgdGhpcy5yZXNldGVkLmVtaXQoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIGlmICh0aGlzLnJlc2V0V2l6YXJkV2F0Y2hlcikge1xuICAgICAgdGhpcy5yZXNldFdpemFyZFdhdGNoZXIudW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zaG93TmV4dFN0ZXBXYXRjaGVyKSB7XG4gICAgICB0aGlzLnNob3dOZXh0U3RlcFdhdGNoZXIudW5zdWJzY3JpYmUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zaG93UHJldmlvdXNTdGVwV2F0Y2hlcikge1xuICAgICAgdGhpcy5zaG93UHJldmlvdXNTdGVwV2F0Y2hlci51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNldFRoZW1lV2F0Y2hlcikge1xuICAgICAgdGhpcy5zZXRUaGVtZVdhdGNoZXIudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==