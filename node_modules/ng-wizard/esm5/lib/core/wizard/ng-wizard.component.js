/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ContentChildren, QueryList } from '@angular/core';
import { NgWizardService } from '../ng-wizard.service';
import { NgWizardStep } from '../../utils/interfaces';
import { TOOLBAR_POSITION, STEP_STATE, STEP_STATUS } from '../../utils/enums';
import { merge } from '../../utils/functions';
var NgWizardComponent = /** @class */ (function () {
    function NgWizardComponent(ngService) {
        this.ngService = ngService;
        this.stepChanged = new EventEmitter();
        this.themeChanged = new EventEmitter();
        this.reseted = new EventEmitter();
        this.styles = {};
        this.showToolbarTop = false;
        this.showPreviousButton = false;
        this.showNextButton = false;
        this.showToolbarBottom = false;
        this.showExtraButtons = false;
        this.current_index = null; // Active step index
    }
    Object.defineProperty(NgWizardComponent.prototype, "pConfig", {
        get: /**
         * @return {?}
         */
        function () {
            return this._pConfig || {};
        },
        set: /**
         * @param {?} config
         * @return {?}
         */
        function (config) {
            this._pConfig = config;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    NgWizardComponent.prototype.ngAfterContentInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._backupStepStates();
        this._init();
        // Set toolbar
        this._setToolbar();
        // Assign plugin events
        this._setEvents();
        this.resetWizardWatcher = this.ngService.resetWizard$
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this._reset();
        }));
        this.showNextStepWatcher = this.ngService.showNextStep$
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this._showNextStep();
        }));
        this.showPreviousStepWatcher = this.ngService.showPreviousStep$
            .subscribe((/**
         * @return {?}
         */
        function () {
            _this._showPreviousStep();
        }));
        this.setThemeWatcher = this.ngService.setTheme$
            .subscribe((/**
         * @param {?} theme
         * @return {?}
         */
        function (theme) {
            _this._setTheme(theme);
        }));
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._init = /**
     * @return {?}
     */
    function () {
        // set config
        /** @type {?} */
        var defaultConfig = this.ngService.getDefaultConfig();
        this.config = merge(defaultConfig, this.pConfig);
        // set step states
        this._initSteps();
        // Set the elements
        this._initStyles();
        // Show the initial step
        this._showStep(this.config.selected);
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._initSteps = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.steps.forEach((/**
         * @param {?} step
         * @param {?} index
         * @return {?}
         */
        function (step, index) {
            step.index = index;
            step.status = step.status || STEP_STATUS.untouched;
            step.state = step.state || STEP_STATE.normal;
        }));
        // Mark previous steps of the active step as done
        if (this.config.selected > 0
            && this.config.anchorSettings.markDoneStep
            && this.config.anchorSettings.markAllPreviousStepsAsDone) {
            this.steps.forEach((/**
             * @param {?} step
             * @return {?}
             */
            function (step) {
                if (step.state != STEP_STATE.disabled && step.state != STEP_STATE.hidden) {
                    step.status = step.index < _this.config.selected ? STEP_STATUS.done : step.status;
                }
            }));
        }
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._backupStepStates = /**
     * @return {?}
     */
    function () {
        this.steps.forEach((/**
         * @param {?} step
         * @return {?}
         */
        function (step) {
            step.initialStatus = step.status;
            step.initialState = step.state;
        }));
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._restoreStepStates = /**
     * @return {?}
     */
    function () {
        this.steps.forEach((/**
         * @param {?} step
         * @return {?}
         */
        function (step) {
            step.status = step.initialStatus;
            step.state = step.initialState;
        }));
    };
    // PRIVATE FUNCTIONS
    // PRIVATE FUNCTIONS
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._initStyles = 
    // PRIVATE FUNCTIONS
    /**
     * @return {?}
     */
    function () {
        // Set the main element
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
        // Set anchor elements
        this.styles.step = 'nav-item'; // li
        // Make the anchor clickable
        if (this.config.anchorSettings.enableAllAnchors && this.config.anchorSettings.anchorClickable) {
            this.styles.step += ' clickable';
        }
        // Set the toolbar styles
        this.styles.toolbarTop = 'btn-toolbar ng-wizard-toolbar ng-wizard-toolbar-top justify-content-' + this.config.toolbarSettings.toolbarButtonPosition;
        this.styles.toolbarBottom = 'btn-toolbar ng-wizard-toolbar ng-wizard-toolbar-bottom justify-content-' + this.config.toolbarSettings.toolbarButtonPosition;
        // Set previous&next buttons 
        this.styles.previousButton = 'btn btn-secondary ng-wizard-btn-prev';
        this.styles.nextButton = 'btn btn-secondary ng-wizard-btn-next';
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._setToolbar = /**
     * @return {?}
     */
    function () {
        this.showToolbarTop = this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.top ||
            this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.both;
        this.showToolbarBottom = this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.bottom ||
            this.config.toolbarSettings.toolbarPosition == TOOLBAR_POSITION.both;
        this.showPreviousButton = this.config.toolbarSettings.showPreviousButton;
        this.showNextButton = this.config.toolbarSettings.showNextButton;
        this.showExtraButtons = this.config.toolbarSettings.toolbarExtraButtons && this.config.toolbarSettings.toolbarExtraButtons.length > 0;
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._setEvents = /**
     * @return {?}
     */
    function () {
        //TODO: keyNavigation
        // Keyboard navigation event
        if (this.config.keyNavigation) {
            // $(document).keyup(function (e) {
            //   mi._keyNav(e);
            // });
        }
    };
    /**
     * @param {?} selectedStep
     * @return {?}
     */
    NgWizardComponent.prototype._getStepCssClass = /**
     * @param {?} selectedStep
     * @return {?}
     */
    function (selectedStep) {
        /** @type {?} */
        var stepClass = this.styles.step;
        switch (selectedStep.state) {
            case STEP_STATE.disabled:
                stepClass += ' disabled';
                break;
            case STEP_STATE.error:
                stepClass += ' danger';
                break;
            case STEP_STATE.hidden:
                stepClass += ' hidden';
                break;
        }
        switch (selectedStep.status) {
            case STEP_STATUS.done:
                stepClass += ' done';
                break;
            case STEP_STATUS.active:
                stepClass += ' active';
                break;
        }
        return stepClass;
    };
    /**
     * @param {?} event
     * @param {?} selectedStep
     * @return {?}
     */
    NgWizardComponent.prototype._showSelectedStep = /**
     * @param {?} event
     * @param {?} selectedStep
     * @return {?}
     */
    function (event, selectedStep) {
        event.preventDefault();
        if (!this.config.anchorSettings.anchorClickable) {
            return;
        }
        if (!this.config.anchorSettings.enableAnchorOnDoneStep && selectedStep.status == STEP_STATUS.done) {
            return true;
        }
        if (selectedStep.index != this.current_index) {
            if (this.config.anchorSettings.enableAllAnchors && this.config.anchorSettings.anchorClickable) {
                this._showStep(selectedStep.index);
            }
            else {
                if (selectedStep.status == STEP_STATUS.done) {
                    this._showStep(selectedStep.index);
                }
            }
        }
    };
    /**
     * @param {?=} event
     * @return {?}
     */
    NgWizardComponent.prototype._showNextStep = /**
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (event) {
            event.preventDefault();
        }
        // Find the next not disabled & hidden step
        /** @type {?} */
        var filteredSteps = this.steps.filter((/**
         * @param {?} step
         * @return {?}
         */
        function (step) {
            return step.index > (_this.current_index == null ? -1 : _this.current_index)
                && step.state != STEP_STATE.disabled
                && step.state != STEP_STATE.hidden;
        }));
        if (filteredSteps.length == 0) {
            if (!this.config.cycleSteps) {
                return;
            }
            this._showStep(0);
        }
        else {
            this._showStep(filteredSteps.shift().index);
        }
    };
    /**
     * @param {?=} event
     * @return {?}
     */
    NgWizardComponent.prototype._showPreviousStep = /**
     * @param {?=} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (event) {
            event.preventDefault();
        }
        // Find the previous not disabled & hidden step
        /** @type {?} */
        var filteredSteps = this.steps.filter((/**
         * @param {?} step
         * @return {?}
         */
        function (step) {
            return step.index < (_this.current_index == null && _this.config.cycleSteps ? _this.steps.length : _this.current_index)
                && step.state != STEP_STATE.disabled
                && step.state != STEP_STATE.hidden;
        }));
        if (filteredSteps.length == 0) {
            if (!this.config.cycleSteps) {
                return;
            }
            this._showStep(this.steps.length - 1);
        }
        else {
            this._showStep(filteredSteps.pop().index);
        }
    };
    /**
     * @param {?} index
     * @return {?}
     */
    NgWizardComponent.prototype._showStep = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        // If step not found, skip
        if (index >= this.steps.length || index < 0) {
            return;
        }
        // If current step is requested again, skip
        if (index == this.current_index) {
            return;
        }
        /** @type {?} */
        var selectedStep = this.steps.toArray()[index];
        // If it is a disabled or hidden step, skip
        if (selectedStep.state == STEP_STATE.disabled || selectedStep.state == STEP_STATE.hidden) {
            return;
        }
        // Load step content
        this._loadStepContent(selectedStep);
    };
    /**
     * @param {?} selectedStep
     * @return {?}
     */
    NgWizardComponent.prototype._loadStepContent = /**
     * @param {?} selectedStep
     * @return {?}
     */
    function (selectedStep) {
        // Get the direction of step navigation
        /** @type {?} */
        var stepDirection = (this.current_index != null && this.current_index != selectedStep.index) ? (this.current_index < selectedStep.index ? "forward" : "backward") : '';
        /** @type {?} */
        var stepPosition = (selectedStep.index == 0) ? 'first' : (selectedStep.index == this.steps.length - 1 ? 'final' : 'middle');
        // Update controls
        this._setAnchor(selectedStep);
        // Set the buttons based on the step
        this._setButtons(selectedStep.index);
        // Trigger "stepChanged" event
        this.stepChanged.emit({
            step: selectedStep,
            previousStep: this.currentStep,
            direction: stepDirection,
            position: stepPosition
        });
        // Update the current index
        this.current_index = selectedStep.index;
        this.currentStep = selectedStep;
    };
    /**
     * @param {?} selectedStep
     * @return {?}
     */
    NgWizardComponent.prototype._setAnchor = /**
     * @param {?} selectedStep
     * @return {?}
     */
    function (selectedStep) {
        // Current step anchor > Remove other classes and add done class
        if (this.currentStep) {
            this.currentStep.status = STEP_STATUS.untouched;
            if (this.config.anchorSettings.markDoneStep) {
                this.currentStep.status = STEP_STATUS.done;
                if (this.config.anchorSettings.removeDoneStepOnNavigateBack) {
                    this.steps.forEach((/**
                     * @param {?} step
                     * @return {?}
                     */
                    function (step) {
                        if (step.index > selectedStep.index) {
                            step.status = STEP_STATUS.untouched;
                        }
                    }));
                }
            }
        }
        // Next step anchor > Remove other classes and add active class
        selectedStep.status = STEP_STATUS.active;
    };
    /**
     * @param {?} index
     * @return {?}
     */
    NgWizardComponent.prototype._setButtons = /**
     * @param {?} index
     * @return {?}
     */
    function (index) {
        // Previous/Next Button enable/disable based on step
        if (!this.config.cycleSteps) {
            if (0 >= index) {
                this.styles.previousButton = 'btn btn-secondary ng-wizard-btn-prev disabled';
            }
            else {
                this.styles.previousButton = 'btn btn-secondary ng-wizard-btn-prev';
            }
            if (this.steps.length - 1 <= index) {
                this.styles.nextButton = 'btn btn-secondary ng-wizard-btn-next disabled';
            }
            else {
                this.styles.nextButton = 'btn btn-secondary ng-wizard-btn-next';
            }
        }
    };
    /**
     * @param {?} button
     * @return {?}
     */
    NgWizardComponent.prototype._extraButtonClicked = /**
     * @param {?} button
     * @return {?}
     */
    function (button) {
        if (button.event) {
            button.event();
        }
    };
    // HELPER FUNCTIONS
    // HELPER FUNCTIONS
    /**
     * @param {?} event
     * @return {?}
     */
    NgWizardComponent.prototype._keyNav = 
    // HELPER FUNCTIONS
    /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // Keyboard navigation
        switch (event.which) {
            case 37:
                // left
                this._showPreviousStep(event);
                event.preventDefault();
                break;
            case 39:
                // right
                this._showNextStep(event);
                event.preventDefault();
                break;
            default:
                return; // exit this handler for other keys
        }
    };
    /*
    _showLoader() {
      this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme + ' ng-wizard-loading';
    }
  
    _hideLoader() {
      this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
    }
    */
    // PUBLIC FUNCTIONS
    /*
      _showLoader() {
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme + ' ng-wizard-loading';
      }
    
      _hideLoader() {
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
      }
      */
    // PUBLIC FUNCTIONS
    /**
     * @param {?} theme
     * @return {?}
     */
    NgWizardComponent.prototype._setTheme = /*
      _showLoader() {
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme + ' ng-wizard-loading';
      }
    
      _hideLoader() {
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
      }
      */
    // PUBLIC FUNCTIONS
    /**
     * @param {?} theme
     * @return {?}
     */
    function (theme) {
        if (this.config.theme == theme) {
            return false;
        }
        this.config.theme = theme;
        this.styles.main = 'ng-wizard-main ng-wizard-theme-' + this.config.theme;
        // Trigger "themeChanged" event
        this.themeChanged.emit(this.config.theme);
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype._reset = /**
     * @return {?}
     */
    function () {
        // Reset all elements and classes
        this.current_index = null;
        this.currentStep = null;
        this._restoreStepStates();
        this._init();
        // Trigger "reseted" event
        this.reseted.emit();
    };
    /**
     * @return {?}
     */
    NgWizardComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        if (this.resetWizardWatcher) {
            this.resetWizardWatcher.unsubscribe();
        }
        if (this.showNextStepWatcher) {
            this.showNextStepWatcher.unsubscribe();
        }
        if (this.showPreviousStepWatcher) {
            this.showPreviousStepWatcher.unsubscribe();
        }
        if (this.setThemeWatcher) {
            this.setThemeWatcher.unsubscribe();
        }
    };
    NgWizardComponent.decorators = [
        { type: Component, args: [{
                    selector: 'ng-wizard',
                    template: "<div id=\"ngwizard\" [ngClass]=\"styles.main\">\n    <ul class=\"nav nav-tabs step-anchor\">\n        <li *ngFor=\"let step of steps; let i = index\" [ngClass]=\"_getStepCssClass(step)\">\n            <a href=\"#step-{{ i }}\" (click)=\"_showSelectedStep($event, step)\"\n                class=\"nav-link\">{{ step.title }}<br /><small>{{ step.description }}</small></a>\n        </li>\n    </ul>\n\n    <div *ngIf=\"showToolbarTop\" [ngClass]=\"styles.toolbarTop\">\n        <div class=\"btn-group mr-2 ng-wizard-btn-group\" role=\"group\">\n            <button *ngIf=\"showPreviousButton\" [ngClass]=\"styles.previousButton\" type=\"button\"\n                (click)=\"_showPreviousStep($event)\">{{ config.lang.previous }}</button>\n            <button *ngIf=\"showNextButton\" [ngClass]=\"styles.nextButton\" type=\"button\"\n                (click)=\"_showNextStep($event)\">{{ config.lang.next }}</button>\n        </div>\n\n        <div *ngIf=\"showExtraButtons\" class=\"btn-group mr-2 ng-wizard-btn-group-extra\" role=\"group\">\n            <button *ngFor=\"let button of config.toolbarSettings.toolbarExtraButtons; let j = index\"\n                [ngClass]=\"button.class\" type=\"button\" (click)=\"_extraButtonClicked(button)\">{{ button.text }}</button>\n        </div>\n    </div>\n\n    <div class=\"ng-wizard-container tab-content\">\n        <ng-content></ng-content>\n    </div>\n\n    <div *ngIf=\"showToolbarBottom\" [ngClass]=\"styles.toolbarBottom\">\n        <div class=\"btn-group mr-2 ng-wizard-btn-group\" role=\"group\">\n            <button *ngIf=\"showPreviousButton\" [ngClass]=\"styles.previousButton\" type=\"button\"\n                (click)=\"_showPreviousStep($event)\">{{ config.lang.previous }}</button>\n            <button *ngIf=\"showNextButton\" [ngClass]=\"styles.nextButton\" type=\"button\"\n                (click)=\"_showNextStep($event)\">{{ config.lang.next }}</button>\n        </div>\n\n        <div *ngIf=\"showExtraButtons\" class=\"btn-group mr-2 ng-wizard-btn-group-extra\" role=\"group\">\n            <button *ngFor=\"let button of config.toolbarSettings.toolbarExtraButtons; let j = index\"\n                [ngClass]=\"button.class\" type=\"button\" (click)=\"_extraButtonClicked(button)\">{{ button.text }}</button>\n        </div>\n    </div>\n</div>",
                    styles: [""]
                }] }
    ];
    /** @nocollapse */
    NgWizardComponent.ctorParameters = function () { return [
        { type: NgWizardService }
    ]; };
    NgWizardComponent.propDecorators = {
        steps: [{ type: ContentChildren, args: [NgWizardStep,] }],
        pConfig: [{ type: Input, args: ['config',] }],
        stepChanged: [{ type: Output }],
        themeChanged: [{ type: Output }],
        reseted: [{ type: Output }]
    };
    return NgWizardComponent;
}());
export { NgWizardComponent };
if (false) {
    /** @type {?} */
    NgWizardComponent.prototype.steps;
    /** @type {?} */
    NgWizardComponent.prototype._pConfig;
    /** @type {?} */
    NgWizardComponent.prototype.config;
    /** @type {?} */
    NgWizardComponent.prototype.stepChanged;
    /** @type {?} */
    NgWizardComponent.prototype.themeChanged;
    /** @type {?} */
    NgWizardComponent.prototype.reseted;
    /** @type {?} */
    NgWizardComponent.prototype.styles;
    /** @type {?} */
    NgWizardComponent.prototype.showToolbarTop;
    /** @type {?} */
    NgWizardComponent.prototype.showPreviousButton;
    /** @type {?} */
    NgWizardComponent.prototype.showNextButton;
    /** @type {?} */
    NgWizardComponent.prototype.showToolbarBottom;
    /** @type {?} */
    NgWizardComponent.prototype.showExtraButtons;
    /** @type {?} */
    NgWizardComponent.prototype.current_index;
    /** @type {?} */
    NgWizardComponent.prototype.currentStep;
    /** @type {?} */
    NgWizardComponent.prototype.resetWizardWatcher;
    /** @type {?} */
    NgWizardComponent.prototype.showNextStepWatcher;
    /** @type {?} */
    NgWizardComponent.prototype.showPreviousStepWatcher;
    /** @type {?} */
    NgWizardComponent.prototype.setThemeWatcher;
    /**
     * @type {?}
     * @private
     */
    NgWizardComponent.prototype.ngService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmctd2l6YXJkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL25nLXdpemFyZC8iLCJzb3VyY2VzIjpbImxpYi9jb3JlL3dpemFyZC9uZy13aXphcmQuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFvQixLQUFLLEVBQWEsWUFBWSxFQUFFLE1BQU0sRUFBRSxlQUFlLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBR2hJLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN2RCxPQUFPLEVBQWtCLFlBQVksRUFBa0MsTUFBTSx3QkFBd0IsQ0FBQztBQUN0RyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBUyxNQUFNLG1CQUFtQixDQUFDO0FBQ3JGLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU5QztJQWdERSwyQkFBb0IsU0FBMEI7UUFBMUIsY0FBUyxHQUFULFNBQVMsQ0FBaUI7UUExQnBDLGdCQUFXLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFDbEQsaUJBQVksR0FBRyxJQUFJLFlBQVksRUFBUyxDQUFDO1FBQ3pDLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBRTdDLFdBQU0sR0FPRixFQUFFLENBQUM7UUFFUCxtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUNoQyx1QkFBa0IsR0FBWSxLQUFLLENBQUM7UUFDcEMsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFDaEMsc0JBQWlCLEdBQVksS0FBSyxDQUFDO1FBQ25DLHFCQUFnQixHQUFZLEtBQUssQ0FBQztRQUNsQyxrQkFBYSxHQUFXLElBQUksQ0FBQyxDQUFDLG9CQUFvQjtJQVNsRCxDQUFDO0lBdENELHNCQUFJLHNDQUFPOzs7O1FBQVg7WUFDRSxPQUFPLElBQUksQ0FBQyxRQUFRLElBQUksRUFBRSxDQUFDO1FBQzdCLENBQUM7Ozs7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TUFBTTsrQkFDTixNQUFNOzBCQUNOLE1BQU07O0lBd1pULHdCQUFDO0NBQUEsQUFoYkQsSUFnYkM7U0EzYVksaUJBQWlCOzs7SUFFNUIsa0NBQ3NDOztJQUV0QyxxQ0FBeUI7O0lBVXpCLG1DQUF1Qjs7SUFFdkIsd0NBQTREOztJQUM1RCx5Q0FBbUQ7O0lBQ25ELG9DQUE2Qzs7SUFFN0MsbUNBT087O0lBRVAsMkNBQWdDOztJQUNoQywrQ0FBb0M7O0lBQ3BDLDJDQUFnQzs7SUFDaEMsOENBQW1DOztJQUNuQyw2Q0FBa0M7O0lBQ2xDLDBDQUE2Qjs7SUFDN0Isd0NBQTBCOztJQUUxQiwrQ0FBaUM7O0lBQ2pDLGdEQUFrQzs7SUFDbEMsb0RBQXNDOztJQUN0Qyw0Q0FBOEI7Ozs7O0lBRWxCLHNDQUFrQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQWZ0ZXJDb250ZW50SW5pdCwgSW5wdXQsIE9uRGVzdHJveSwgRXZlbnRFbWl0dGVyLCBPdXRwdXQsIENvbnRlbnRDaGlsZHJlbiwgUXVlcnlMaXN0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcblxuaW1wb3J0IHsgTmdXaXphcmRTZXJ2aWNlIH0gZnJvbSAnLi4vbmctd2l6YXJkLnNlcnZpY2UnO1xuaW1wb3J0IHsgTmdXaXphcmRDb25maWcsIE5nV2l6YXJkU3RlcCwgVG9vbGJhckJ1dHRvbiwgU3RlcENoYW5nZWRBcmdzIH0gZnJvbSAnLi4vLi4vdXRpbHMvaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBUT09MQkFSX1BPU0lUSU9OLCBTVEVQX1NUQVRFLCBTVEVQX1NUQVRVUywgVEhFTUUgfSBmcm9tICcuLi8uLi91dGlscy9lbnVtcyc7XG5pbXBvcnQgeyBtZXJnZSB9IGZyb20gJy4uLy4uL3V0aWxzL2Z1bmN0aW9ucyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ25nLXdpemFyZCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9uZy13aXphcmQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9uZy13aXphcmQuY29tcG9uZW50LmNzcyddLFxufSlcbmV4cG9ydCBjbGFzcyBOZ1dpemFyZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uRGVzdHJveSwgQWZ0ZXJDb250ZW50SW5pdCB7XG5cbiAgQENvbnRlbnRDaGlsZHJlbihOZ1dpemFyZFN0ZXApXG4gIHB1YmxpYyBzdGVwczogUXVlcnlMaXN0PE5nV2l6YXJkU3RlcD47XG5cbiAgX3BDb25maWc6IE5nV2l6YXJkQ29uZmlnO1xuICBnZXQgcENvbmZpZygpOiBOZ1dpemFyZENvbmZpZyB7XG4gICAgcmV0dXJuIHRoaXMuX3BDb25maWcgfHwge307XG4gIH1cblxuICBASW5wdXQoJ2NvbmZpZycpXG4gIHNldCBwQ29uZmlnKGNvbmZpZzogTmdXaXphcmRDb25maWcpIHtcbiAgICB0aGlzLl9wQ29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgY29uZmlnOiBOZ1dpemFyZENvbmZpZztcblxuICBAT3V0cHV0KCkgc3RlcENoYW5nZWQgPSBuZXcgRXZlbnRFbWl0dGVyPFN0ZXBDaGFuZ2VkQXJncz4oKTtcbiAgQE91dHB1dCgpIHRoZW1lQ2hhbmdlZCA9IG5ldyBFdmVudEVtaXR0ZXI8VEhFTUU+KCk7XG4gIEBPdXRwdXQoKSByZXNldGVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIHN0eWxlczoge1xuICAgIG1haW4/OiBzdHJpbmc7XG4gICAgc3RlcD86IHN0cmluZztcbiAgICBwcmV2aW91c0J1dHRvbj86IHN0cmluZztcbiAgICBuZXh0QnV0dG9uPzogc3RyaW5nO1xuICAgIHRvb2xiYXJUb3A/OiBzdHJpbmc7XG4gICAgdG9vbGJhckJvdHRvbT86IHN0cmluZztcbiAgfSA9IHt9O1xuXG4gIHNob3dUb29sYmFyVG9wOiBib29sZWFuID0gZmFsc2U7XG4gIHNob3dQcmV2aW91c0J1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93TmV4dEJ1dHRvbjogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93VG9vbGJhckJvdHRvbTogYm9vbGVhbiA9IGZhbHNlO1xuICBzaG93RXh0cmFCdXR0b25zOiBib29sZWFuID0gZmFsc2U7XG4gIGN1cnJlbnRfaW5kZXg6IG51bWJlciA9IG51bGw7IC8vIEFjdGl2ZSBzdGVwIGluZGV4XG4gIGN1cnJlbnRTdGVwOiBOZ1dpemFyZFN0ZXA7IC8vIEFjdGl2ZSBzdGVwXG5cbiAgcmVzZXRXaXphcmRXYXRjaGVyOiBTdWJzY3JpcHRpb247XG4gIHNob3dOZXh0U3RlcFdhdGNoZXI6IFN1YnNjcmlwdGlvbjtcbiAgc2hvd1ByZXZpb3VzU3RlcFdhdGNoZXI6IFN1YnNjcmlwdGlvbjtcbiAgc2V0VGhlbWVXYXRjaGVyOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBuZ1NlcnZpY2U6IE5nV2l6YXJkU2VydmljZSkge1xuICB9XG5cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIHRoaXMuX2JhY2t1cFN0ZXBTdGF0ZXMoKTtcblxuICAgIHRoaXMuX2luaXQoKTtcblxuICAgIC8vIFNldCB0b29sYmFyXG4gICAgdGhpcy5fc2V0VG9vbGJhcigpO1xuXG4gICAgLy8gQXNzaWduIHBsdWdpbiBldmVudHNcbiAgICB0aGlzLl9zZXRFdmVudHMoKTtcblxuICAgIHRoaXMucmVzZXRXaXphcmRXYXRjaGVyID0gdGhpcy5uZ1NlcnZpY2UucmVzZXRXaXphcmQkXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5fcmVzZXQoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy5zaG93TmV4dFN0ZXBXYXRjaGVyID0gdGhpcy5uZ1NlcnZpY2Uuc2hvd05leHRTdGVwJFxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMuX3Nob3dOZXh0U3RlcCgpO1xuICAgICAgfSk7XG5cbiAgICB0aGlzLnNob3dQcmV2aW91c1N0ZXBXYXRjaGVyID0gdGhpcy5uZ1NlcnZpY2Uuc2hvd1ByZXZpb3VzU3RlcCRcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLl9zaG93UHJldmlvdXNTdGVwKCk7XG4gICAgICB9KTtcblxuICAgIHRoaXMuc2V0VGhlbWVXYXRjaGVyID0gdGhpcy5uZ1NlcnZpY2Uuc2V0VGhlbWUkXG4gICAgICAuc3Vic2NyaWJlKHRoZW1lID0+IHtcbiAgICAgICAgdGhpcy5fc2V0VGhlbWUodGhlbWUpO1xuICAgICAgfSk7XG4gIH1cblxuICBfaW5pdCgpIHtcbiAgICAvLyBzZXQgY29uZmlnXG4gICAgdmFyIGRlZmF1bHRDb25maWcgPSB0aGlzLm5nU2VydmljZS5nZXREZWZhdWx0Q29uZmlnKCk7XG4gICAgdGhpcy5jb25maWcgPSBtZXJnZShkZWZhdWx0Q29uZmlnLCB0aGlzLnBDb25maWcpO1xuXG4gICAgLy8gc2V0IHN0ZXAgc3RhdGVzXG4gICAgdGhpcy5faW5pdFN0ZXBzKCk7XG5cbiAgICAvLyBTZXQgdGhlIGVsZW1lbnRzXG4gICAgdGhpcy5faW5pdFN0eWxlcygpO1xuXG4gICAgLy8gU2hvdyB0aGUgaW5pdGlhbCBzdGVwXG4gICAgdGhpcy5fc2hvd1N0ZXAodGhpcy5jb25maWcuc2VsZWN0ZWQpO1xuICB9XG5cbiAgX2luaXRTdGVwcygpIHtcbiAgICB0aGlzLnN0ZXBzLmZvckVhY2goKHN0ZXAsIGluZGV4KSA9PiB7XG4gICAgICBzdGVwLmluZGV4ID0gaW5kZXg7XG4gICAgICBzdGVwLnN0YXR1cyA9IHN0ZXAuc3RhdHVzIHx8IFNURVBfU1RBVFVTLnVudG91Y2hlZDtcbiAgICAgIHN0ZXAuc3RhdGUgPSBzdGVwLnN0YXRlIHx8IFNURVBfU1RBVEUubm9ybWFsO1xuICAgIH0pO1xuXG4gICAgLy8gTWFyayBwcmV2aW91cyBzdGVwcyBvZiB0aGUgYWN0aXZlIHN0ZXAgYXMgZG9uZVxuICAgIGlmICh0aGlzLmNvbmZpZy5zZWxlY3RlZCA+IDBcbiAgICAgICYmIHRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLm1hcmtEb25lU3RlcFxuICAgICAgJiYgdGhpcy5jb25maWcuYW5jaG9yU2V0dGluZ3MubWFya0FsbFByZXZpb3VzU3RlcHNBc0RvbmUpIHtcblxuICAgICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgICBpZiAoc3RlcC5zdGF0ZSAhPSBTVEVQX1NUQVRFLmRpc2FibGVkICYmIHN0ZXAuc3RhdGUgIT0gU1RFUF9TVEFURS5oaWRkZW4pIHtcbiAgICAgICAgICBzdGVwLnN0YXR1cyA9IHN0ZXAuaW5kZXggPCB0aGlzLmNvbmZpZy5zZWxlY3RlZCA/IFNURVBfU1RBVFVTLmRvbmUgOiBzdGVwLnN0YXR1cztcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgX2JhY2t1cFN0ZXBTdGF0ZXMoKSB7XG4gICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgc3RlcC5pbml0aWFsU3RhdHVzID0gc3RlcC5zdGF0dXM7XG4gICAgICBzdGVwLmluaXRpYWxTdGF0ZSA9IHN0ZXAuc3RhdGU7XG4gICAgfSk7XG4gIH1cblxuICBfcmVzdG9yZVN0ZXBTdGF0ZXMoKSB7XG4gICAgdGhpcy5zdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgc3RlcC5zdGF0dXMgPSBzdGVwLmluaXRpYWxTdGF0dXM7XG4gICAgICBzdGVwLnN0YXRlID0gc3RlcC5pbml0aWFsU3RhdGU7XG4gICAgfSk7XG4gIH1cblxuICAvLyBQUklWQVRFIEZVTkNUSU9OU1xuICBfaW5pdFN0eWxlcygpIHtcbiAgICAvLyBTZXQgdGhlIG1haW4gZWxlbWVudFxuICAgIHRoaXMuc3R5bGVzLm1haW4gPSAnbmctd2l6YXJkLW1haW4gbmctd2l6YXJkLXRoZW1lLScgKyB0aGlzLmNvbmZpZy50aGVtZTtcblxuICAgIC8vIFNldCBhbmNob3IgZWxlbWVudHNcbiAgICB0aGlzLnN0eWxlcy5zdGVwID0gJ25hdi1pdGVtJzsgLy8gbGlcblxuICAgIC8vIE1ha2UgdGhlIGFuY2hvciBjbGlja2FibGVcbiAgICBpZiAodGhpcy5jb25maWcuYW5jaG9yU2V0dGluZ3MuZW5hYmxlQWxsQW5jaG9ycyAmJiB0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5hbmNob3JDbGlja2FibGUpIHtcbiAgICAgIHRoaXMuc3R5bGVzLnN0ZXAgKz0gJyBjbGlja2FibGUnO1xuICAgIH1cblxuICAgIC8vIFNldCB0aGUgdG9vbGJhciBzdHlsZXNcbiAgICB0aGlzLnN0eWxlcy50b29sYmFyVG9wID0gJ2J0bi10b29sYmFyIG5nLXdpemFyZC10b29sYmFyIG5nLXdpemFyZC10b29sYmFyLXRvcCBqdXN0aWZ5LWNvbnRlbnQtJyArIHRoaXMuY29uZmlnLnRvb2xiYXJTZXR0aW5ncy50b29sYmFyQnV0dG9uUG9zaXRpb247XG4gICAgdGhpcy5zdHlsZXMudG9vbGJhckJvdHRvbSA9ICdidG4tdG9vbGJhciBuZy13aXphcmQtdG9vbGJhciBuZy13aXphcmQtdG9vbGJhci1ib3R0b20ganVzdGlmeS1jb250ZW50LScgKyB0aGlzLmNvbmZpZy50b29sYmFyU2V0dGluZ3MudG9vbGJhckJ1dHRvblBvc2l0aW9uO1xuXG4gICAgLy8gU2V0IHByZXZpb3VzJm5leHQgYnV0dG9ucyBcbiAgICB0aGlzLnN0eWxlcy5wcmV2aW91c0J1dHRvbiA9ICdidG4gYnRuLXNlY29uZGFyeSBuZy13aXphcmQtYnRuLXByZXYnO1xuICAgIHRoaXMuc3R5bGVzLm5leHRCdXR0b24gPSAnYnRuIGJ0bi1zZWNvbmRhcnkgbmctd2l6YXJkLWJ0bi1uZXh0JztcbiAgfVxuXG4gIF9zZXRUb29sYmFyKCkge1xuICAgIHRoaXMuc2hvd1Rvb2xiYXJUb3AgPSB0aGlzLmNvbmZpZy50b29sYmFyU2V0dGluZ3MudG9vbGJhclBvc2l0aW9uID09IFRPT0xCQVJfUE9TSVRJT04udG9wIHx8XG4gICAgICB0aGlzLmNvbmZpZy50b29sYmFyU2V0dGluZ3MudG9vbGJhclBvc2l0aW9uID09IFRPT0xCQVJfUE9TSVRJT04uYm90aDtcblxuICAgIHRoaXMuc2hvd1Rvb2xiYXJCb3R0b20gPSB0aGlzLmNvbmZpZy50b29sYmFyU2V0dGluZ3MudG9vbGJhclBvc2l0aW9uID09IFRPT0xCQVJfUE9TSVRJT04uYm90dG9tIHx8XG4gICAgICB0aGlzLmNvbmZpZy50b29sYmFyU2V0dGluZ3MudG9vbGJhclBvc2l0aW9uID09IFRPT0xCQVJfUE9TSVRJT04uYm90aDtcblxuICAgIHRoaXMuc2hvd1ByZXZpb3VzQnV0dG9uID0gdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnNob3dQcmV2aW91c0J1dHRvbjtcbiAgICB0aGlzLnNob3dOZXh0QnV0dG9uID0gdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnNob3dOZXh0QnV0dG9uO1xuXG4gICAgdGhpcy5zaG93RXh0cmFCdXR0b25zID0gdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJFeHRyYUJ1dHRvbnMgJiYgdGhpcy5jb25maWcudG9vbGJhclNldHRpbmdzLnRvb2xiYXJFeHRyYUJ1dHRvbnMubGVuZ3RoID4gMDtcbiAgfVxuXG4gIF9zZXRFdmVudHMoKSB7XG4gICAgLy9UT0RPOiBrZXlOYXZpZ2F0aW9uXG4gICAgLy8gS2V5Ym9hcmQgbmF2aWdhdGlvbiBldmVudFxuICAgIGlmICh0aGlzLmNvbmZpZy5rZXlOYXZpZ2F0aW9uKSB7XG4gICAgICAvLyAkKGRvY3VtZW50KS5rZXl1cChmdW5jdGlvbiAoZSkge1xuICAgICAgLy8gICBtaS5fa2V5TmF2KGUpO1xuICAgICAgLy8gfSk7XG4gICAgfVxuICB9XG5cbiAgX2dldFN0ZXBDc3NDbGFzcyhzZWxlY3RlZFN0ZXA6IE5nV2l6YXJkU3RlcCkge1xuICAgIHZhciBzdGVwQ2xhc3MgPSB0aGlzLnN0eWxlcy5zdGVwO1xuXG4gICAgc3dpdGNoIChzZWxlY3RlZFN0ZXAuc3RhdGUpIHtcbiAgICAgIGNhc2UgU1RFUF9TVEFURS5kaXNhYmxlZDpcbiAgICAgICAgc3RlcENsYXNzICs9ICcgZGlzYWJsZWQnO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgU1RFUF9TVEFURS5lcnJvcjpcbiAgICAgICAgc3RlcENsYXNzICs9ICcgZGFuZ2VyJztcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFNURVBfU1RBVEUuaGlkZGVuOlxuICAgICAgICBzdGVwQ2xhc3MgKz0gJyBoaWRkZW4nO1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHNlbGVjdGVkU3RlcC5zdGF0dXMpIHtcbiAgICAgIGNhc2UgU1RFUF9TVEFUVVMuZG9uZTpcbiAgICAgICAgc3RlcENsYXNzICs9ICcgZG9uZSc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBTVEVQX1NUQVRVUy5hY3RpdmU6XG4gICAgICAgIHN0ZXBDbGFzcyArPSAnIGFjdGl2ZSc7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHJldHVybiBzdGVwQ2xhc3M7XG4gIH1cblxuICBfc2hvd1NlbGVjdGVkU3RlcChldmVudDogRXZlbnQsIHNlbGVjdGVkU3RlcDogTmdXaXphcmRTdGVwKSB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICAgIGlmICghdGhpcy5jb25maWcuYW5jaG9yU2V0dGluZ3MuYW5jaG9yQ2xpY2thYmxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5lbmFibGVBbmNob3JPbkRvbmVTdGVwICYmIHNlbGVjdGVkU3RlcC5zdGF0dXMgPT0gU1RFUF9TVEFUVVMuZG9uZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKHNlbGVjdGVkU3RlcC5pbmRleCAhPSB0aGlzLmN1cnJlbnRfaW5kZXgpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hbmNob3JTZXR0aW5ncy5lbmFibGVBbGxBbmNob3JzICYmIHRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLmFuY2hvckNsaWNrYWJsZSkge1xuICAgICAgICB0aGlzLl9zaG93U3RlcChzZWxlY3RlZFN0ZXAuaW5kZXgpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmIChzZWxlY3RlZFN0ZXAuc3RhdHVzID09IFNURVBfU1RBVFVTLmRvbmUpIHtcbiAgICAgICAgICB0aGlzLl9zaG93U3RlcChzZWxlY3RlZFN0ZXAuaW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX3Nob3dOZXh0U3RlcChldmVudD86IEV2ZW50KSB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICAvLyBGaW5kIHRoZSBuZXh0IG5vdCBkaXNhYmxlZCAmIGhpZGRlbiBzdGVwXG4gICAgdmFyIGZpbHRlcmVkU3RlcHMgPSB0aGlzLnN0ZXBzLmZpbHRlcihzdGVwID0+IHtcbiAgICAgIHJldHVybiBzdGVwLmluZGV4ID4gKHRoaXMuY3VycmVudF9pbmRleCA9PSBudWxsID8gLTEgOiB0aGlzLmN1cnJlbnRfaW5kZXgpXG4gICAgICAgICYmIHN0ZXAuc3RhdGUgIT0gU1RFUF9TVEFURS5kaXNhYmxlZFxuICAgICAgICAmJiBzdGVwLnN0YXRlICE9IFNURVBfU1RBVEUuaGlkZGVuO1xuICAgIH0pO1xuXG4gICAgaWYgKGZpbHRlcmVkU3RlcHMubGVuZ3RoID09IDApIHtcbiAgICAgIGlmICghdGhpcy5jb25maWcuY3ljbGVTdGVwcykge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3Nob3dTdGVwKDApXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5fc2hvd1N0ZXAoZmlsdGVyZWRTdGVwcy5zaGlmdCgpLmluZGV4KVxuICAgIH1cbiAgfVxuXG4gIF9zaG93UHJldmlvdXNTdGVwKGV2ZW50PzogRXZlbnQpIHtcbiAgICBpZiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIC8vIEZpbmQgdGhlIHByZXZpb3VzIG5vdCBkaXNhYmxlZCAmIGhpZGRlbiBzdGVwXG4gICAgdmFyIGZpbHRlcmVkU3RlcHMgPSB0aGlzLnN0ZXBzLmZpbHRlcihzdGVwID0+IHtcbiAgICAgIHJldHVybiBzdGVwLmluZGV4IDwgKHRoaXMuY3VycmVudF9pbmRleCA9PSBudWxsICYmIHRoaXMuY29uZmlnLmN5Y2xlU3RlcHMgPyB0aGlzLnN0ZXBzLmxlbmd0aCA6IHRoaXMuY3VycmVudF9pbmRleClcbiAgICAgICAgJiYgc3RlcC5zdGF0ZSAhPSBTVEVQX1NUQVRFLmRpc2FibGVkXG4gICAgICAgICYmIHN0ZXAuc3RhdGUgIT0gU1RFUF9TVEFURS5oaWRkZW47XG4gICAgfSk7XG5cbiAgICBpZiAoZmlsdGVyZWRTdGVwcy5sZW5ndGggPT0gMCkge1xuICAgICAgaWYgKCF0aGlzLmNvbmZpZy5jeWNsZVN0ZXBzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fc2hvd1N0ZXAodGhpcy5zdGVwcy5sZW5ndGggLSAxKVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIHRoaXMuX3Nob3dTdGVwKGZpbHRlcmVkU3RlcHMucG9wKCkuaW5kZXgpXG4gICAgfVxuICB9XG5cbiAgX3Nob3dTdGVwKGluZGV4OiBudW1iZXIpIHtcbiAgICAvLyBJZiBzdGVwIG5vdCBmb3VuZCwgc2tpcFxuICAgIGlmIChpbmRleCA+PSB0aGlzLnN0ZXBzLmxlbmd0aCB8fCBpbmRleCA8IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgLy8gSWYgY3VycmVudCBzdGVwIGlzIHJlcXVlc3RlZCBhZ2Fpbiwgc2tpcFxuICAgIGlmIChpbmRleCA9PSB0aGlzLmN1cnJlbnRfaW5kZXgpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHNlbGVjdGVkU3RlcCA9IHRoaXMuc3RlcHMudG9BcnJheSgpW2luZGV4XTtcbiAgICAvLyBJZiBpdCBpcyBhIGRpc2FibGVkIG9yIGhpZGRlbiBzdGVwLCBza2lwXG4gICAgaWYgKHNlbGVjdGVkU3RlcC5zdGF0ZSA9PSBTVEVQX1NUQVRFLmRpc2FibGVkIHx8IHNlbGVjdGVkU3RlcC5zdGF0ZSA9PSBTVEVQX1NUQVRFLmhpZGRlbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIExvYWQgc3RlcCBjb250ZW50XG4gICAgdGhpcy5fbG9hZFN0ZXBDb250ZW50KHNlbGVjdGVkU3RlcCk7XG4gIH1cblxuICBfbG9hZFN0ZXBDb250ZW50KHNlbGVjdGVkU3RlcDogTmdXaXphcmRTdGVwKSB7XG4gICAgLy8gR2V0IHRoZSBkaXJlY3Rpb24gb2Ygc3RlcCBuYXZpZ2F0aW9uXG4gICAgdmFyIHN0ZXBEaXJlY3Rpb24gPSAodGhpcy5jdXJyZW50X2luZGV4ICE9IG51bGwgJiYgdGhpcy5jdXJyZW50X2luZGV4ICE9IHNlbGVjdGVkU3RlcC5pbmRleCkgPyAodGhpcy5jdXJyZW50X2luZGV4IDwgc2VsZWN0ZWRTdGVwLmluZGV4ID8gXCJmb3J3YXJkXCIgOiBcImJhY2t3YXJkXCIpIDogJyc7XG4gICAgdmFyIHN0ZXBQb3NpdGlvbiA9IChzZWxlY3RlZFN0ZXAuaW5kZXggPT0gMCkgPyAnZmlyc3QnIDogKHNlbGVjdGVkU3RlcC5pbmRleCA9PSB0aGlzLnN0ZXBzLmxlbmd0aCAtIDEgPyAnZmluYWwnIDogJ21pZGRsZScpO1xuXG4gICAgLy8gVXBkYXRlIGNvbnRyb2xzXG4gICAgdGhpcy5fc2V0QW5jaG9yKHNlbGVjdGVkU3RlcCk7XG4gICAgLy8gU2V0IHRoZSBidXR0b25zIGJhc2VkIG9uIHRoZSBzdGVwXG4gICAgdGhpcy5fc2V0QnV0dG9ucyhzZWxlY3RlZFN0ZXAuaW5kZXgpO1xuXG4gICAgLy8gVHJpZ2dlciBcInN0ZXBDaGFuZ2VkXCIgZXZlbnRcbiAgICB0aGlzLnN0ZXBDaGFuZ2VkLmVtaXQoe1xuICAgICAgc3RlcDogc2VsZWN0ZWRTdGVwLFxuICAgICAgcHJldmlvdXNTdGVwOiB0aGlzLmN1cnJlbnRTdGVwLFxuICAgICAgZGlyZWN0aW9uOiBzdGVwRGlyZWN0aW9uLFxuICAgICAgcG9zaXRpb246IHN0ZXBQb3NpdGlvblxuICAgIH0pO1xuXG4gICAgLy8gVXBkYXRlIHRoZSBjdXJyZW50IGluZGV4XG4gICAgdGhpcy5jdXJyZW50X2luZGV4ID0gc2VsZWN0ZWRTdGVwLmluZGV4O1xuICAgIHRoaXMuY3VycmVudFN0ZXAgPSBzZWxlY3RlZFN0ZXA7XG4gIH1cblxuICBfc2V0QW5jaG9yKHNlbGVjdGVkU3RlcDogTmdXaXphcmRTdGVwKSB7XG4gICAgLy8gQ3VycmVudCBzdGVwIGFuY2hvciA+IFJlbW92ZSBvdGhlciBjbGFzc2VzIGFuZCBhZGQgZG9uZSBjbGFzc1xuICAgIGlmICh0aGlzLmN1cnJlbnRTdGVwKSB7XG4gICAgICB0aGlzLmN1cnJlbnRTdGVwLnN0YXR1cyA9IFNURVBfU1RBVFVTLnVudG91Y2hlZDtcblxuICAgICAgaWYgKHRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLm1hcmtEb25lU3RlcCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRTdGVwLnN0YXR1cyA9IFNURVBfU1RBVFVTLmRvbmU7XG5cbiAgICAgICAgaWYgKHRoaXMuY29uZmlnLmFuY2hvclNldHRpbmdzLnJlbW92ZURvbmVTdGVwT25OYXZpZ2F0ZUJhY2spIHtcbiAgICAgICAgICB0aGlzLnN0ZXBzLmZvckVhY2goc3RlcCA9PiB7XG4gICAgICAgICAgICBpZiAoc3RlcC5pbmRleCA+IHNlbGVjdGVkU3RlcC5pbmRleCkge1xuICAgICAgICAgICAgICBzdGVwLnN0YXR1cyA9IFNURVBfU1RBVFVTLnVudG91Y2hlZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5leHQgc3RlcCBhbmNob3IgPiBSZW1vdmUgb3RoZXIgY2xhc3NlcyBhbmQgYWRkIGFjdGl2ZSBjbGFzc1xuICAgIHNlbGVjdGVkU3RlcC5zdGF0dXMgPSBTVEVQX1NUQVRVUy5hY3RpdmU7XG4gIH1cblxuICBfc2V0QnV0dG9ucyhpbmRleDogbnVtYmVyKSB7XG4gICAgLy8gUHJldmlvdXMvTmV4dCBCdXR0b24gZW5hYmxlL2Rpc2FibGUgYmFzZWQgb24gc3RlcFxuICAgIGlmICghdGhpcy5jb25maWcuY3ljbGVTdGVwcykge1xuICAgICAgaWYgKDAgPj0gaW5kZXgpIHtcbiAgICAgICAgdGhpcy5zdHlsZXMucHJldmlvdXNCdXR0b24gPSAnYnRuIGJ0bi1zZWNvbmRhcnkgbmctd2l6YXJkLWJ0bi1wcmV2IGRpc2FibGVkJztcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnN0eWxlcy5wcmV2aW91c0J1dHRvbiA9ICdidG4gYnRuLXNlY29uZGFyeSBuZy13aXphcmQtYnRuLXByZXYnO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5zdGVwcy5sZW5ndGggLSAxIDw9IGluZGV4KSB7XG4gICAgICAgIHRoaXMuc3R5bGVzLm5leHRCdXR0b24gPSAnYnRuIGJ0bi1zZWNvbmRhcnkgbmctd2l6YXJkLWJ0bi1uZXh0IGRpc2FibGVkJztcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICB0aGlzLnN0eWxlcy5uZXh0QnV0dG9uID0gJ2J0biBidG4tc2Vjb25kYXJ5IG5nLXdpemFyZC1idG4tbmV4dCc7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgX2V4dHJhQnV0dG9uQ2xpY2tlZChidXR0b246IFRvb2xiYXJCdXR0b24pIHtcbiAgICBpZiAoYnV0dG9uLmV2ZW50KSB7XG4gICAgICBidXR0b24uZXZlbnQoKTtcbiAgICB9XG4gIH1cblxuICAvLyBIRUxQRVIgRlVOQ1RJT05TXG4gIF9rZXlOYXYoZXZlbnQ6IEtleWJvYXJkRXZlbnQpIHtcbiAgICAvLyBLZXlib2FyZCBuYXZpZ2F0aW9uXG4gICAgc3dpdGNoIChldmVudC53aGljaCkge1xuICAgICAgY2FzZSAzNzpcbiAgICAgICAgLy8gbGVmdFxuICAgICAgICB0aGlzLl9zaG93UHJldmlvdXNTdGVwKGV2ZW50KTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDM5OlxuICAgICAgICAvLyByaWdodFxuICAgICAgICB0aGlzLl9zaG93TmV4dFN0ZXAoZXZlbnQpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybjsgLy8gZXhpdCB0aGlzIGhhbmRsZXIgZm9yIG90aGVyIGtleXNcbiAgICB9XG4gIH1cblxuICAvKlxuICBfc2hvd0xvYWRlcigpIHtcbiAgICB0aGlzLnN0eWxlcy5tYWluID0gJ25nLXdpemFyZC1tYWluIG5nLXdpemFyZC10aGVtZS0nICsgdGhpcy5jb25maWcudGhlbWUgKyAnIG5nLXdpemFyZC1sb2FkaW5nJztcbiAgfVxuXG4gIF9oaWRlTG9hZGVyKCkge1xuICAgIHRoaXMuc3R5bGVzLm1haW4gPSAnbmctd2l6YXJkLW1haW4gbmctd2l6YXJkLXRoZW1lLScgKyB0aGlzLmNvbmZpZy50aGVtZTtcbiAgfVxuICAqL1xuXG4gIC8vIFBVQkxJQyBGVU5DVElPTlNcbiAgX3NldFRoZW1lKHRoZW1lOiBUSEVNRSkge1xuICAgIGlmICh0aGlzLmNvbmZpZy50aGVtZSA9PSB0aGVtZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRoaXMuY29uZmlnLnRoZW1lID0gdGhlbWU7XG4gICAgdGhpcy5zdHlsZXMubWFpbiA9ICduZy13aXphcmQtbWFpbiBuZy13aXphcmQtdGhlbWUtJyArIHRoaXMuY29uZmlnLnRoZW1lO1xuXG4gICAgLy8gVHJpZ2dlciBcInRoZW1lQ2hhbmdlZFwiIGV2ZW50XG4gICAgdGhpcy50aGVtZUNoYW5nZWQuZW1pdCh0aGlzLmNvbmZpZy50aGVtZSk7XG4gIH1cblxuICBfcmVzZXQoKSB7XG4gICAgLy8gUmVzZXQgYWxsIGVsZW1lbnRzIGFuZCBjbGFzc2VzXG4gICAgdGhpcy5jdXJyZW50X2luZGV4ID0gbnVsbDtcbiAgICB0aGlzLmN1cnJlbnRTdGVwID0gbnVsbDtcbiAgICB0aGlzLl9yZXN0b3JlU3RlcFN0YXRlcygpO1xuICAgIHRoaXMuX2luaXQoKTtcblxuICAgIC8vIFRyaWdnZXIgXCJyZXNldGVkXCIgZXZlbnRcbiAgICB0aGlzLnJlc2V0ZWQuZW1pdCgpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMucmVzZXRXaXphcmRXYXRjaGVyKSB7XG4gICAgICB0aGlzLnJlc2V0V2l6YXJkV2F0Y2hlci51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNob3dOZXh0U3RlcFdhdGNoZXIpIHtcbiAgICAgIHRoaXMuc2hvd05leHRTdGVwV2F0Y2hlci51bnN1YnNjcmliZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnNob3dQcmV2aW91c1N0ZXBXYXRjaGVyKSB7XG4gICAgICB0aGlzLnNob3dQcmV2aW91c1N0ZXBXYXRjaGVyLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc2V0VGhlbWVXYXRjaGVyKSB7XG4gICAgICB0aGlzLnNldFRoZW1lV2F0Y2hlci51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgfVxufVxuIl19